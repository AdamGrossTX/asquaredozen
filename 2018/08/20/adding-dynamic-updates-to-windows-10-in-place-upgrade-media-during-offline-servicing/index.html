<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=keyword content="ConfigMgr Microsoft MVP Gross Intune Windows"><meta name=viewport content="width=device-width"><meta name=description content="A.Gross Blog | Adam Gross Enterprise Mobility MVP"><link rel="shortcut icon" href=/img/favicon.ico><title>Adding Dynamic Updates to Windows 10 In-Place Upgrade Media During Offline Servicing-A Square Dozen | A. Gross Blog</title><link rel=canonical href=/2018/08/20/adding-dynamic-updates-to-windows-10-in-place-upgrade-media-during-offline-servicing/><link rel=stylesheet href=/css/style.css><link rel=stylesheet href=https://www.asquaredozen.com/css/custom.css><script src=https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js></script>
<script src=https://ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js></script>
<script src=https://www.asquaredozen.com/js/jquery.slicknav.js></script>
<script src=https://www.asquaredozen.com/js/asd_SlickNav_Mobile.js></script>
<script src=https://www.asquaredozen.com/js/custom.js></script>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-DYVXTRTXN4"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-DYVXTRTXN4",{anonymize_ip:!1})}</script><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://www.asquaredozen.com/img/ASquareDozen-Logo_Horiz_Twitter.png"><meta name=twitter:title content="Adding Dynamic Updates to Windows 10 In-Place Upgrade Media During Offline Servicing"><meta name=twitter:description content="For the past few months, there has been a community-wide push to determine the optimal approach for Offline Servicing Windows 10 media and to get Microsoft to take on more of this burden so we can get on with other tasks instead of dealing with servicing every month. Ultimately, Microsoft needs a better process for updating media each month, but until they do, all we can do is what we do best, Socially Engineer solutions."><meta property="og:title" content="Adding Dynamic Updates to Windows 10 In-Place Upgrade Media During Offline Servicing"><meta property="og:description" content="For the past few months, there has been a community-wide push to determine the optimal approach for Offline Servicing Windows 10 media and to get Microsoft to take on more of this burden so we can get on with other tasks instead of dealing with servicing every month. Ultimately, Microsoft needs a better process for updating media each month, but until they do, all we can do is what we do best, Socially Engineer solutions."><meta property="og:type" content="article"><meta property="og:url" content="https://www.asquaredozen.com/2018/08/20/adding-dynamic-updates-to-windows-10-in-place-upgrade-media-during-offline-servicing/"><meta property="og:image" content="https://www.asquaredozen.com/img/ASquareDozen-Logo_Horiz_Twitter.png"><meta property="article:section" content="posts"><meta property="article:published_time" content="2018-08-20T06:14:08+00:00"><meta property="article:modified_time" content="2018-08-20T06:14:08+00:00"><meta property="og:site_name" content="A Square Dozen | A. Gross Blog"></head><body class="home blog"><div id=asd-container><div id=top-bar><div class=container><div id=nav-wrapper><ul class=menu id=menu-top-menu><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home"><a href=/>Home</a></li><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home"><a href=#><span>Feature Updates</span></a><ul class="sub-menu menu-item menu-item-type-custom menu-item-object-custom menu-item-home"><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home"><a href=/2019/08/22/windows-10-feature-updates-leveraging-setupdiag-for-better-reporting/>Windows 10 Feature Updates – Leveraging SetupDiag for Better Reporting</a></li><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home"><a href=/2019/10/05/windows-10-feature-updates-the-challenge-of-servicing-in-the-enterprise/>Windows 10 Feature Updates – The Challenge of Servicing in the Enterprise</a></li><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home"><a href=/2019/08/25/windows-10-feature-updates-using-custom-action-scripts/>Windows 10 Feature Updates – Using Custom Action Scripts</a></li><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home"><a href=/2019/08/25/windows-10-feature-updates-using-setupconfig-ini-to-manage-feature-updates-in-the-enterprise/>Windows 10 Feature Updates – Using Setupconfig.ini to Manage Feature Updates in the Enterprise</a></li></ul></li><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home"><a href=/2019/02/12/the-system-center-configuration-manager-adminservice-guide/><span>ConfigMgr AdminService</span></a></li><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home"><a href=#><span>802.1x for OSD</span></a><ul class="sub-menu menu-item menu-item-type-custom menu-item-object-custom menu-item-home"><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home"><a href=/2018/07/29/configuring-802-1x-authentication-for-windows-deployment-part-1-building-an-802-1x-computer-authentication-script/>Part 1 – Building an 802.1x Computer Authentication Script</a></li><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home"><a href=/2018/07/29/configuring-802-1x-authentication-for-windows-deployment-part-2-building-an-802-1x-enabled-winpe-boot-image/>Part 2 – Building an 802.1x Enabled WinPE Boot Image</a></li><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home"><a href=/2018/07/29/configuring-802-1x-authentication-for-windows-deployment-part-3-integrating-802-1x-authentication-into-a-bare-metal-task-sequence/>Part 3 – Integrating 802.1x Authentication into a Bare Metal Task Sequence</a></li><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home"><a href=/2018/07/29/configuring-802-1x-authentication-for-windows-deployment-part-4-integrating-802-1x-authentication-into-an-in-place-upgrade-task-sequence/>Part 4 – Integrating 802.1x Authentication into an In-Place Upgrade Task Sequence</a></li><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home"><a href=/2018/09/29/configuring-802-1x-authentication-for-windows-deployment-part-5-dynamic-whitelisting-using-the-cisco-ise-external-restful-service/>Part 5 – Dynamic Whitelisting using the Cisco ISE External RESTful Service</a></li><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home"><a href=/2018/07/29/configuring-802-1x-authentication-for-windows-deployment-tips-and-tricks/>Tips and Tricks</a></li></ul></li><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home"><a href=#><span>Task Sequence Hacks</span></a><ul class="sub-menu menu-item menu-item-type-custom menu-item-object-custom menu-item-home"><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home"><a href=/2018/11/29/building-a-better-task-sequence/>Building a Better Task Sequence</a></li><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home"><a href=/2019/04/30/building-a-smarter-task-sequence/>Building a Smarter Task Sequence</a></li><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home"><a href=/2018/12/14/building-an-even-better-task-sequence/>Building An Even Better Task Sequence</a></li><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home"><a href=/2018/07/16/clearing-local-group-policies-during-an-windows-7-to-10-in-place-upgrade-task-sequence/>Clearing Local Group Policies during an Windows 7 to 10 In-Place Upgrade Task Sequence</a></li><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home"><a href=/2018/10/03/debugging-sccm-configmgr-task-sequences-on-the-fly/>Debugging SCCM/ConfigMgr Task Sequences on the Fly</a></li><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home"><a href=/2018/07/11/dynamically-updating-unattend-xml-during-an-osd-task-sequence-using-mdt-variables-and-zti-scripts/>Dynamically Updating Unattend.XML during an OSD Task Sequence using MDT Variables and ZTI Scripts.</a></li><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home"><a href=/2018/06/14/triggering-configmgr-client-actions-from-a-task-sequence/>Triggering ConfigMgr Client Actions from a Task Sequence</a></li><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home"><a href=/2018/08/27/using-sccm-task-sequence-variables-as-scripts/>Using SCCM Task Sequence Variables as Scripts</a></li></ul></li><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home"><a href=https://github.com/AdamGrossTX><span>GitHub</span></a></li><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home"><a href=#><span>MORE></span></a><ul class="sub-menu menu-item menu-item-type-custom menu-item-object-custom menu-item-home"><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home"><a href=/about/>About</a></li><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home"><a href=/consulting/>Consulting</a></li><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home"><a href=/contact/>Contact</a></li></ul></li></ul></div><div id=top-search><a href=# class=search><i class="fa fa-search"></i></a><div class=show-search><form role=search method=get action=https://www.google.com/search id=searchform><input type=search placeholder="Search and hit enter..." name=q id=q title="Search and hit enter...">
<input type=hidden name=sitesearch value=https://www.asquaredozen.com>
<button type=submit value=Search></form></div></div><div class=menu id=menu-mobile></div></div></div><header id=header class=noslider><div class=container><div id=logo><h1><a href=https://www.asquaredozen.com><img src=/img/A-Square-Dozen-Logo-BlogHeader-1.png alt="A Square Dozen"></a></h1></div></div></header><div class=container><div id=content><div id=main class=fullwidth><article class="post type-post status-publish format-standard has-post-thumbnail hentry"><div class=post-header><h1>Adding Dynamic Updates to Windows 10 In-Place Upgrade Media During Offline Servicing</h1><span class=post-date>August 20, 2018</span></div><div class=post-entry><p>For the past few months, there has been a community-wide push to determine the optimal approach for Offline Servicing Windows 10 media and to get Microsoft to take on more of this burden so we can get on with other tasks instead of dealing with servicing every month. Ultimately, Microsoft needs a better process for updating media each month, but until they do, all we can do is what we do best, Socially Engineer solutions. This post will cover some of the background around the Windows 10 Offline Servicing effort and specifically provide a solution to applying Dynamic Updates to your Offline serviced Windows 10 In-Place Upgrade media so that your clients don&rsquo;t have to go out to the internet for the lates compatibility updates.</p><h1 id=osd-community-contributions>OSD Community Contributions</h1><p>Below is a list of several folks (I&rsquo;m sure there are more) that have made great progress on Offline Servicing for the community. While I would love for this to be a comprehensive guide to servicing, I believe that these folks have done a pretty great job in providing you with lots of information and strategies for servicing your image. Everything from super simple scripts to a full blown image servicing and customization tool (OSBuilder) have been written and you should find something in here that suits your needs. For me, I can&rsquo;t ever leave anything alone so I have my own script to add to this list (links will be at the bottom) as well. Thank you to all of you for your support and contributions to the OSD community!</p><ul><li><a href=https://twitter.com/miketerrill>Mike Terrill</a> - <a href=https://miketerrill.net/2018/06/23/optimizing-win10-os-upgrade-wim-sizes/>https://miketerrill.net/2018/06/23/optimizing-win10-os-upgrade-wim-sizes/</a></li><li><a href=https://twitter.com/jarwidmark>Johan Arwidmark</a> - <a href=https://deploymentresearch.com/Research/Post/672/Windows-10-Servicing-Script-Creating-the-better-In-Place-upgrade-image>https://deploymentresearch.com/Research/Post/672/Windows-10-Servicing-Script-Creating-the-better-In-Place-upgrade-image</a></li><li><a href=https://twitter.com/mike_marable>Mike Marable</a> - <a href=https://thesystemsmonkey.wordpress.com/2018/06/29/automating-windows-10-servicing/>https://thesystemsmonkey.wordpress.com/2018/06/29/automating-windows-10-servicing/</a></li><li><a href=https://twitter.com/surferstylee13>Marc Graham</a> - <a href=http://blog.ctglobalservices.com/configuration-manager-sccm/mag/devicemap-and-device-inventory-failures-in-win7-to-win10-1709-in-place-upgrades/>http://blog.ctglobalservices.com/configuration-manager-sccm/mag/devicemap-and-device-inventory-failures-in-win7-to-win10-1709-in-place-upgrades/</a></li><li><a href=https://twitter.com/SeguraOSD>David Segura</a> - <a href=https://www.osdeploy.com/osbuilder/overview>https://www.osdeploy.com/osbuilder/overview</a></li><li><a href=https://twitter.com/gwblok>Gary Blok</a> - <a href=https://garytown.com/ipu-offline-dynamic-updates>https://garytown.com/ipu-offline-dynamic-updates</a></li></ul><h1 id=the-problem-with-dynamic-updates-and-offline-servicing>The Problem with Dynamic Updates and Offline Servicing</h1><p>You may have seen posts from several folks related to <strong>Devinv.dll</strong> causing issues with Upgrades and needing to be updated. Mike Terrill, Marc Graham and I all ran into issues around the same time and began talking to the community about how to get things in sync. Ultimately, we came up with several solutions, with David Segura&rsquo;s being the most automated within OSBuilder. In an unrelated effort I started looking into <strong>Dynamic Updates</strong> and why they weren&rsquo;t working with SCCM/ConfigMgr and wrote about a workaround as well was more detail about <strong>Dynamic Updates</strong> here: (<a href=http://www.asquaredozen.com/2018/07/18/enabling-dynamic-updates-and-servicing-drivers-from-microsoft-update-during-a-windows-10-in-place-upgrade-task-sequence-in-configmgr/>Part 1</a> and <a href=http://www.asquaredozen.com/2018/07/18/enabling-dynamic-update-and-ignoring-dissmissable-compatibility-warnings-during-an-windows-10-in-place-upgrade-task-sequence-in-configmgr/>Part 2</a>). What I didn&rsquo;t know at the time was that <strong>Dynamic Updates</strong> and <strong>Devinv.dll</strong> were related until Gary Blok dropped the bombshell on us - <strong>Dynamic Updates contain all of the updated setup files needed for successful In-Place Upgrades</strong>!!</p><p>Gary&rsquo;s solution was simple, just <strong>extract the Dynamic Update files and replace the setup files</strong> in the <strong>Sources</strong> directory of your Windows 10 In-Place Upgrade media. The only question remaining was, what about the Dynamic Update servicing drivers?? Windows 10 1709 has 6 Dynamic Updates, but only one that makes sense to extract to <strong>Sources</strong>. So I started poking at the problem and, with the help of Gary Blok, Mike Terrill and David Segura, I think that I have a solution to this final issue of: <strong>How do we Apply the Dynamic Update Servicing Drivers to Windows 10 In-Place Upgrade media - Offline</strong>?</p><p>Well, that solution was simple as well. I had spent most of Thursday thinking about Gary&rsquo;s solution and what we could about drivers then I went to bed. The next morning, it hit me. The <strong>Dynamic Updates are all CAB files and DISM can install CAB files</strong>. I quickly got on my servicing VM and tested using PowerShell <strong>Add-WindowsPackage</strong> and It Worked!! Then I had to go to the Children&rsquo;s Museum for the day knowing I was sitting on the solution and it was killing me. I messaged Gary the solution and he and Mike began testing but quickly hit a snag with applying the CABs which ended up taking a day to sort out. Finally, we had a working solution - add the Dynamic Update CABS to the install.WIM just like any other packages into your install.wim, but be careful with how you loop through your cabs or you may blow up your image as Mike found out, over and over again (See below for more info on the workaround)!</p><h1 id=order-of-servicing-steps>Order of Servicing Steps</h1><p>By now, you should already have a process that you use to service your WIMs. It should be something like this (This only covers install.wim, there are many more wims):</p><p><strong>Without Dynamic Updates</strong></p><ul><li>Mount Windows 10 ISO</li><li>Copy ISO contents to local folder</li><li>Extract WIM for version you want to service (This gets rid of the multiple indexes)</li><li>Mount install.wim</li><li>Apply Servicing Stack Update (SSU)</li><li>Apply Latest Cumulative Update (LCU)</li><li>Apply Flash Update</li><li>Clean and Reset Base (Optional, but cuts down on your WIM size - it also adds a lot of extra WIM processing time)</li><li>Add .NET 3.5 Feature (Once applied, you can&rsquo;t clean and resetbase any more)</li><li>&ndash;Removing this step - Not likely Needed &ndash; Apply SSU (Must reapply everything after .NET or post-upgrade, the OS will still think it needs these updates)</li><li>Apply LCU</li><li>Dismount WIM</li></ul><p>Here&rsquo;s what the solution will look like when you add in Dynamic Updates<br><strong>With Dynamic Updates</strong></p><ul><li>Mount Windows 10 ISO</li><li>Copy ISO contents to local folder</li><li>Extract WIM for version you want to service</li><li>Mount install.wim</li><li>Apply Servicing Stack Update (SSU)</li><li>Apply Latest Cumulative Update (LCU)</li><li>Apply Flash Update</li><li>Apply Dynamic Update Component Update (DUCU) (May or may not need to apply here)</li><li>Clean and Reset Base</li><li>Add .NET 3.5 Feature</li><li>&ndash;Removing this step - Not likely Needed &ndash; Apply SSU (Must reapply everything after .NET or post-upgrade, the OS will still think it needs these updates)</li><li>Apply LCU</li><li>Apply Dynamic Updates Component Update (DUCU)</li><li>Dismount WIM</li><li>Extract Dynamic Update Setup Update (DUSU) and copy to Sources folder in your In-Place Upgrade media (Gary&rsquo;s steps from post above)</li></ul><h1 id=dynamic-update-types>Dynamic Update Types</h1><p>I the absence of official Microsoft documentation, I&rsquo;m going to make some stuff up.</p><p>If you search in your ConfigMgr console and turn on a few extra columns, you will see that the Dynamic Updates have 2 categories <strong>Setup Updates</strong> and <strong>Component Updates</strong>. Also, only the <strong>Setup Updates</strong> ever seem to get superseded, while the <strong>Component Updates</strong> are all still current.<br><div class=image><figure><a href=2018-08-19_23-30-45.jpg target=_blank><img src=2018-08-19_23-30-45.jpg alt="A Square Dozen Image"></a></figure></div></p><p>When you extract them, you find that the <strong>Setup Updates</strong> are replacement files for items in the <strong>Sources</strong> directory of your Windows 10 In-Place Upgrade media. If you extract the <strong>Component Updates</strong>, you will see that they contain various drivers and such. These items all have older, corresponding items in your <strong>install.wim</strong>. As you can see in this screenshot, I mounted my install.wim then applied one of the Dynamic Update Component Update CABs and you can see the old and new files side by side.</p><p><div class=image><figure><a href=2018-08-18_13-01-52.jpg target=_blank><img src=2018-08-18_13-01-52.jpg alt="A Square Dozen Image"></a></figure></div></p><p>So, you need to get the latest Setup Update and any other Component Updates and apply them to your WIM.</p><p><strong>Side Note</strong>: If you launch Windows Setup.exe and begin the wizard, you have the option the download the latest updates - this gets the latest Dynamic Updates AND the latest Cumulative Update for the OS you are installing. So if you are installing an un-serviced image and enable Dynamic Updates, your client will go out to the internet and download an ~800 MB payload. If you check your <strong>C:$Windows.~BT</strong> folder before you complete the wizard and begin your install, you will find the following new folders. If you expand them, you will find that their contents match the contents of the Dynamic Updates that you are going to use for servicing here (What an amazing coincidence!)!!</p><p><div class=image><figure><a href=2018-08-18_11-17-08.jpg target=_blank><img src=2018-08-18_11-17-08.jpg alt="A Square Dozen Image"></a></figure></div>]</p><p>Also, you can watch your c:\Windows\WindowsUpdate.log (On Windows 7) live in CMTrace and watch Windows Update go out and get the Dynamic Updates. On Windows 10 you have to run Get-WindowsUpdateLog or something silly to get a log. (Sorry, don&rsquo;t have a screenshot yet)</p><h1 id=getting-dynamic-updates>Getting Dynamic Updates</h1><p>I&rsquo;ve reached out to Microsoft to see if they can help with a publicly available URL for Dynamic Update downloads, and if you have any info, please let me know - the only way to get the download links for Dynamic Updates is by enabling them in SCCM or in WSUS. See Gary&rsquo;s post above for more details on how to enable and download the updates. If you have Dynamic Updates enabled and can see them in your SCCM console, then you can either manually download them or use this handy script that I wrote cause I&rsquo;m too lazy! Get the scripts and save them somewhere. You will want to separate them by OS Version and Architecture.</p><p><strong>Grab the latest copy from GitHub</strong><br><a href=https://github.com/AdamGrossTX/PowershellScripts/blob/master/Windows%2010%20Servicing/Get-DynamicUpdates.ps1>https://github.com/AdamGrossTX/PowershellScripts/blob/master/Windows%2010%20Servicing/Get-DynamicUpdates.ps1</a></p><h1 id=applying-dynamic-updates>Applying Dynamic Updates</h1><p>Following the steps above, you can simply download the Dynamic Updates then apply them at the proper step when servicing your WIM. I honestly don&rsquo;t know whether it matters if you apply them before cleaning and resetting the WIM (Mike Terrill doesn&rsquo;t even clean and reset - we are all doing what seems best for our scenario). Either way, just use the same commands you are using to add your other updates. Here are some samples:</p><p>Each of these process a single update at a time, so you&rsquo;d need to add one line per KB.<br><strong>PowerShell</strong></p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-1>1</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span><span style=color:#0086b3>Add-WindowsPackage</span> -PackagePath <span style=color:#d14>&#34;C:\ImageServicing\DynamicUpdateCumulativeUpdates\KB12345566.CAB&#34;</span> -Path <span style=color:#d14>&#34;C:\ImageServicing\ImageMountFolder&#34;</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>Command Prompt (DISM.exe)</strong></p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-1>1</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span>DISM /Image<span style=color:#a61717;background-color:#e3d2d2>:</span><span style=color:#d14>&#34;C:\ImageServicing\ImageMountFolder&#34;</span> /<span style=color:#0086b3>Add-Package</span> /PackagePath<span style=color:#a61717;background-color:#e3d2d2>:</span><span style=color:#d14>&#34;C:\ImageServicing\DynamicUpdateCumulativeUpdates\KB12345566.CAB&#34;</span>
</span></span></code></pre></td></tr></table></div></div><p>You can also use this command in PowerShell to get the contents of your update folder then loop through each one for a more dynamic approach.</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-1>1</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-2>2</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-3>3</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-4>4</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span><span style=color:teal>$ImageMountFolder</span> = <span style=color:#d14>&#34;C:\ImageServicing\ImageMountFolder&#34;</span>
</span></span><span style=display:flex><span><span style=color:teal>$DUCU</span> = <span style=color:#d14>&#34;C:\ImageServicing\DynamicUpdateCumulativeUpdates&#34;</span> <span style=color:#998;font-style:italic>#Path you stored the Updates in.</span>
</span></span><span style=display:flex><span><span style=color:teal>$DUCU</span> = <span style=color:#0086b3>Get-ChildItem</span> -Path <span style=color:#d14>&#34;</span>$(<span style=color:teal>$DUCUPath</span>)<span style=color:#d14>&#34;</span> -Filter <span style=color:#d14>&#34;*.CAB&#34;</span> | <span style=color:#0086b3>Select </span>-ExpandProperty FullName
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>ForEach</span>(<span style=color:teal>$CAB</span> <span style=color:#000;font-weight:700>in</span> <span style=color:teal>$DUCU</span>) { <span style=color:#0086b3>Add-WindowsPackage</span> -PackagePath <span style=color:teal>$CAB</span> -Path <span style=color:teal>$ImageMountFolder</span> }
</span></span></code></pre></td></tr></table></div></div><h3 id=errors>ERRORS</h3><p>The commands below caused Mike Terrill and I a lot of headache. They are equivalent commands in PowerShell and with DISM.exe to recurse through a folder and apply each update found in the folder. These are the same as the much longer ForEach PowerShell approach above. However, no matter how we tried to apply the updates, if we used the commands below, when we got to the last KB for 1709 x64, DISM would report that the WIM was corrupt and that we should start over.</p><p><strong>PowerShell</strong></p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-1>1</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span><span style=color:#0086b3>Add-WindowsPackage</span> -PackagePath <span style=color:#d14>&#34;C:\ImageServicing\DynamicUpdateCumulativeUpdates&#34;</span> -Path <span style=color:#d14>&#34;C:\ImageServicing\ImageMountFolder&#34;</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>Command Prompt (DISM.exe)</strong></p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-4-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-4-1>1</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span>DISM /Image<span style=color:#a61717;background-color:#e3d2d2>:</span><span style=color:#d14>&#34;C:\ImageServicing\ImageMountFolder&#34;</span> /<span style=color:#0086b3>Add-Package</span> /PackagePath<span style=color:#a61717;background-color:#e3d2d2>:</span><span style=color:#d14>&#34;C:\ImageServicing\DynamicUpdateCumulativeUpdates&#34;</span>
</span></span></code></pre></td></tr></table></div></div><p>Here&rsquo;s the full error we got:</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-1> 1</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-2> 2</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-3> 3</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-4> 4</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-5><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-5> 5</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-6><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-6> 6</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-7><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-7> 7</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-8><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-8> 8</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-9><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-9> 9</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-10><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-10>10</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-11><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-11>11</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-12><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-12>12</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-13><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-13>13</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-14><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-14>14</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-15><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-15>15</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-16><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-16>16</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-17><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-17>17</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-18><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-18>18</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-19><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-19>19</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-20><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-20>20</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-21><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-21>21</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-22><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-22>22</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-23><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-23>23</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-24><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-24>24</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-25><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-25>25</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-26><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-26>26</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-27><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-27>27</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-28><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-28>28</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-29><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-29>29</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ini data-lang=ini><span style=display:flex><span><span style=color:teal>E:\&gt;dism /image:e:\win10\1709\mount /add-package /packagepath:e:\win10\1709\DynamicUpdates\Component\</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span><span style=color:teal>Deployment Image Servicing and Management tool</span>
</span></span><span style=display:flex><span><span style=color:teal>Version: 10.0.17134.1</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span><span style=color:teal>Image Version: 10.0.16299.611</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span><span style=color:teal>Processing 1 of 5 - Adding package Package_for_KB4055237~31bf3856ad364e35~amd64~~10.0.1.3</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>[==========================100.0%==========================]</span>
</span></span><span style=display:flex><span><span style=color:teal>Processing 2 of 5 - Adding package Package_for_KB4055994~31bf3856ad364e35~amd64~~10.0.1.0</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>[==========================100.0%==========================]</span>
</span></span><span style=display:flex><span><span style=color:teal>Processing 3 of 5 - Adding package Package_for_KB4078408~31bf3856ad364e35~amd64~~16299.245.1.0</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>[==========================100.0%==========================]</span>
</span></span><span style=display:flex><span><span style=color:teal>Processing 4 of 5 - Adding package Package_for_KB4094276~31bf3856ad364e35~amd64~~10.0.1.0</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>[==========================100.0%==========================]</span>
</span></span><span style=display:flex><span><span style=color:teal>Processing 5 of 5 - Adding package Package_for_KB4293700~31bf3856ad364e35~amd64~~10.0.1.0</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>[==========================100.0%==========================]</span>
</span></span><span style=display:flex><span><span style=color:teal>Package_for_KB4293700: The specified image is no longer serviceable and may be corrupted.</span>
</span></span><span style=display:flex><span><span style=color:teal>Discard the modified image and start again.</span>
</span></span><span style=display:flex><span><span style=color:teal>Error: 0x80070490</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span><span style=color:teal>Error: 1168</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span><span style=color:teal>The specified image is no longer serviceable and may be corrupted.</span>
</span></span><span style=display:flex><span><span style=color:teal>Discard the modified image and start again.</span>
</span></span><span style=display:flex><span><span style=color:teal>The command completed with errors.</span>
</span></span><span style=display:flex><span><span style=color:teal>For more information, refer to the log file.</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span><span style=color:teal>The DISM log file can be found at C:\WINDOWS\Logs\DISM\dism.log</span>
</span></span></code></pre></td></tr></table></div></div><p>Also, be sure to get the Setup Update and extract the cab contents to your Sources folder using:</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-6-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-6-1>1</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span>Expand FileName.CAB <span style=color:#000;font-weight:700>-f</span><span style=color:#a61717;background-color:#e3d2d2>:</span>* c:\Media\1709\Sources
</span></span></code></pre></td></tr></table></div></div><h1 id=putting-it-all-together>Putting It All Together</h1><p>As I said at the beginning, this has been a huge effort by the community to pull together the optimal process for updating our Windows media. Everything in this script was <a href=https://deploymentresearch.com/Research/Post/376/Announcement-The-most-advanced-OSD-book-yet>Stolen With Pride (© Johan Arwidmark)</a> from the community. Please read through it and ask questions and send me feedback (or even push PR&rsquo;s on GitHub).</p><p>NOTE: I used to have a copy of the script inline here but since I&rsquo;ve updated it a few times, I&rsquo;ve decided to just host it on GitHub. You can find the latest version the script and related files there. <strong><a href=https://github.com/AdamGrossTX/PowershellScripts/tree/master/Windows%2010%20Servicing>Get the latest copy from GitHub here.</a></strong></p><p>So, that&rsquo;s it for now. We all still have more testing to do but I believe we are in the home stretch. Please try this out and let us know how we can improve things. I know that David Segura is planning to update <a href=https://www.osdeploy.com/osbuilder/overview>OSBuilder</a> to add these features in, so be on the lookout for that. Mike Terrill was also going to do more testing and let me know how imaging goes. I&rsquo;m sure I&rsquo;ve missed some things or left some bugs in my code, so please be kind and let me know if you find anything. Happy Imaging!</p></div><comments id=comments><script src=https://utteranc.es/client.js repo=AdamGrossTX/asquaredozen issue-term=title label="blog comment" theme=github-light crossorigin=anonymous async></script></comments></article></div></div></div><footer id=footer><div class=container><div id=footer-copyright><p class=copyright>&copy; 2022 Adam Gross - https://www.asquaredozen.com - A Square Dozen</a></p></div></div></footer></div></body></html>