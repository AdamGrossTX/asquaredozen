<!doctype html><html lang=en-us><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=keyword content="ConfigMgr Microsoft MVP Gross Intune Windows"><meta name=viewport content="width=device-width"><meta name=description content="A.Gross Blog | Adam Gross Enterprise Mobility MVP"><link rel="shortcut icon" href=/img/favicon.ico><title>Configuring 802.1x Authentication for Windows Deployment – Part 1 – Building an 802.1x Computer Authentication Script-A Square Dozen | A. Gross Blog</title>
<link rel=canonical href=/2018/07/29/configuring-802-1x-authentication-for-windows-deployment-part-1-building-an-802-1x-computer-authentication-script/><link rel=stylesheet href=/css/style.css><link rel=stylesheet href=https://www.asquaredozen.com/css/custom.css><script src=https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js></script><script src=https://ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js></script><script src=https://www.asquaredozen.com/js/jquery.slicknav.js></script><script src=https://www.asquaredozen.com/js/asd_SlickNav_Mobile.js></script><script src=https://www.asquaredozen.com/js/custom.js></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-DYVXTRTXN4"></script><script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-DYVXTRTXN4",{anonymize_ip:!1})}</script><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://www.asquaredozen.com/img/ASquareDozen-Logo_Horiz_Twitter.png"><meta name=twitter:title content="Configuring 802.1x Authentication for Windows Deployment – Part 1 – Building an 802.1x Computer Authentication Script"><meta name=twitter:description content="This is Part 1 in my Configuring 802.1x Authentication for Windows Deployment series. Be sure to check out all of the other parts here.
The Anatomy of an 802.1x Configuration Script These are the basic steps need to be performed by your auth script. The code below is commented to help understand what each step is for.
Set Wired Autoconfig (dot3svc) service startup to Auto Start Wired Autoconfig Import Configuration Profile Import Certificates Force adapter authentication event You may be looking at this and wonder why I&rsquo;m creating a Batch file instead of using PowerShell."><meta property="og:title" content="Configuring 802.1x Authentication for Windows Deployment – Part 1 – Building an 802.1x Computer Authentication Script"><meta property="og:description" content="This is Part 1 in my Configuring 802.1x Authentication for Windows Deployment series. Be sure to check out all of the other parts here.
The Anatomy of an 802.1x Configuration Script These are the basic steps need to be performed by your auth script. The code below is commented to help understand what each step is for.
Set Wired Autoconfig (dot3svc) service startup to Auto Start Wired Autoconfig Import Configuration Profile Import Certificates Force adapter authentication event You may be looking at this and wonder why I&rsquo;m creating a Batch file instead of using PowerShell."><meta property="og:type" content="article"><meta property="og:url" content="https://www.asquaredozen.com/2018/07/29/configuring-802-1x-authentication-for-windows-deployment-part-1-building-an-802-1x-computer-authentication-script/"><meta property="og:image" content="https://www.asquaredozen.com/img/ASquareDozen-Logo_Horiz_Twitter.png"><meta property="article:section" content="posts"><meta property="article:published_time" content="2018-07-30T02:07:10+00:00"><meta property="article:modified_time" content="2018-07-30T02:07:10+00:00"><meta property="og:site_name" content="A Square Dozen | A. Gross Blog"></head><body class="home blog"><div id=asd-container><div id=top-bar><div class=container><div id=nav-wrapper><ul class=menu id=menu-top-menu><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home"><a href=/>Home</a></li><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home"><a href=#><span>Feature Updates</span></a><ul class="sub-menu menu-item menu-item-type-custom menu-item-object-custom menu-item-home"><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home"><a href=/2020/07/26/demystifying-windows-10-feature-update-blocks/>Demystifying Windows 10 Feature Update Blocks</a></li><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home"><a href=/2019/08/22/windows-10-feature-updates-leveraging-setupdiag-for-better-reporting/>Windows 10 Feature Updates – Leveraging SetupDiag for Better Reporting</a></li><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home"><a href=/2019/10/05/windows-10-feature-updates-the-challenge-of-servicing-in-the-enterprise/>Windows 10 Feature Updates – The Challenge of Servicing in the Enterprise</a></li><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home"><a href=/2019/08/25/windows-10-feature-updates-using-custom-action-scripts/>Windows 10 Feature Updates – Using Custom Action Scripts</a></li><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home"><a href=/2019/08/25/windows-10-feature-updates-using-setupconfig-ini-to-manage-feature-updates-in-the-enterprise/>Windows 10 Feature Updates – Using Setupconfig.ini to Manage Feature Updates in the Enterprise</a></li></ul></li><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home"><a href=/2019/02/12/the-system-center-configuration-manager-adminservice-guide/><span>ConfigMgr AdminService</span></a></li><li class="active menu-item menu-item-type-custom menu-item-object-custom menu-item-home"><a href=#><span>802.1x for OSD</span></a><ul class="sub-menu menu-item menu-item-type-custom menu-item-object-custom menu-item-home"><li class="active menu-item menu-item-type-custom menu-item-object-custom menu-item-home"><a href=/2018/07/29/configuring-802-1x-authentication-for-windows-deployment-part-1-building-an-802-1x-computer-authentication-script/>Part 1 – Building an 802.1x Computer Authentication Script</a></li><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home"><a href=/2018/07/29/configuring-802-1x-authentication-for-windows-deployment-part-2-building-an-802-1x-enabled-winpe-boot-image/>Part 2 – Building an 802.1x Enabled WinPE Boot Image</a></li><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home"><a href=/2018/07/29/configuring-802-1x-authentication-for-windows-deployment-part-3-integrating-802-1x-authentication-into-a-bare-metal-task-sequence/>Part 3 – Integrating 802.1x Authentication into a Bare Metal Task Sequence</a></li><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home"><a href=/2018/07/29/configuring-802-1x-authentication-for-windows-deployment-part-4-integrating-802-1x-authentication-into-an-in-place-upgrade-task-sequence/>Part 4 – Integrating 802.1x Authentication into an In-Place Upgrade Task Sequence</a></li><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home"><a href=/2018/09/29/configuring-802-1x-authentication-for-windows-deployment-part-5-dynamic-whitelisting-using-the-cisco-ise-external-restful-service/>Part 5 – Dynamic Whitelisting using the Cisco ISE External RESTful Service</a></li><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home"><a href=/2018/07/29/configuring-802-1x-authentication-for-windows-deployment-tips-and-tricks/>Tips and Tricks</a></li></ul></li><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home"><a href=#><span>Task Sequence Hacks</span></a><ul class="sub-menu menu-item menu-item-type-custom menu-item-object-custom menu-item-home"><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home"><a href=/2018/11/29/building-a-better-task-sequence/>Building a Better Task Sequence</a></li><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home"><a href=/2019/04/30/building-a-smarter-task-sequence/>Building a Smarter Task Sequence</a></li><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home"><a href=/2018/12/14/building-an-even-better-task-sequence/>Building An Even Better Task Sequence</a></li><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home"><a href=/2018/07/16/clearing-local-group-policies-during-an-windows-7-to-10-in-place-upgrade-task-sequence/>Clearing Local Group Policies during an Windows 7 to 10 In-Place Upgrade Task Sequence</a></li><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home"><a href=/2018/10/03/debugging-sccm-configmgr-task-sequences-on-the-fly/>Debugging SCCM/ConfigMgr Task Sequences on the Fly</a></li><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home"><a href=/2018/07/11/dynamically-updating-unattend-xml-during-an-osd-task-sequence-using-mdt-variables-and-zti-scripts/>Dynamically Updating Unattend.XML during an OSD Task Sequence using MDT Variables and ZTI Scripts.</a></li><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home"><a href=/2018/06/14/triggering-configmgr-client-actions-from-a-task-sequence/>Triggering ConfigMgr Client Actions from a Task Sequence</a></li><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home"><a href=/2018/08/27/using-sccm-task-sequence-variables-as-scripts/>Using SCCM Task Sequence Variables as Scripts</a></li></ul></li><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home"><a href=https://github.com/AdamGrossTX><span>GitHub</span></a></li><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home"><a href=#><span>MORE></span></a><ul class="sub-menu menu-item menu-item-type-custom menu-item-object-custom menu-item-home"><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home"><a href=/about/>About</a></li><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home"><a href=/consulting/>Consulting</a></li><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home"><a href=/contact/>Contact</a></li></ul></li></ul></div><div id=top-search><a href=# class=search><i class="fa fa-search"></i></a><div class=show-search><form role=search method=get action=https://www.google.com/search id=searchform><input type=search placeholder="Search and hit enter..." name=q id=q title="Search and hit enter...">
<input type=hidden name=sitesearch value=https://www.asquaredozen.com>
<button type=submit value=Search></form></div></div><div class=menu id=menu-mobile></div></div></div><header id=header class=noslider><div class=container><div id=logo><h1><a href=https://www.asquaredozen.com><img src=/img/A-Square-Dozen-Logo-BlogHeader-1.png alt="A Square Dozen"></a></h1></div></div></header><div class=container><div id=content><div id=main class=fullwidth><article class="post type-post status-publish format-standard has-post-thumbnail hentry"><div class=post-header><h1>Configuring 802.1x Authentication for Windows Deployment – Part 1 – Building an 802.1x Computer Authentication Script</h1><span class=post-date>July 30, 2018</span></div><div class=post-entry><p>This is Part 1 in my <a href=http://www.asquaredozen.com/2018/07/29/configuring-802-1x-authentication-for-windows-deployment/>Configuring 802.1x Authentication for Windows Deployment</a> series. Be sure to check out all of the other parts <a href=http://www.asquaredozen.com/2018/07/29/configuring-802-1x-authentication-for-windows-deployment/>here</a>.</p><h1 id=the-anatomy-of-an-8021x-configuration-script>The Anatomy of an 802.1x Configuration Script</h1><p>These are the basic steps need to be performed by your auth script. The code below is commented to help understand what each step is for.</p><ul><li>Set Wired Autoconfig (dot3svc) service startup to Auto</li><li>Start Wired Autoconfig</li><li>Import Configuration Profile</li><li>Import Certificates</li><li>Force adapter authentication event</li></ul><p>You may be looking at this and wonder why I&rsquo;m creating a Batch file instead of using PowerShell. Well, I made one with PowerShell but found that our Windows 7 machines had PowerShell 3.0 installed and some of my cmdlets wouldn&rsquo;t work. The Batch file is robust enough to just work in all cases, so it wins. Plus, it&rsquo;s easier for anyone to edit/support without needing PowerShell skills. Who knows, I may post the PS code at the end of the series.</p><p>Save this code as ImportComputerAuthProfile.bat</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-1> 1</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-2> 2</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-3> 3</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-4> 4</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-5><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-5> 5</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-6><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-6> 6</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-7><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-7> 7</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-8><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-8> 8</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-9><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-9> 9</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-10><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-10>10</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-11><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-11>11</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-12><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-12>12</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-13><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-13>13</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-14><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-14>14</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-15><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-15>15</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-16><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-16>16</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-17><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-17>17</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-18><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-18>18</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-19><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-19>19</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-20><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-20>20</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-21><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-21>21</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-22><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-22>22</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-23><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-23>23</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-24><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-24>24</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-25><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-25>25</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-26><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-26>26</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-27><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-27>27</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-28><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-28>28</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-29><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-29>29</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-30><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-30>30</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-31><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-31>31</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-32><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-32>32</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-33><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-33>33</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-34><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-34>34</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-35><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-35>35</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-36><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-36>36</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span>REM this line will fail <span style=color:#000;font-weight:700>in</span> PE but is needed <span style=color:#000;font-weight:700>in</span> Windows
</span></span><span style=display:flex><span>REM <span style=color:#0086b3>set </span>the Wired AutoConfig service to automatically <span style=color:#0086b3>start
</span></span></span><span style=display:flex><span><span style=color:#0086b3>sc </span>config <span style=color:#d14>&#34;dot3svc&#34;</span> start= auto
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>REM <span style=color:#0086b3>start </span>the Wired AutoConfig service
</span></span><span style=display:flex><span>Net <span style=color:#0086b3>Start </span>dot3svc
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>REM Import Root certificate
</span></span><span style=display:flex><span>certutil.exe -addstore Root <span style=color:#d14>&#34;%~dp0Certs\root.cer&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>REM Import Computer Certificate
</span></span><span style=display:flex><span>certutil.exe -ImportPFX <span style=color:#000;font-weight:700>-f</span> -p P<span style=color:teal>@ssword</span> <span style=color:#d14>&#34;%~dp0Certs\ComputerAuthCert.pfx&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>REM Import Computer Auth Profile to all LAN interfaces
</span></span><span style=display:flex><span>netsh lan add profile filename=<span style=color:#d14>&#34;%~dp0ComputerAuthProfile.xml&#34;</span> interface=*
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>REM Force all interfaces to reconnect
</span></span><span style=display:flex><span>netsh lan reconnect interface=*
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>REM change the interface name to match your interface name(s). We have <span style=color:#099>2</span> <span style=color:#000;font-weight:700>in</span> our environment.
</span></span><span style=display:flex><span>REM Disable then Enable the adapter named Ethernet
</span></span><span style=display:flex><span>netsh interface <span style=color:#0086b3>set </span>interface name=<span style=color:#d14>&#34;ethernet&#34;</span> admin=DISABLED
</span></span><span style=display:flex><span>netsh interface <span style=color:#0086b3>set </span>interface name=<span style=color:#d14>&#34;ethernet&#34;</span> admin=ENABLED
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>REM Disable then Enable the adapter named Local Area Connection
</span></span><span style=display:flex><span>netsh interface <span style=color:#0086b3>set </span>interface name=<span style=color:#d14>&#34;Local Area Connection&#34;</span> admin=DISABLED
</span></span><span style=display:flex><span>netsh interface <span style=color:#0086b3>set </span>interface name=<span style=color:#d14>&#34;Local Area Connection&#34;</span> admin=ENABLED
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>REM Pause the script <span style=color:#000;font-weight:700>for</span> <span style=color:#099>30</span> seconds to allow the adapter to Auth
</span></span><span style=display:flex><span>ping localhost -n <span style=color:#099>30</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>REM Show the interface to see the status and show profiles to see which profile is applied.
</span></span><span style=display:flex><span>netsh lan show interfaces
</span></span><span style=display:flex><span>netsh lan show profiles
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>REM Add &gt;&gt; C:\Temp\LogFileName.log to any line to pipe the results to a log file.
</span></span></code></pre></td></tr></table></div></div><h1 id=creating-a-computer-authentication-profile>Creating a Computer Authentication Profile</h1><p>Each LAN interface can only have 1 Profile applied to it at any time. If you manually configure the profile then apply GPO, the GPO profile will take the place of the local profile. More on this in the Tips and Tricks post. When you are first configuring and testing your script, it may be helpful to take the working GPO profile and use it to start with, however, if you need to make any customizations or adjustments to the profile, be sure to work from a machine that doesn&rsquo;t have an 802.1x GPO applied. Also, your script will fail to import your custom profile if an 802.1x GPO is applied, so you will need a non-GPO machine to test with anyway.</p><h3 id=group-policy-created-profile>Group Policy Created Profile</h3><p>Skip to the Export steps below</p><h3 id=manually-creating-a-profile>Manually Creating A Profile</h3><p>Start this process on a clean machine that doesn&rsquo;t have IEEE 802.1x Policies applied, otherwise you will have trouble. You can configure 802.1x Authentication on your LAN adapter in Windows by going to the Network Connections pane in the Control Panel. From there, right click on the adapter and click on the Authentication tab. If you don&rsquo;t see it, you will need to go enable and start the <strong>Wired Autoconfig</strong> service. Now you can configure authentication to match what is expected by your 802.1x service.</p><p>**Note:**When I exported my config then tested in Windows on another machine, it all worked fine, but when I tested in WinPE, I found that authentication would fail. I talked with my Security guy and he suggested removing the <strong>Verify server&rsquo;s identity&mldr;</strong> checkboxes from the profile. Once we did that WinPE authentication began working.</p><p><a href=/2018/07/29/configuring-802-1x-authentication-for-windows-deployment-part-2-building-an-802-1x-enabled-winpe-boot-image/8021x_1/><div class=image><figure><a href=8021x_1.jpg target=_blank><img src=8021x_1.jpg alt="A Square Dozen Image"></a></figure></div></a></p><p>To create your own profile, follow the screen shots below (Note:GPO is applied in these, so everything is greyed out).</p><p><a href=/2018/07/29/configuring-802-1x-authentication-for-windows-deployment-part-2-building-an-802-1x-enabled-winpe-boot-image/8021x_2/><div class=image><figure><a href=8021x_2.jpg target=_blank><img src=8021x_2.jpg alt="A Square Dozen Image"></a></figure></div></a></p><p><a href=/2018/07/29/configuring-802-1x-authentication-for-windows-deployment-part-2-building-an-802-1x-enabled-winpe-boot-image/8021x_3/><div class=image><figure><a href=8021x_3.jpg target=_blank><img src=8021x_3.jpg alt="A Square Dozen Image"></a></figure></div></a></p><p><a href=/2018/07/29/configuring-802-1x-authentication-for-windows-deployment-part-2-building-an-802-1x-enabled-winpe-boot-image/8021x_4/><div class=image><figure><a href=8021x_4.jpg target=_blank><img src=8021x_4.jpg alt="A Square Dozen Image"></a></figure></div></a></p><h1 id=exporting-your-profile>Exporting Your Profile</h1><p>Follow these steps to export your profile into an XML file.<br>Show the interfaces on the system.</p><p><code>netsh lan show interfaces</code></p><p>Use the interface name from the previous command in the interface=&rsquo;&rsquo; parameter below</p><p><code>netsh lan export profile folder=c:\temp interface="Ethernet"</code></p><p>Grab the XML file and rename it to ComputerAuthProfile.xml and save it with your batch file.</p><p>Here&rsquo;s a copy of a working WinPE Computer Authentication profile. Your mileage my vary.</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-1> 1</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-2> 2</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-3> 3</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-4> 4</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-5><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-5> 5</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-6><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-6> 6</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-7><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-7> 7</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-8><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-8> 8</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-9><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-9> 9</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-10><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-10>10</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-11><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-11>11</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-12><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-12>12</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-13><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-13>13</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-14><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-14>14</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-XML data-lang=XML><span style=display:flex><span><span style=color:navy>&lt;LANProfile</span> <span style=color:teal>xmlns=</span><span style=color:#d14>&#34;http://www.microsoft.com/networking/LAN/profile/v1&#34;</span><span style=color:navy>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:navy>&lt;MSM&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:navy>&lt;security&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:navy>&lt;OneXEnforced&gt;</span>false<span style=color:navy>&lt;/OneXEnforced&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:navy>&lt;OneXEnabled&gt;</span>true<span style=color:navy>&lt;/OneXEnabled&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:navy>&lt;OneX</span> <span style=color:teal>xmlns=</span><span style=color:#d14>&#34;http://www.microsoft.com/networking/OneX/v1&#34;</span><span style=color:navy>&gt;</span>
</span></span><span style=display:flex><span>                <span style=color:navy>&lt;cacheUserData&gt;</span>false<span style=color:navy>&lt;/cacheUserData&gt;</span>
</span></span><span style=display:flex><span>                <span style=color:navy>&lt;maxAuthFailures&gt;</span>3<span style=color:navy>&lt;/maxAuthFailures&gt;</span>
</span></span><span style=display:flex><span>                <span style=color:navy>&lt;authMode&gt;</span>machine<span style=color:navy>&lt;/authMode&gt;</span>
</span></span><span style=display:flex><span>                <span style=color:navy>&lt;EAPConfig&gt;&lt;EapHostConfig</span> <span style=color:teal>xmlns=</span><span style=color:#d14>&#34;http://www.microsoft.com/provisioning/EapHostConfig&#34;</span><span style=color:navy>&gt;&lt;EapMethod&gt;&lt;Type</span> <span style=color:teal>xmlns=</span><span style=color:#d14>&#34;http://www.microsoft.com/provisioning/EapCommon&#34;</span><span style=color:navy>&gt;</span>25<span style=color:navy>&lt;/Type&gt;&lt;VendorId</span> <span style=color:teal>xmlns=</span><span style=color:#d14>&#34;http://www.microsoft.com/provisioning/EapCommon&#34;</span><span style=color:navy>&gt;</span>0<span style=color:navy>&lt;/VendorId&gt;&lt;VendorType</span> <span style=color:teal>xmlns=</span><span style=color:#d14>&#34;http://www.microsoft.com/provisioning/EapCommon&#34;</span><span style=color:navy>&gt;</span>0<span style=color:navy>&lt;/VendorType&gt;&lt;AuthorId</span> <span style=color:teal>xmlns=</span><span style=color:#d14>&#34;http://www.microsoft.com/provisioning/EapCommon&#34;</span><span style=color:navy>&gt;</span>0<span style=color:navy>&lt;/AuthorId&gt;&lt;/EapMethod&gt;&lt;Config</span> <span style=color:teal>xmlns=</span><span style=color:#d14>&#34;http://www.microsoft.com/provisioning/EapHostConfig&#34;</span><span style=color:navy>&gt;&lt;Eap</span> <span style=color:teal>xmlns=</span><span style=color:#d14>&#34;http://www.microsoft.com/provisioning/BaseEapConnectionPropertiesV1&#34;</span><span style=color:navy>&gt;&lt;Type&gt;</span>25<span style=color:navy>&lt;/Type&gt;&lt;EapType</span> <span style=color:teal>xmlns=</span><span style=color:#d14>&#34;http://www.microsoft.com/provisioning/MsPeapConnectionPropertiesV1&#34;</span><span style=color:navy>&gt;&lt;ServerValidation&gt;&lt;DisableUserPromptForServerValidation&gt;</span>false<span style=color:navy>&lt;/DisableUserPromptForServerValidation&gt;&lt;ServerNames&gt;&lt;/ServerNames&gt;&lt;/ServerValidation&gt;&lt;FastReconnect&gt;</span>true<span style=color:navy>&lt;/FastReconnect&gt;&lt;InnerEapOptional&gt;</span>false<span style=color:navy>&lt;/InnerEapOptional&gt;&lt;Eap</span> <span style=color:teal>xmlns=</span><span style=color:#d14>&#34;http://www.microsoft.com/provisioning/BaseEapConnectionPropertiesV1&#34;</span><span style=color:navy>&gt;&lt;Type&gt;</span>13<span style=color:navy>&lt;/Type&gt;&lt;EapType</span> <span style=color:teal>xmlns=</span><span style=color:#d14>&#34;http://www.microsoft.com/provisioning/EapTlsConnectionPropertiesV1&#34;</span><span style=color:navy>&gt;&lt;CredentialsSource&gt;&lt;CertificateStore&gt;&lt;SimpleCertSelection&gt;</span>true<span style=color:navy>&lt;/SimpleCertSelection&gt;&lt;/CertificateStore&gt;&lt;/CredentialsSource&gt;&lt;ServerValidation&gt;&lt;DisableUserPromptForServerValidation&gt;</span>false<span style=color:navy>&lt;/DisableUserPromptForServerValidation&gt;&lt;ServerNames&gt;&lt;/ServerNames&gt;&lt;/ServerValidation&gt;&lt;DifferentUsername&gt;</span>false<span style=color:navy>&lt;/DifferentUsername&gt;&lt;PerformServerValidation</span> <span style=color:teal>xmlns=</span><span style=color:#d14>&#34;http://www.microsoft.com/provisioning/EapTlsConnectionPropertiesV2&#34;</span><span style=color:navy>&gt;</span>false<span style=color:navy>&lt;/PerformServerValidation&gt;&lt;AcceptServerName</span> <span style=color:teal>xmlns=</span><span style=color:#d14>&#34;http://www.microsoft.com/provisioning/EapTlsConnectionPropertiesV2&#34;</span><span style=color:navy>&gt;</span>false<span style=color:navy>&lt;/AcceptServerName&gt;&lt;/EapType&gt;&lt;/Eap&gt;&lt;EnableQuarantineChecks&gt;</span>false<span style=color:navy>&lt;/EnableQuarantineChecks&gt;&lt;RequireCryptoBinding&gt;</span>false<span style=color:navy>&lt;/RequireCryptoBinding&gt;&lt;PeapExtensions&gt;&lt;PerformServerValidation</span> <span style=color:teal>xmlns=</span><span style=color:#d14>&#34;http://www.microsoft.com/provisioning/MsPeapConnectionPropertiesV2&#34;</span><span style=color:navy>&gt;</span>false<span style=color:navy>&lt;/PerformServerValidation&gt;&lt;AcceptServerName</span> <span style=color:teal>xmlns=</span><span style=color:#d14>&#34;http://www.microsoft.com/provisioning/MsPeapConnectionPropertiesV2&#34;</span><span style=color:navy>&gt;</span>false<span style=color:navy>&lt;/AcceptServerName&gt;&lt;/PeapExtensions&gt;&lt;/EapType&gt;&lt;/Eap&gt;&lt;/Config&gt;&lt;/EapHostConfig&gt;&lt;/EAPConfig&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:navy>&lt;/OneX&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:navy>&lt;/security&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:navy>&lt;/MSM&gt;</span>
</span></span><span style=display:flex><span><span style=color:navy>&lt;/LANProfile&gt;</span>
</span></span></code></pre></td></tr></table></div></div><h1 id=gathering-your-certificates>Gathering your Certificates</h1><p>You will need to export your Root CA Certificate and a Computer certificate to use. I just went into my local certificate store and exported them. The root cert should be a .cer extension. The computer cert (Client Authentication) should contain the private key and be password protected (pick any password - you will need to add it to the batch file). Save the computer cert as a .pfx extension. Name them <strong>Root.cer</strong> and <strong>ComputerAuthCert.pfx</strong> and put them in a <strong>Certs</strong> folder with your batch file. If you need help with this step, please consult <em>The Googler</em>, there are plenty of great resources for this.</p><h1 id=putting-it-all-together>Putting It All Together</h1><p>At this point, you should have the following:</p><ul><li><strong>ImportComputerAuthProfile.bat</strong> - A 802.1x configuration script (A De-ISE-ing script for Cisco ISE).</li><li><strong>ComputerAuthProfile.xml</strong> - A computer authentication profile XML file</li><li><strong>Root.cer</strong> - A valid root CA Certificate</li><li><strong>ComputerAuthCert.pfx</strong> - A valid computer certificate (any valid AD joined device should work)</li></ul><p>Place all of the files into the same folder with the certificates in a sub folder named <strong>Certs</strong>. Update the batch file with the password that you selected for your computer certificate and ensure that all of the other pathing in the script matches what you have. To test, you will need a machine that doesn&rsquo;t have an 802.1x group policy already applied. Run the script. You should see the adapter attempting authentication and then connect to your 802.1x network. If it fails, reconfigure and re-export the profile and or certs and try again.</p><p>Part 2 covers configuring WinPE for 802.1x.</p></div><comments id=comments><script src=https://utteranc.es/client.js repo=AdamGrossTX/asquaredozen issue-term=title label="blog comment" theme=github-light crossorigin=anonymous async></script></comments></article></div></div></div><footer id=footer><div class=container><div id=footer-copyright><p class=copyright>&copy; 2024 Adam Gross - https://www.asquaredozen.com - A Square Dozen</a></p></div></div></footer></div></body></html>