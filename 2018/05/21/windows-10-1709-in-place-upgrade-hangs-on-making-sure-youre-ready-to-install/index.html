<!DOCTYPE html>
<html lang="en-us">
	    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="keyword"  content="ConfigMgr Microsoft MVP Gross Intune Windows">
        <meta name="viewport" content="width=device-width">
        <meta name="description" content="A.Gross Blog | Adam Gross Enterprise Mobility MVP">
        
        <link rel="shortcut icon" href="/img/favicon.ico">
        <title>Windows 10 1709 In-Place Upgrade Hangs on Making sure you&#39;re ready to install-A Square Dozen | A. Gross Blog</title>
        <link rel="canonical" href="/2018/05/21/windows-10-1709-in-place-upgrade-hangs-on-making-sure-youre-ready-to-install/">

        
        <link rel="stylesheet" href="/css/style.css">
        <link rel="stylesheet" href="/css/code.css">
        <link rel="stylesheet" type="text/css" href="https://blog.asquaredozen.com/css/custom.css">
        

        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js"></script>
        <script src="https://blog.asquaredozen.com/js/jquery.slicknav.js"></script>
        <script src="https://blog.asquaredozen.com/js/asd_SlickNav_Mobile.js"></script>
        <script src="https://blog.asquaredozen.com/js/custom.js"></script>

        

        
        
        

        
        
<script async src="https://www.googletagmanager.com/gtag/js?id=G-DYVXTRTXN4"></script>
<script>
var doNotTrack = false;
if (!doNotTrack) {
	window.dataLayer = window.dataLayer || [];
	function gtag(){dataLayer.push(arguments);}
	gtag('js', new Date());
	gtag('config', 'G-DYVXTRTXN4', { 'anonymize_ip': false });
}
</script>

        <meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://blog.asquaredozen.com/105"/>

<meta name="twitter:title" content="Windows 10 1709 In-Place Upgrade Hangs on Making sure you&#39;re ready to install"/>
<meta name="twitter:description" content="UPDATE #3 - 6/28/2018 Feel free to read below, however, if you want the quick solution, check out Marc&rsquo;s updated blog post. He&rsquo;s put together a simple solution to this issue.
http://blog.ctglobalservices.com/configuration-manager-sccm/mag/devicemap-and-device-inventory-failures-in-win7-to-win10-1709-in-place-upgrades/
UPDATE #2 - 5/24/2018 After posting this, I came across these https://twitter.com/jarwidmark/status/998591545392685057 and http://blog.ctglobalservices.com/configuration-manager-sccm/mag/devicemap-and-device-inventory-failures-in-win7-to-win10-1709-in-place-upgrades/ which indicated that the fix was to update the devinv.dll file in Sources directory of your Windows 10 Upgrade media. This led me to finding out that KB2952664 updates devinv."/>

        

    </head>
		<body class="home blog">
			<div id="asd-container">
				
				
<div id="top-bar">
    <div class="container">
        <div id="nav-wrapper">
                <ul class="menu" id="menu-top-menu">
                    <li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
                        <a href="/">Home</a>
                    </li>
                    
                    
                        
                            <li class=" menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
                                <a href="#">
                                    
                                    <span>Feature Updates</span>
                                </a>
                                <ul class="sub-menu menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
                                    
                                        <li class=" menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
                                            <a href="/2019/08/22/windows-10-feature-updates-leveraging-setupdiag-for-better-reporting/">Windows 10 Feature Updates – Leveraging SetupDiag for Better Reporting</a>
                                        </li>
                                    
                                        <li class=" menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
                                            <a href="/2019/10/05/windows-10-feature-updates-the-challenge-of-servicing-in-the-enterprise/">Windows 10 Feature Updates – The Challenge of Servicing in the Enterprise</a>
                                        </li>
                                    
                                        <li class=" menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
                                            <a href="/2019/08/25/windows-10-feature-updates-using-custom-action-scripts/">Windows 10 Feature Updates – Using Custom Action Scripts</a>
                                        </li>
                                    
                                        <li class=" menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
                                            <a href="/2019/08/25/windows-10-feature-updates-using-setupconfig-ini-to-manage-feature-updates-in-the-enterprise/">Windows 10 Feature Updates – Using Setupconfig.ini to Manage Feature Updates in the Enterprise</a>
                                        </li>
                                    
                                </ul>
                            </li>
                        
                    
                        
                            <li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
                                <a href="/2019/02/12/the-system-center-configuration-manager-adminservice-guide/">
                                    
                                    <span>ConfigMgr AdminService</span>
                                </a>
                            </li>
                        
                    
                        
                            <li class=" menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
                                <a href="#">
                                    
                                    <span>802.1x for OSD</span>
                                </a>
                                <ul class="sub-menu menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
                                    
                                        <li class=" menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
                                            <a href="/2018/07/29/configuring-802-1x-authentication-for-windows-deployment-part-1-building-an-802-1x-computer-authentication-script/">Part 1 – Building an 802.1x Computer Authentication Script</a>
                                        </li>
                                    
                                        <li class=" menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
                                            <a href="/2018/07/29/configuring-802-1x-authentication-for-windows-deployment-part-2-building-an-802-1x-enabled-winpe-boot-image/">Part 2 – Building an 802.1x Enabled WinPE Boot Image</a>
                                        </li>
                                    
                                        <li class=" menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
                                            <a href="/2018/07/29/configuring-802-1x-authentication-for-windows-deployment-part-3-integrating-802-1x-authentication-into-a-bare-metal-task-sequence/">Part 3 – Integrating 802.1x Authentication into a Bare Metal Task Sequence</a>
                                        </li>
                                    
                                        <li class=" menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
                                            <a href="/2018/07/29/configuring-802-1x-authentication-for-windows-deployment-part-4-integrating-802-1x-authentication-into-an-in-place-upgrade-task-sequence/">Part 4 – Integrating 802.1x Authentication into an In-Place Upgrade Task Sequence</a>
                                        </li>
                                    
                                        <li class=" menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
                                            <a href="/2018/09/29/configuring-802-1x-authentication-for-windows-deployment-part-5-dynamic-whitelisting-using-the-cisco-ise-external-restful-service/">Part 5 – Dynamic Whitelisting using the Cisco ISE External RESTful Service</a>
                                        </li>
                                    
                                        <li class=" menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
                                            <a href="/2018/07/29/configuring-802-1x-authentication-for-windows-deployment-tips-and-tricks/">Tips and Tricks</a>
                                        </li>
                                    
                                </ul>
                            </li>
                        
                    
                        
                            <li class=" menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
                                <a href="#">
                                    
                                    <span>Task Sequence Hacks</span>
                                </a>
                                <ul class="sub-menu menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
                                    
                                        <li class=" menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
                                            <a href="/2018/11/29/building-a-better-task-sequence/">Building a Better Task Sequence</a>
                                        </li>
                                    
                                        <li class=" menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
                                            <a href="/2019/04/30/building-a-smarter-task-sequence/">Building a Smarter Task Sequence</a>
                                        </li>
                                    
                                        <li class=" menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
                                            <a href="/2018/12/14/building-an-even-better-task-sequence/">Building An Even Better Task Sequence</a>
                                        </li>
                                    
                                        <li class=" menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
                                            <a href="/2018/07/16/clearing-local-group-policies-during-an-windows-7-to-10-in-place-upgrade-task-sequence/">Clearing Local Group Policies during an Windows 7 to 10 In-Place Upgrade Task Sequence</a>
                                        </li>
                                    
                                        <li class=" menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
                                            <a href="/2018/10/03/debugging-sccm-configmgr-task-sequences-on-the-fly/">Debugging SCCM/ConfigMgr Task Sequences on the Fly</a>
                                        </li>
                                    
                                        <li class=" menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
                                            <a href="/2018/07/11/dynamically-updating-unattend-xml-during-an-osd-task-sequence-using-mdt-variables-and-zti-scripts/">Dynamically Updating Unattend.XML during an OSD Task Sequence using MDT Variables and ZTI Scripts.</a>
                                        </li>
                                    
                                        <li class=" menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
                                            <a href="/2018/06/14/triggering-configmgr-client-actions-from-a-task-sequence/">Triggering ConfigMgr Client Actions from a Task Sequence</a>
                                        </li>
                                    
                                        <li class=" menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
                                            <a href="/2018/08/27/using-sccm-task-sequence-variables-as-scripts/">Using SCCM Task Sequence Variables as Scripts</a>
                                        </li>
                                    
                                </ul>
                            </li>
                        
                    
                        
                            <li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
                                <a href="https://github.com/AdamGrossTX">
                                    
                                    <span>GitHub</span>
                                </a>
                            </li>
                        
                    
                        
                            <li class=" menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
                                <a href="#">
                                    
                                    <span>MORE&gt;</span>
                                </a>
                                <ul class="sub-menu menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
                                    
                                        <li class=" menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
                                            <a href="/about/">About</a>
                                        </li>
                                    
                                        <li class=" menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
                                            <a href="/consulting/">Consulting</a>
                                        </li>
                                    
                                        <li class=" menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
                                            <a href="/contact/">Contact</a>
                                        </li>
                                    
                                </ul>
                            </li>
                        
                    
                </ul>
        </div>
        <div class="menu" id="menu-mobile"></div>
    </div>
    <div id="top-search">
        <a href="#" class="search"><i class="fa fa-search"></i></a>
        <div class="show-search">
            <form role="search" method="get" action="https://www.google.com/search" id="searchform">
                <input type="search" placeholder="Search and hit enter..." value="" name="s" id="s" title="Search and hit enter...">
                <input type="hidden" name="sitesearch" value="asquaredozen.com">
                <button type="submit" value="Search"/>
            </form>
        </div>
    </div>
</div>

				<header id="header" class="noslider">
	<div class="container">
		<div id="logo">
			<h1><a href="https://blog.asquaredozen.com"><img src="/img/A-Square-Dozen-Logo-BlogHeader-1.png" alt="A Square Dozen" /></a></h1>
		</div>
	</div>
</header>
				<div class="container">
					<div id="content">
						
<div id="main" class="fullwidth">
		<article class="post type-post status-publish format-standard has-post-thumbnail hentry">
			<div class="post-header">
				<h1>Windows 10 1709 In-Place Upgrade Hangs on Making sure you&#39;re ready to install</h1>
				<span class="post-date">May 21, 2018</span>
			</div>
			<div class="post-entry">
				<h1 id="update-3---6282018"><strong>UPDATE #3 - 6/28/2018</strong></h1>
<p>Feel free to read below, however, if you want the quick solution, check out Marc&rsquo;s updated blog post. He&rsquo;s put together a simple solution to this issue.<br>
<a href="http://blog.ctglobalservices.com/configuration-manager-sccm/mag/devicemap-and-device-inventory-failures-in-win7-to-win10-1709-in-place-upgrades/">http://blog.ctglobalservices.com/configuration-manager-sccm/mag/devicemap-and-device-inventory-failures-in-win7-to-win10-1709-in-place-upgrades/</a></p>
<h1 id="update-2---5242018"><strong>UPDATE #2 - 5/24/2018</strong></h1>
<p>After posting this, I came across these <a href="https://twitter.com/jarwidmark/status/998591545392685057">https://twitter.com/jarwidmark/status/998591545392685057</a> and <a href="http://blog.ctglobalservices.com/configuration-manager-sccm/mag/devicemap-and-device-inventory-failures-in-win7-to-win10-1709-in-place-upgrades/">http://blog.ctglobalservices.com/configuration-manager-sccm/mag/devicemap-and-device-inventory-failures-in-win7-to-win10-1709-in-place-upgrades/</a> which indicated that the fix was to update the devinv.dll file in Sources directory of your Windows 10 Upgrade media. This led me to finding out that KB2952664 updates devinv.dll to a new version. Also, I found that my Windows 7 Reference image already had a version of both the hotfix and the dll - version 10.0.14979.1011 from 12/31/2016.<br>
<div class="image">
  <figure>
    <a href="KB2952664-22.jpg" target="_blank">
      <img src="KB2952664-22.jpg" alt="A Square Dozen Image">
    </a>
    
  </figure>
</div></p>
<h2 id="updated-fix"><strong>Updated Fix</strong></h2>
<p>Using the instructions from <a href="https://twitter.com/surferstylee13">Mark Graham (@surferstylee13)</a><a href="http://blog.ctglobalservices.com/configuration-manager-sccm/mag/devicemap-and-device-inventory-failures-in-win7-to-win10-1709-in-place-upgrades/">http://blog.ctglobalservices.com/configuration-manager-sccm/mag/devicemap-and-device-inventory-failures-in-win7-to-win10-1709-in-place-upgrades/</a> I have added the latest version of <strong>devinv.dll</strong> to my upgrade media and in my In-Place Upgrade TS, instead of uninstalling the hotfix (which also seems to work, but I don&rsquo;t know the side effects of removing it), I&rsquo;m installing the latest version which I&rsquo;ve downloaded from the <a href="https://www.catalog.update.microsoft.com/Search.aspx?q=kb2952664">Windows Update Catalog</a>. According to the file name, <strong>KB2952664</strong> is on revision 24. I haven&rsquo;t found an easy to find which version of the KB you have installed other than checking the file versions.</p>
<ol>
<li>Make the changes to the <strong>Prepare for Upgrade</strong> section.<br>
<div class="image">
  <figure>
    <a href="KB2952664-23.jpg" target="_blank">
      <img src="KB2952664-23.jpg" alt="A Square Dozen Image">
    </a>
    
  </figure>
</div></li>
<li>On the Check if KB2952664 group&rsquo;s Options tab, add a condition to check for the file version information. This will allow us to only apply the patch if the file isn&rsquo;t current.<br>
<div class="image">
  <figure>
    <a href="KB2952664-26.jpg" target="_blank">
      <img src="KB2952664-26.jpg" alt="A Square Dozen Image">
    </a>
    
  </figure>
</div>  <div class="image">
  <figure>
    <a href="KB2952664-25.jpg" target="_blank">
      <img src="KB2952664-25.jpg" alt="A Square Dozen Image">
    </a>
    
  </figure>
</div></li>
<li>Add the new install command line for the KB. Make sure to update the MSU filename to match what you download from the catalog. <div class="image">
  <figure>
    <a href="KB2952664-24.jpg" target="_blank">
      <img src="KB2952664-24.jpg" alt="A Square Dozen Image">
    </a>
    
  </figure>
</div><br>
<code>wusa windows6.1-kb2952664-v24-x64_cd95eff6a0b4dc190709f9a0e7a00f782a74ee5c.msu /quiet /norestart</code></li>
</ol>
<h2 id="side-note">Side Note</h2>
<p>I began seeing this issue on 5/18/2018 My Windows 7 Reference Image was captured on 5/18/2017, so when I was looking through install dates for updates, I completely missed that the KB was a year old. This led me down a rabbit hole trying to figure out how it was getting installed.</p>
<hr>
<h1 id="update-1---5212018"><strong>UPDATE #1 - 5/21/2018</strong></h1>
<p>I just found a possible alternative root cause and workaround. I&rsquo;m going to test and update if needed. <a href="https://twitter.com/jarwidmark/status/998591545392685057">https://twitter.com/jarwidmark/status/998591545392685057</a> and <a href="http://blog.ctglobalservices.com/configuration-manager-sccm/mag/devicemap-and-device-inventory-failures-in-win7-to-win10-1709-in-place-upgrades/">http://blog.ctglobalservices.com/configuration-manager-sccm/mag/devicemap-and-device-inventory-failures-in-win7-to-win10-1709-in-place-upgrades/</a></p>
<hr>
<p><strong>TL;DR</strong> - When you attempt to upgrade Windows 7 to Windows 10 1709, the upgrade may hang at &lsquo;<strong>Making sure you&rsquo;re ready to install</strong>&rsquo;, or if you are installing silently, SetupHost.exe will show 00 CPU usage after the first few minutes and setupact.log will not change in size and will be under 200KB. <strong>Uninstall KB2952664</strong> and try the upgrade again.</p>
<p>Last week we were putting the final touches on our ConfigMgr Task Sequence which combines Bare Metal, Replace, In-Place Upgrade and Failed Image Recovery into one Task Sequence. We had fully tested our In-Place upgrade a month ago and everything was working fine. After testing some changes for the other scenarios, we began re-testing the In-Place Upgrade scenario. I built 4 VMWare VM&rsquo;s and a Lenovo laptop to test with. I started the upgrades around 10 AM and left them running. I checked back on them around 1:45 PM and found that they were <strong>ALL</strong> still on the Upgrade Operating System step of the Task Sequence. I spent the next 2 days trying to find the root cause. Here&rsquo;s what I found:</p>
<h1 id="symptoms">Symptoms</h1>
<p><strong>Note:</strong> For these tests, I used the Windows 10 1709 base media as well as offline serviced media with the latest updates applied. The results were the same.</p>
<h2 id="when-running-from-a-configmgr-task-sequence">When running from a ConfigMgr Task Sequence</h2>
<ul>
<li>Task Sequence Progress UI will be stuck on the Upgrade Operating System Task Sequence step indefinitely</li>
<li>The last step in smsts.log will show an entry with the Windows setup.exe command line but not show any progress after this entry</li>
</ul>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-batch" data-lang="batch"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="1"><a style="outline: none; text-decoration:none; color:inherit" href="#1">1</a></span>Executing command line: <span style="color:#d14">&#34;C:\_SMSTaskSequence\Packages\XXX00E99\SETUP.EXE&#34;</span> /ImageIndex 3 /auto Upgrade /quiet /noreboot /postoobe <span style="color:#d14">&#34;C:\WINDOWS\SMSTSPostUpgrade\SetupComplete.cmd&#34;</span> /postrollback <span style="color:#d14">&#34;C:\WINDOWS\SMSTSPostUpgrade\SetupRollback.cmd&#34;</span> /installdrivers <span style="color:#d14">&#34;C:\_SMSTaskSequence\Drivers&#34;</span> /DynamicUpdate Enable /pkey NPPR9-FWDCX-D2C8J-H872K-2YT43
</code></pre></div><ul>
<li>The setupact.log under c:$WINDOWS.~BT\Sources\Panther will be ~200 KB (depends on the device) and won&rsquo;t get updated after the first few mins.<br>
<div class="image">
  <figure>
    <a href="KB2952664-12.jpg" target="_blank">
      <img src="KB2952664-12.jpg" alt="A Square Dozen Image">
    </a>
    
  </figure>
</div></li>
<li>Task Manager will show setup.exe and SetupHost.exe in the task list, but CPU usage on both will show 00.<br>
<div class="image">
  <figure>
    <a href="KB2952664-11.jpg" target="_blank">
      <img src="KB2952664-11.jpg" alt="A Square Dozen Image">
    </a>
    
  </figure>
</div></li>
<li>Once you&rsquo;ve determined that the installer is hung, you can kill the process by opening Task Manager and ending task on SetupHost.exe</li>
</ul>
<h2 id="when-running-from-windows-setup-gui">When running from Windows Setup GUI</h2>
<ul>
<li>The installation wizard will proceed as normal.</li>
<li>The setupact.log under <strong>c:$WINDOWS.~BT\Sources\Panther</strong> will be ~200 KB (depends on the device) and won&rsquo;t get updated after the first few mins.<br>
<div class="image">
  <figure>
    <a href="KB2952664-12.jpg" target="_blank">
      <img src="KB2952664-12.jpg" alt="A Square Dozen Image">
    </a>
    
  </figure>
</div></li>
<li>One of the last steps in setupact.log (you have to copy the file with admin rights to a different location before you can open it) will be</li>
</ul>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fallback" data-lang="fallback"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="1"><a style="outline: none; text-decoration:none; color:inherit" href="#1">1</a></span>CONX   Windows::Compat::Appraiser::DriverInventory::GetInventory (179):   Finished Driver Inventory.
</code></pre></div><ul>
<li>You will the screen &lsquo;<strong>Making sure you&rsquo;re ready to install</strong>&rsquo;.<br>
<div class="image">
  <figure>
    <a href="KB2952664-15.png" target="_blank">
      <img src="KB2952664-15.png" alt="A Square Dozen Image">
    </a>
    
  </figure>
</div></li>
<li>Task Manager will show setup.exe and SetupHost.exe in the task list, but CPU usage on both will be 0.<br>
<div class="image">
  <figure>
    <a href="KB2952664-11.jpg" target="_blank">
      <img src="KB2952664-11.jpg" alt="A Square Dozen Image">
    </a>
    
  </figure>
</div></li>
<li>Once you&rsquo;ve determined that the installer is hung, you can kill the process by opening Task Manager and ending task on SetupHost.exe</li>
</ul>
<h2 id="workarounds">Workarounds</h2>
<p>As of May 21,2018, my Windows 7 devices have <strong><a href="https://support.microsoft.com/help/2952664/compatibility-update-for-keeping-windows-up-to-date-in-windows-7">KB2952664</a></strong> installed. The KB was last updated on April 8, 2018. Uninstalling this KB before running Windows Setup allows the upgrade process to proceed as expected.</p>
<h3 id="configmgr-task-sequence-steps">ConfigMgr Task Sequence Steps</h3>
<ol>
<li>In your <strong>Prepare for Upgrade</strong> group, create a new group called <strong>KB292446 Install check.</strong><br>
<div class="image">
  <figure>
    <a href="KB2952664-20.jpg" target="_blank">
      <img src="KB2952664-20.jpg" alt="A Square Dozen Image">
    </a>
    
  </figure>
</div></li>
<li>On the Options tab of the <strong>KB292446 Install check</strong> group, add a new WMI Query condition <div class="image">
  <figure>
    <a href="KB2952664-18.jpg" target="_blank">
      <img src="KB2952664-18.jpg" alt="A Square Dozen Image">
    </a>
    
  </figure>
</div>
<ul>
<li><strong>WMI Namespace:</strong> root\cimv2</li>
<li><strong>Query:</strong> <code>Select * from win32_QuickFixEngineering Where HotfixID = 'KB2952664'</code></li>
</ul>
</li>
<li>Add Run Command Line Step called <strong>Uninstall KB292446</strong> <div class="image">
  <figure>
    <a href="KB2952664-19.jpg" target="_blank">
      <img src="KB2952664-19.jpg" alt="A Square Dozen Image">
    </a>
    
  </figure>
</div><br>
<strong>Command Line:</strong> <code>wusa /uninstall /kb:2952664 /quiet /norestart</code>
Be sure to include <code>/norestart</code>. I tested with <code>/forcerestart</code> and the Task Sequence will fail due to an unexpected reboot. I suspect you could create a Program to do this and it would allow the Task Sequence to manage the reboot.</li>
<li>Add <strong>Restart Computer Step</strong></li>
<li><strong>Optional:</strong> Add new Run Command Line step called <strong>Uninstall of KB2952664 Failed - Exit TS.</strong> This step will cause the Task Sequence to fail if the KB is still detected after a reboot. <div class="image">
  <figure>
    <a href="KB2952664-15.jpg" target="_blank">
      <img src="KB2952664-15.jpg" alt="A Square Dozen Image">
    </a>
    
  </figure>
</div></li>
<li>On the Options tab add a new WMI Query condition
<ul>
<li><strong>WMI Namespace:</strong> root\cimv2</li>
<li><strong>Query:</strong> <code>Select * from win32_QuickFixEngineering Where HotfixID = 'KB2952664'</code></li>
<li><strong>Command Line:</strong> <code>cmd /c exit 1</code></li>
</ul>
</li>
</ol>
<h3 id="manual-removal-steps">Manual Removal Steps</h3>
<h3 id="option-1">Option 1</h3>
<ol>
<li>From an elevated command prompt, run <code>wusa /uninstall /kb:2952664 /quiet /forcerestart</code></li>
<li>After the reboot, log in and run Windows Setup</li>
</ol>
<h3 id="option-2">Option 2</h3>
<ol>
<li>Open <strong>Programs and Features</strong></li>
<li>Click <strong>View Installed Updates</strong></li>
<li>Find the entry for KB2952664. I added the <strong>Update ID</strong> column to the view for easier sorting.<br>
<div class="image">
  <figure>
    <a href="KB2952664-14.jpg" target="_blank">
      <img src="KB2952664-14.jpg" alt="A Square Dozen Image">
    </a>
    
  </figure>
</div></li>
<li>Right click on the entry and click <strong>Uninstall</strong></li>
<li>Reboot</li>
<li>Run Windows Setup</li>
</ol>
<p>I plan to open a Premier Support case to report the issue and find out if this is a bug with KB.  I will post an update if I get anywhere with that.</p>

			</div>
			
			 <comments id="comments">
    <script 
        src="https://utteranc.es/client.js"
        repo="AdamGrossTX/asquaredozen"
        issue-term="title"
        label="blog comment"
        theme="github-light"
        crossorigin="anonymous"
        async>
    </script>
</comments>
		</article>
</div>

					</div>
				</div>
				<footer id="footer">
	<div class="container">
		<div id="footer-copyright">
			<p class="copyright">&copy; 2021 Adam Gross - https://blog.asquaredozen.com - A Square Dozen</a></p>
		</div>
	</div>
</footer>
			</div>
		</body>
</html>
