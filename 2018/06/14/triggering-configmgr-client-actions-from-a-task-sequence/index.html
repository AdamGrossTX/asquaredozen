<!doctype html><html lang=en-us>
<head>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1">
<meta http-equiv=x-ua-compatible content="IE=edge">
<meta name=keyword content="ConfigMgr Microsoft MVP Gross Intune Windows">
<meta name=viewport content="width=device-width">
<meta name=description content="A.Gross Blog | Adam Gross Enterprise Mobility MVP">
<link rel="shortcut icon" href=/img/favicon.ico>
<title>Triggering ConfigMgr Client Actions from a Task Sequence-A Square Dozen | A. Gross Blog</title>
<link rel=canonical href=/2018/06/14/triggering-configmgr-client-actions-from-a-task-sequence/>
<link rel=stylesheet href=/css/style.css>
<link rel=stylesheet href=https://www.asquaredozen.com/css/custom.css>
<script src=https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js></script>
<script src=https://ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js></script>
<script src=https://www.asquaredozen.com/js/jquery.slicknav.js></script>
<script src=https://www.asquaredozen.com/js/asd_SlickNav_Mobile.js></script>
<script src=https://www.asquaredozen.com/js/custom.js></script>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-DYVXTRTXN4"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','G-DYVXTRTXN4',{anonymize_ip:!1})}</script>
<meta name=twitter:card content="summary_large_image">
<meta name=twitter:image content="https://www.asquaredozen.com/ASquareDozen-Logo_Horiz_Twitter.png">
<meta name=twitter:title content="Triggering ConfigMgr Client Actions from a Task Sequence">
<meta name=twitter:description content="This week, we were working on testing Windows 7 to Windows 10 In-Place Upgrades and ran into an issue where our clients weren&rsquo;t updating their Operating System version in the ConfigMgr console. After some helpful responses on Twitter, I was able to add a client action trigger step to the end of my Task Sequence. In my production environment, we have a child task sequence that we call that has several client action steps in it including Request Machine Assignments (Machine Policies) {00000000-0000-0000-0000-000000000021}, Hardware Inventory {00000000-0000-0000-0000-000000000001} and now a Discovery Inventory {00000000-0000-0000-0000-000000000003}.">
<meta property="og:title" content="Triggering ConfigMgr Client Actions from a Task Sequence">
<meta property="og:description" content="This week, we were working on testing Windows 7 to Windows 10 In-Place Upgrades and ran into an issue where our clients weren&rsquo;t updating their Operating System version in the ConfigMgr console. After some helpful responses on Twitter, I was able to add a client action trigger step to the end of my Task Sequence. In my production environment, we have a child task sequence that we call that has several client action steps in it including Request Machine Assignments (Machine Policies) {00000000-0000-0000-0000-000000000021}, Hardware Inventory {00000000-0000-0000-0000-000000000001} and now a Discovery Inventory {00000000-0000-0000-0000-000000000003}.">
<meta property="og:type" content="article">
<meta property="og:url" content="https://www.asquaredozen.com/2018/06/14/triggering-configmgr-client-actions-from-a-task-sequence/"><meta property="og:image" content="https://www.asquaredozen.com/ASquareDozen-Logo_Horiz_Twitter.png"><meta property="article:section" content="posts">
<meta property="article:published_time" content="2018-06-15T04:20:56+00:00">
<meta property="article:modified_time" content="2018-06-15T04:20:56+00:00"><meta property="og:site_name" content="A Square Dozen | A. Gross Blog">
</head>
<body class="home blog">
<div id=asd-container>
<div id=top-bar>
<div class=container>
<div id=nav-wrapper>
<ul class=menu id=menu-top-menu>
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
<a href=/>Home</a>
</li>
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
<a href=#>
<span>Feature Updates</span>
</a>
<ul class="sub-menu menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
<a href=/2019/08/22/windows-10-feature-updates-leveraging-setupdiag-for-better-reporting/>Windows 10 Feature Updates – Leveraging SetupDiag for Better Reporting</a>
</li>
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
<a href=/2019/10/05/windows-10-feature-updates-the-challenge-of-servicing-in-the-enterprise/>Windows 10 Feature Updates – The Challenge of Servicing in the Enterprise</a>
</li>
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
<a href=/2019/08/25/windows-10-feature-updates-using-custom-action-scripts/>Windows 10 Feature Updates – Using Custom Action Scripts</a>
</li>
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
<a href=/2019/08/25/windows-10-feature-updates-using-setupconfig-ini-to-manage-feature-updates-in-the-enterprise/>Windows 10 Feature Updates – Using Setupconfig.ini to Manage Feature Updates in the Enterprise</a>
</li>
</ul>
</li>
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
<a href=/2019/02/12/the-system-center-configuration-manager-adminservice-guide/>
<span>ConfigMgr AdminService</span>
</a>
</li>
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
<a href=#>
<span>802.1x for OSD</span>
</a>
<ul class="sub-menu menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
<a href=/2018/07/29/configuring-802-1x-authentication-for-windows-deployment-part-1-building-an-802-1x-computer-authentication-script/>Part 1 – Building an 802.1x Computer Authentication Script</a>
</li>
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
<a href=/2018/07/29/configuring-802-1x-authentication-for-windows-deployment-part-2-building-an-802-1x-enabled-winpe-boot-image/>Part 2 – Building an 802.1x Enabled WinPE Boot Image</a>
</li>
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
<a href=/2018/07/29/configuring-802-1x-authentication-for-windows-deployment-part-3-integrating-802-1x-authentication-into-a-bare-metal-task-sequence/>Part 3 – Integrating 802.1x Authentication into a Bare Metal Task Sequence</a>
</li>
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
<a href=/2018/07/29/configuring-802-1x-authentication-for-windows-deployment-part-4-integrating-802-1x-authentication-into-an-in-place-upgrade-task-sequence/>Part 4 – Integrating 802.1x Authentication into an In-Place Upgrade Task Sequence</a>
</li>
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
<a href=/2018/09/29/configuring-802-1x-authentication-for-windows-deployment-part-5-dynamic-whitelisting-using-the-cisco-ise-external-restful-service/>Part 5 – Dynamic Whitelisting using the Cisco ISE External RESTful Service</a>
</li>
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
<a href=/2018/07/29/configuring-802-1x-authentication-for-windows-deployment-tips-and-tricks/>Tips and Tricks</a>
</li>
</ul>
</li>
<li class="active menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
<a href=#>
<span>Task Sequence Hacks</span>
</a>
<ul class="sub-menu menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
<a href=/2018/11/29/building-a-better-task-sequence/>Building a Better Task Sequence</a>
</li>
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
<a href=/2019/04/30/building-a-smarter-task-sequence/>Building a Smarter Task Sequence</a>
</li>
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
<a href=/2018/12/14/building-an-even-better-task-sequence/>Building An Even Better Task Sequence</a>
</li>
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
<a href=/2018/07/16/clearing-local-group-policies-during-an-windows-7-to-10-in-place-upgrade-task-sequence/>Clearing Local Group Policies during an Windows 7 to 10 In-Place Upgrade Task Sequence</a>
</li>
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
<a href=/2018/10/03/debugging-sccm-configmgr-task-sequences-on-the-fly/>Debugging SCCM/ConfigMgr Task Sequences on the Fly</a>
</li>
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
<a href=/2018/07/11/dynamically-updating-unattend-xml-during-an-osd-task-sequence-using-mdt-variables-and-zti-scripts/>Dynamically Updating Unattend.XML during an OSD Task Sequence using MDT Variables and ZTI Scripts.</a>
</li>
<li class="active menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
<a href=/2018/06/14/triggering-configmgr-client-actions-from-a-task-sequence/>Triggering ConfigMgr Client Actions from a Task Sequence</a>
</li>
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
<a href=/2018/08/27/using-sccm-task-sequence-variables-as-scripts/>Using SCCM Task Sequence Variables as Scripts</a>
</li>
</ul>
</li>
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
<a href=https://github.com/AdamGrossTX>
<span>GitHub</span>
</a>
</li>
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
<a href=#>
<span>MORE></span>
</a>
<ul class="sub-menu menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
<a href=/about/>About</a>
</li>
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
<a href=/consulting/>Consulting</a>
</li>
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
<a href=/contact/>Contact</a>
</li>
</ul>
</li>
</ul>
</div>
<div id=top-search>
<a href=# class=search><i class="fa fa-search"></i></a>
<div class=show-search>
<form role=search method=get action=https://www.google.com/search id=searchform>
<input type=search placeholder="Search and hit enter..." name=q id=q title="Search and hit enter...">
<input type=hidden name=sitesearch value=https://www.asquaredozen.com>
<button type=submit value=Search>
</form>
</div>
</div>
<div class=menu id=menu-mobile></div>
</div>
</div>
<header id=header class=noslider>
<div class=container>
<div id=logo>
<h1><a href=https://www.asquaredozen.com><img src=/img/A-Square-Dozen-Logo-BlogHeader-1.png alt="A Square Dozen"></a></h1>
</div>
</div>
</header>
<div class=container>
<div id=content>
<div id=main class=fullwidth>
<article class="post type-post status-publish format-standard has-post-thumbnail hentry">
<div class=post-header>
<h1>Triggering ConfigMgr Client Actions from a Task Sequence</h1>
<span class=post-date>June 15, 2018</span>
</div>
<div class=post-entry>
<p>This week, we were working on testing Windows 7 to Windows 10 In-Place Upgrades and ran into an issue where our clients weren&rsquo;t updating their Operating System version in the ConfigMgr console. After some <a href=https://twitter.com/AdamGrossTX/status/1007032149973897216>helpful responses on Twitter</a>, I was able to add a client action trigger step to the end of my Task Sequence. In my production environment, we have a child task sequence that we call that has several client action steps in it including Request Machine Assignments (Machine Policies) {00000000-0000-0000-0000-000000000021}, Hardware Inventory {00000000-0000-0000-0000-000000000001} and now a Discovery Inventory {00000000-0000-0000-0000-000000000003}.</p>
<p>The idea behind this Task Sequence is to create a Run Command Line step for each of the ConfigMgr client schedule IDs. From there, the sky&rsquo;s the limit. It just seemed like a great way to just get them all into one place for easy access. You can add it to your Task Sequence as a child Task Sequence or even advertise it as a standalone Task Sequence for newly imaged devices. Additionally, if you want to know what each item does or which logs to look into, just Google it. That&rsquo;s what I did! 🙂</p>
<p>Some people may ask why not just put all of the actions I want into a script. Because I don&rsquo;t want to. There are scripts out there that do this same thing in Powershell, but I wanted steps that would be easy for anyone to enable/disable without having to dig into a separate script to debug or change things.</p>
<p>Just use caution. Test! Test! Test!</p>
<h2 id=disclaimer>DISCLAIMER</h2>
<p>Use with caution and test in your lab first. Also, I have not tested all of these actions. Some of them may be deprecated. The list came from <a href=https://blogs.technet.microsoft.com/charlesa_us/2015/03/07/triggering-configmgr-client-actions-with-wmic-without-pesky-right-click-tools/>here</a></p>
<h2 id=script-to-create-task-sequence>Script to Create Task Sequence</h2>
<p>I <a href=https://www.amazon.com/Stealing-Pride-Vol-Customizations-ConfigMgr/dp/9187445034>stole</a> the base code for this from Johan Arwidmark&rsquo;s (<a href=https://twitter.com/jarwidmark/>@jarwidmark</a>) <a href=https://deploymentresearch.com/Research/Post/658/Creating-Task-Sequences-in-ConfigMgr-via-PowerShell>Creating Task Sequences in ConfigMgr via PowerShell</a> blog post. The script is simple. Customize it as you see fit. It creates a list of actions that get added to an Enabled and Disabled group in a new Task Sequence. The Disabled Group is set to Disabled in the Task Sequence, but each item below it is not, can move steps in and out of the groups in your TS easily once you&rsquo;ve created the Task Sequence.</p>
<p><a href=/2018/06/14/triggering-configmgr-client-actions-from-a-task-sequence/2018-06-14_23-11-40/><div class=image>
<figure>
<a href=2018-06-14_23-11-40.jpg target=_blank>
<img src=2018-06-14_23-11-40.jpg alt="A Square Dozen Image">
</a>
</figure>
</div></a></p>
<p>You will need to connect to your ConfigMgr site to run this. The easiest way to do that is to open the ConfigMgr Console and click the upper left corner menu. Select Connect vis Windows PowerShell ISE.
Then run the script that pops up. Don&rsquo;t edit that script! Once in ISE, copy the following code into a new window, customize it and run it.</p>
<div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=1><a style=outline:none;text-decoration:none;color:inherit href=#1> 1</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=2><a style=outline:none;text-decoration:none;color:inherit href=#2> 2</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=3><a style=outline:none;text-decoration:none;color:inherit href=#3> 3</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=4><a style=outline:none;text-decoration:none;color:inherit href=#4> 4</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=5><a style=outline:none;text-decoration:none;color:inherit href=#5> 5</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=6><a style=outline:none;text-decoration:none;color:inherit href=#6> 6</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=7><a style=outline:none;text-decoration:none;color:inherit href=#7> 7</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=8><a style=outline:none;text-decoration:none;color:inherit href=#8> 8</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=9><a style=outline:none;text-decoration:none;color:inherit href=#9> 9</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=10><a style=outline:none;text-decoration:none;color:inherit href=#10>10</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=11><a style=outline:none;text-decoration:none;color:inherit href=#11>11</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=12><a style=outline:none;text-decoration:none;color:inherit href=#12>12</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=13><a style=outline:none;text-decoration:none;color:inherit href=#13>13</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=14><a style=outline:none;text-decoration:none;color:inherit href=#14>14</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=15><a style=outline:none;text-decoration:none;color:inherit href=#15>15</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=16><a style=outline:none;text-decoration:none;color:inherit href=#16>16</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=17><a style=outline:none;text-decoration:none;color:inherit href=#17>17</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=18><a style=outline:none;text-decoration:none;color:inherit href=#18>18</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=19><a style=outline:none;text-decoration:none;color:inherit href=#19>19</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=20><a style=outline:none;text-decoration:none;color:inherit href=#20>20</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=21><a style=outline:none;text-decoration:none;color:inherit href=#21>21</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=22><a style=outline:none;text-decoration:none;color:inherit href=#22>22</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=23><a style=outline:none;text-decoration:none;color:inherit href=#23>23</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=24><a style=outline:none;text-decoration:none;color:inherit href=#24>24</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=25><a style=outline:none;text-decoration:none;color:inherit href=#25>25</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=26><a style=outline:none;text-decoration:none;color:inherit href=#26>26</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=27><a style=outline:none;text-decoration:none;color:inherit href=#27>27</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=28><a style=outline:none;text-decoration:none;color:inherit href=#28>28</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=29><a style=outline:none;text-decoration:none;color:inherit href=#29>29</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=30><a style=outline:none;text-decoration:none;color:inherit href=#30>30</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=31><a style=outline:none;text-decoration:none;color:inherit href=#31>31</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=32><a style=outline:none;text-decoration:none;color:inherit href=#32>32</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=33><a style=outline:none;text-decoration:none;color:inherit href=#33>33</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=34><a style=outline:none;text-decoration:none;color:inherit href=#34>34</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=35><a style=outline:none;text-decoration:none;color:inherit href=#35>35</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=36><a style=outline:none;text-decoration:none;color:inherit href=#36>36</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=37><a style=outline:none;text-decoration:none;color:inherit href=#37>37</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=38><a style=outline:none;text-decoration:none;color:inherit href=#38>38</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=39><a style=outline:none;text-decoration:none;color:inherit href=#39>39</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=40><a style=outline:none;text-decoration:none;color:inherit href=#40>40</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=41><a style=outline:none;text-decoration:none;color:inherit href=#41>41</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=42><a style=outline:none;text-decoration:none;color:inherit href=#42>42</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=43><a style=outline:none;text-decoration:none;color:inherit href=#43>43</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=44><a style=outline:none;text-decoration:none;color:inherit href=#44>44</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=45><a style=outline:none;text-decoration:none;color:inherit href=#45>45</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=46><a style=outline:none;text-decoration:none;color:inherit href=#46>46</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=47><a style=outline:none;text-decoration:none;color:inherit href=#47>47</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=48><a style=outline:none;text-decoration:none;color:inherit href=#48>48</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=49><a style=outline:none;text-decoration:none;color:inherit href=#49>49</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=50><a style=outline:none;text-decoration:none;color:inherit href=#50>50</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=51><a style=outline:none;text-decoration:none;color:inherit href=#51>51</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=52><a style=outline:none;text-decoration:none;color:inherit href=#52>52</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=53><a style=outline:none;text-decoration:none;color:inherit href=#53>53</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=54><a style=outline:none;text-decoration:none;color:inherit href=#54>54</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=55><a style=outline:none;text-decoration:none;color:inherit href=#55>55</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=56><a style=outline:none;text-decoration:none;color:inherit href=#56>56</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=57><a style=outline:none;text-decoration:none;color:inherit href=#57>57</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=58><a style=outline:none;text-decoration:none;color:inherit href=#58>58</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=59><a style=outline:none;text-decoration:none;color:inherit href=#59>59</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=60><a style=outline:none;text-decoration:none;color:inherit href=#60>60</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=61><a style=outline:none;text-decoration:none;color:inherit href=#61>61</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=62><a style=outline:none;text-decoration:none;color:inherit href=#62>62</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=63><a style=outline:none;text-decoration:none;color:inherit href=#63>63</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=64><a style=outline:none;text-decoration:none;color:inherit href=#64>64</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=65><a style=outline:none;text-decoration:none;color:inherit href=#65>65</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=66><a style=outline:none;text-decoration:none;color:inherit href=#66>66</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=67><a style=outline:none;text-decoration:none;color:inherit href=#67>67</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=68><a style=outline:none;text-decoration:none;color:inherit href=#68>68</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=69><a style=outline:none;text-decoration:none;color:inherit href=#69>69</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=70><a style=outline:none;text-decoration:none;color:inherit href=#70>70</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=71><a style=outline:none;text-decoration:none;color:inherit href=#71>71</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=72><a style=outline:none;text-decoration:none;color:inherit href=#72>72</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=73><a style=outline:none;text-decoration:none;color:inherit href=#73>73</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=74><a style=outline:none;text-decoration:none;color:inherit href=#74>74</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=75><a style=outline:none;text-decoration:none;color:inherit href=#75>75</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=76><a style=outline:none;text-decoration:none;color:inherit href=#76>76</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=77><a style=outline:none;text-decoration:none;color:inherit href=#77>77</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=78><a style=outline:none;text-decoration:none;color:inherit href=#78>78</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=79><a style=outline:none;text-decoration:none;color:inherit href=#79>79</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=80><a style=outline:none;text-decoration:none;color:inherit href=#80>80</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=81><a style=outline:none;text-decoration:none;color:inherit href=#81>81</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=82><a style=outline:none;text-decoration:none;color:inherit href=#82>82</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=83><a style=outline:none;text-decoration:none;color:inherit href=#83>83</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=84><a style=outline:none;text-decoration:none;color:inherit href=#84>84</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=85><a style=outline:none;text-decoration:none;color:inherit href=#85>85</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=86><a style=outline:none;text-decoration:none;color:inherit href=#86>86</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=87><a style=outline:none;text-decoration:none;color:inherit href=#87>87</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=88><a style=outline:none;text-decoration:none;color:inherit href=#88>88</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=89><a style=outline:none;text-decoration:none;color:inherit href=#89>89</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=90><a style=outline:none;text-decoration:none;color:inherit href=#90>90</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=91><a style=outline:none;text-decoration:none;color:inherit href=#91>91</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=92><a style=outline:none;text-decoration:none;color:inherit href=#92>92</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=93><a style=outline:none;text-decoration:none;color:inherit href=#93>93</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=94><a style=outline:none;text-decoration:none;color:inherit href=#94>94</a>
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=color:teal>$ClientActions</span> = @()

<span style=color:#998;font-style:italic>#number of seconds the script will sleep before triggering the next action. This gets set on each commandline.</span>
<span style=color:#998;font-style:italic>#Set to 0 to skip sleep.</span>
<span style=color:teal>$SleepInSeconds</span> = 120

<span style=color:#998;font-style:italic>#Comment Out any client actions that you don&#39;t want to add to your TS.</span>

<span style=color:#998;font-style:italic>#Move actions here that will be added to the Enabled Client Actions group.</span>
<span style=color:teal>$EnabledActions</span> = @()
<span style=color:teal>$EnabledActions</span> += <span style=color:teal>[pscustomobject]</span>@{ ActionName =  <span style=color:#d14>&#39;Request Machine Assignments&#39;</span>; ActionID = <span style=color:#d14>&#39;{00000000-0000-0000-0000-000000000021}&#39;</span> }
<span style=color:teal>$EnabledActions</span> += <span style=color:teal>[pscustomobject]</span>@{ ActionName =  <span style=color:#d14>&#39;Hardware Inventory&#39;</span>; ActionID = <span style=color:#d14>&#39;{00000000-0000-0000-0000-000000000001}&#39;</span> }
<span style=color:teal>$EnabledActions</span> += <span style=color:teal>[pscustomobject]</span>@{ ActionName =  <span style=color:#d14>&#39;Discovery Inventory&#39;</span>; ActionID = <span style=color:#d14>&#39;{00000000-0000-0000-0000-000000000003}&#39;</span> }

<span style=color:#998;font-style:italic>#Move actions here that will be added to the Disabled Client Actions group.</span>
<span style=color:#998;font-style:italic>#These are simply added to the TS so that they are available if you need them.</span>
<span style=color:#998;font-style:italic>#You can comment out the ProcessActions step at the end of the script if you would like to exclude these altogether.</span>
<span style=color:teal>$DisabledActions</span> = @()
<span style=color:teal>$DisabledActions</span> += <span style=color:teal>[pscustomobject]</span>@{ ActionName =  <span style=color:#d14>&#39;Software Inventory&#39;</span>; ActionID = <span style=color:#d14>&#39;{00000000-0000-0000-0000-000000000002}&#39;</span> }
<span style=color:teal>$DisabledActions</span> += <span style=color:teal>[pscustomobject]</span>@{ ActionName =  <span style=color:#d14>&#39;File Collection&#39;</span>; ActionID = <span style=color:#d14>&#39;{00000000-0000-0000-0000-000000000010}&#39;</span> }
<span style=color:teal>$DisabledActions</span> += <span style=color:teal>[pscustomobject]</span>@{ ActionName =  <span style=color:#d14>&#39;IDMIF Collection&#39;</span>; ActionID = <span style=color:#d14>&#39;{00000000-0000-0000-0000-000000000011}&#39;</span> }
<span style=color:teal>$DisabledActions</span> += <span style=color:teal>[pscustomobject]</span>@{ ActionName =  <span style=color:#d14>&#39;Client Machine Authentication&#39;</span>; ActionID = <span style=color:#d14>&#39;{00000000-0000-0000-0000-000000000012}&#39;</span> }
<span style=color:teal>$DisabledActions</span> += <span style=color:teal>[pscustomobject]</span>@{ ActionName =  <span style=color:#d14>&#39;Evaluate Machine Policies&#39;</span>; ActionID = <span style=color:#d14>&#39;{00000000-0000-0000-0000-000000000022}&#39;</span> }
<span style=color:teal>$DisabledActions</span> += <span style=color:teal>[pscustomobject]</span>@{ ActionName =  <span style=color:#d14>&#39;Refresh Default MP Task&#39;</span>; ActionID = <span style=color:#d14>&#39;{00000000-0000-0000-0000-000000000023}&#39;</span> }
<span style=color:teal>$DisabledActions</span> += <span style=color:teal>[pscustomobject]</span>@{ ActionName =  <span style=color:#d14>&#39;LS (Location Service) Refresh Locations Task&#39;</span>; ActionID = <span style=color:#d14>&#39;{00000000-0000-0000-0000-000000000024}&#39;</span> }
<span style=color:teal>$DisabledActions</span> += <span style=color:teal>[pscustomobject]</span>@{ ActionName =  <span style=color:#d14>&#39;LS (Location Service) Timeout Refresh Task&#39;</span>; ActionID = <span style=color:#d14>&#39;{00000000-0000-0000-0000-000000000025}&#39;</span> }
<span style=color:teal>$DisabledActions</span> += <span style=color:teal>[pscustomobject]</span>@{ ActionName =  <span style=color:#d14>&#39;Policy Agent Request Assignment (User)&#39;</span>; ActionID = <span style=color:#d14>&#39;{00000000-0000-0000-0000-000000000026}&#39;</span> }
<span style=color:teal>$DisabledActions</span> += <span style=color:teal>[pscustomobject]</span>@{ ActionName =  <span style=color:#d14>&#39;Policy Agent Evaluate Assignment (User)&#39;</span>; ActionID = <span style=color:#d14>&#39;{00000000-0000-0000-0000-000000000027}&#39;</span> }
<span style=color:teal>$DisabledActions</span> += <span style=color:teal>[pscustomobject]</span>@{ ActionName =  <span style=color:#d14>&#39;Software Metering Generating Usage Report&#39;</span>; ActionID = <span style=color:#d14>&#39;{00000000-0000-0000-0000-000000000031}&#39;</span> }
<span style=color:teal>$DisabledActions</span> += <span style=color:teal>[pscustomobject]</span>@{ ActionName =  <span style=color:#d14>&#39;Source Update Message&#39;</span>; ActionID = <span style=color:#d14>&#39;{00000000-0000-0000-0000-000000000032}&#39;</span> }
<span style=color:teal>$DisabledActions</span> += <span style=color:teal>[pscustomobject]</span>@{ ActionName =  <span style=color:#d14>&#39;Clearing proxy settings cache&#39;</span>; ActionID = <span style=color:#d14>&#39;{00000000-0000-0000-0000-000000000037}&#39;</span> }
<span style=color:teal>$DisabledActions</span> += <span style=color:teal>[pscustomobject]</span>@{ ActionName =  <span style=color:#d14>&#39;Machine Policy Agent Cleanup&#39;</span>; ActionID = <span style=color:#d14>&#39;{00000000-0000-0000-0000-000000000040}&#39;</span> }
<span style=color:teal>$DisabledActions</span> += <span style=color:teal>[pscustomobject]</span>@{ ActionName =  <span style=color:#d14>&#39;User Policy Agent Cleanup&#39;</span>; ActionID = <span style=color:#d14>&#39;{00000000-0000-0000-0000-000000000041}&#39;</span> }
<span style=color:teal>$DisabledActions</span> += <span style=color:teal>[pscustomobject]</span>@{ ActionName =  <span style=color:#d14>&#39;Policy Agent Validate Machine Policy / Assignment&#39;</span>; ActionID = <span style=color:#d14>&#39;{00000000-0000-0000-0000-000000000042}&#39;</span> }
<span style=color:teal>$DisabledActions</span> += <span style=color:teal>[pscustomobject]</span>@{ ActionName =  <span style=color:#d14>&#39;Policy Agent Validate User Policy / Assignment&#39;</span>; ActionID = <span style=color:#d14>&#39;{00000000-0000-0000-0000-000000000043}&#39;</span> }
<span style=color:teal>$DisabledActions</span> += <span style=color:teal>[pscustomobject]</span>@{ ActionName =  <span style=color:#d14>&#39;Retrying/Refreshing certificates in AD on MP&#39;</span>; ActionID = <span style=color:#d14>&#39;{00000000-0000-0000-0000-000000000051}&#39;</span> }
<span style=color:teal>$DisabledActions</span> += <span style=color:teal>[pscustomobject]</span>@{ ActionName =  <span style=color:#d14>&#39;Peer DP Status reporting&#39;</span>; ActionID = <span style=color:#d14>&#39;{00000000-0000-0000-0000-000000000061}&#39;</span> }
<span style=color:teal>$DisabledActions</span> += <span style=color:teal>[pscustomobject]</span>@{ ActionName =  <span style=color:#d14>&#39;Peer DP Pending package check schedule&#39;</span>; ActionID = <span style=color:#d14>&#39;{00000000-0000-0000-0000-000000000062}&#39;</span> }
<span style=color:teal>$DisabledActions</span> += <span style=color:teal>[pscustomobject]</span>@{ ActionName =  <span style=color:#d14>&#39;SUM Updates install schedule&#39;</span>; ActionID = <span style=color:#d14>&#39;{00000000-0000-0000-0000-000000000063}&#39;</span> }
<span style=color:teal>$DisabledActions</span> += <span style=color:teal>[pscustomobject]</span>@{ ActionName =  <span style=color:#d14>&#39;NAP action&#39;</span>; ActionID = <span style=color:#d14>&#39;{00000000-0000-0000-0000-000000000071}&#39;</span> }
<span style=color:teal>$DisabledActions</span> += <span style=color:teal>[pscustomobject]</span>@{ ActionName =  <span style=color:#d14>&#39;Hardware Inventory Collection Cycle&#39;</span>; ActionID = <span style=color:#d14>&#39;{00000000-0000-0000-0000-000000000101}&#39;</span> }
<span style=color:teal>$DisabledActions</span> += <span style=color:teal>[pscustomobject]</span>@{ ActionName =  <span style=color:#d14>&#39;Software Inventory Collection Cycle&#39;</span>; ActionID = <span style=color:#d14>&#39;{00000000-0000-0000-0000-000000000102}&#39;</span> }
<span style=color:teal>$DisabledActions</span> += <span style=color:teal>[pscustomobject]</span>@{ ActionName =  <span style=color:#d14>&#39;Discovery Data Collection Cycle&#39;</span>; ActionID = <span style=color:#d14>&#39;{00000000-0000-0000-0000-000000000103}&#39;</span> }
<span style=color:teal>$DisabledActions</span> += <span style=color:teal>[pscustomobject]</span>@{ ActionName =  <span style=color:#d14>&#39;File Collection Cycle&#39;</span>; ActionID = <span style=color:#d14>&#39;{00000000-0000-0000-0000-000000000104}&#39;</span> }
<span style=color:teal>$DisabledActions</span> += <span style=color:teal>[pscustomobject]</span>@{ ActionName =  <span style=color:#d14>&#39;IDMIF Collection Cycle&#39;</span>; ActionID = <span style=color:#d14>&#39;{00000000-0000-0000-0000-000000000105}&#39;</span> }
<span style=color:teal>$DisabledActions</span> += <span style=color:teal>[pscustomobject]</span>@{ ActionName =  <span style=color:#d14>&#39;Software Metering Usage Report Cycle&#39;</span>; ActionID = <span style=color:#d14>&#39;{00000000-0000-0000-0000-000000000106}&#39;</span> }
<span style=color:teal>$DisabledActions</span> += <span style=color:teal>[pscustomobject]</span>@{ ActionName =  <span style=color:#d14>&#39;Windows Installer Source List Update Cycle&#39;</span>; ActionID = <span style=color:#d14>&#39;{00000000-0000-0000-0000-000000000107}&#39;</span> }
<span style=color:teal>$DisabledActions</span> += <span style=color:teal>[pscustomobject]</span>@{ ActionName =  <span style=color:#d14>&#39;Software Updates Assignments Evaluation Cycle&#39;</span>; ActionID = <span style=color:#d14>&#39;{00000000-0000-0000-0000-000000000108}&#39;</span> }
<span style=color:teal>$DisabledActions</span> += <span style=color:teal>[pscustomobject]</span>@{ ActionName =  <span style=color:#d14>&#39;Branch Distribution Point Maintenance Task&#39;</span>; ActionID = <span style=color:#d14>&#39;{00000000-0000-0000-0000-000000000109}&#39;</span> }
<span style=color:teal>$DisabledActions</span> += <span style=color:teal>[pscustomobject]</span>@{ ActionName =  <span style=color:#d14>&#39;DCM policy&#39;</span>; ActionID = <span style=color:#d14>&#39;{00000000-0000-0000-0000-000000000110}&#39;</span> }
<span style=color:teal>$DisabledActions</span> += <span style=color:teal>[pscustomobject]</span>@{ ActionName =  <span style=color:#d14>&#39;Send Unsent State Message&#39;</span>; ActionID = <span style=color:#d14>&#39;{00000000-0000-0000-0000-000000000111}&#39;</span> }
<span style=color:teal>$DisabledActions</span> += <span style=color:teal>[pscustomobject]</span>@{ ActionName =  <span style=color:#d14>&#39;State System policy cache cleanout&#39;</span>; ActionID = <span style=color:#d14>&#39;{00000000-0000-0000-0000-000000000112}&#39;</span> }
<span style=color:teal>$DisabledActions</span> += <span style=color:teal>[pscustomobject]</span>@{ ActionName =  <span style=color:#d14>&#39;Scan by Update Source&#39;</span>; ActionID = <span style=color:#d14>&#39;{00000000-0000-0000-0000-000000000113}&#39;</span> }
<span style=color:teal>$DisabledActions</span> += <span style=color:teal>[pscustomobject]</span>@{ ActionName =  <span style=color:#d14>&#39;Update Store Policy&#39;</span>; ActionID = <span style=color:#d14>&#39;{00000000-0000-0000-0000-000000000114}&#39;</span> }
<span style=color:teal>$DisabledActions</span> += <span style=color:teal>[pscustomobject]</span>@{ ActionName =  <span style=color:#d14>&#39;State system policy bulk send high&#39;</span>; ActionID = <span style=color:#d14>&#39;{00000000-0000-0000-0000-000000000115}&#39;</span> }
<span style=color:teal>$DisabledActions</span> += <span style=color:teal>[pscustomobject]</span>@{ ActionName =  <span style=color:#d14>&#39;State system policy bulk send low&#39;</span>; ActionID = <span style=color:#d14>&#39;{00000000-0000-0000-0000-000000000116}&#39;</span> }
<span style=color:teal>$DisabledActions</span> += <span style=color:teal>[pscustomobject]</span>@{ ActionName =  <span style=color:#d14>&#39;AMT Status Check Policy&#39;</span>; ActionID = <span style=color:#d14>&#39;{00000000-0000-0000-0000-000000000120}&#39;</span> }
<span style=color:teal>$DisabledActions</span> += <span style=color:teal>[pscustomobject]</span>@{ ActionName =  <span style=color:#d14>&#39;Application manager policy action&#39;</span>; ActionID = <span style=color:#d14>&#39;{00000000-0000-0000-0000-000000000121}&#39;</span> }
<span style=color:teal>$DisabledActions</span> += <span style=color:teal>[pscustomobject]</span>@{ ActionName =  <span style=color:#d14>&#39;Application manager user policy action&#39;</span>; ActionID = <span style=color:#d14>&#39;{00000000-0000-0000-0000-000000000122}&#39;</span> }
<span style=color:teal>$DisabledActions</span> += <span style=color:teal>[pscustomobject]</span>@{ ActionName =  <span style=color:#d14>&#39;Application manager global evaluation action&#39;</span>; ActionID = <span style=color:#d14>&#39;{00000000-0000-0000-0000-000000000123}&#39;</span> }
<span style=color:teal>$DisabledActions</span> += <span style=color:teal>[pscustomobject]</span>@{ ActionName =  <span style=color:#d14>&#39;Power management start summarizer&#39;</span>; ActionID = <span style=color:#d14>&#39;{00000000-0000-0000-0000-000000000131}&#39;</span> }
<span style=color:teal>$DisabledActions</span> += <span style=color:teal>[pscustomobject]</span>@{ ActionName =  <span style=color:#d14>&#39;Endpoint deployment reevaluate&#39;</span>; ActionID = <span style=color:#d14>&#39;{00000000-0000-0000-0000-000000000221}&#39;</span> }
<span style=color:teal>$DisabledActions</span> += <span style=color:teal>[pscustomobject]</span>@{ ActionName =  <span style=color:#d14>&#39;Endpoint AM policy reevaluate&#39;</span>; ActionID = <span style=color:#d14>&#39;{00000000-0000-0000-0000-000000000222}&#39;</span> }
<span style=color:teal>$DisabledActions</span> += <span style=color:teal>[pscustomobject]</span>@{ ActionName =  <span style=color:#d14>&#39;External event detection&#39;</span>; ActionID = <span style=color:#d14>&#39;{00000000-0000-0000-0000-000000000223}&#39;</span> }

<span style=color:teal>$TS</span> = <span style=color:#0086b3>New-CMTaskSequence</span> -CustomTaskSequence -Name <span style=color:#d14>&#34;Run ConfigMgr Client Actions&#34;</span>
 
<span style=color:teal>$EnabledGroup</span> = <span style=color:#0086b3>New-CMTaskSequenceGroup</span> -Name <span style=color:#d14>&#34;Enabled Client Actions&#34;</span>
<span style=color:#0086b3>Add-CMTaskSequenceStep</span> -InsertStepStartIndex 0 -TaskSequenceName <span style=color:teal>$TS</span>.Name -Step <span style=color:teal>$EnabledGroup</span>

<span style=color:teal>$DisabledGroup</span> = <span style=color:#0086b3>New-CMTaskSequenceGroup</span> -Name <span style=color:#d14>&#34;Disabled Client Actions&#34;</span> -Disable
<span style=color:#0086b3>Add-CMTaskSequenceStep</span> -InsertStepStartIndex 1 -TaskSequenceName <span style=color:teal>$TS</span>.Name -Step <span style=color:teal>$DisabledGroup</span>

<span style=color:#000;font-weight:700>Function</span> ProcessActions (<span style=color:teal>$ClientActions</span>, <span style=color:teal>$Group</span>)
{
    <span style=color:#000;font-weight:700>Foreach</span> (<span style=color:teal>$Action</span> <span style=color:#000;font-weight:700>in</span> <span style=color:teal>$ClientActions</span>)
    {
        <span style=color:#998;font-style:italic>#Format the sleep command for appending</span>
        <span style=color:teal>$Sleep</span> = <span style=color:#000;font-weight:700>If</span>(<span style=color:teal>$SleepInSeconds</span> <span style=color:#000;font-weight:700>-gt</span> 0) {<span style=color:#d14>&#34;;Start-Sleep -seconds </span>$(<span style=color:teal>$SleepInSeconds</span>)<span style=color:#d14>;&#34;</span>} <span style=color:#000;font-weight:700>else</span> {<span style=color:teal>$Sleep</span> = <span style=color:#d14>&#39;&#39;</span>}

        <span style=color:#998;font-style:italic>#Format TS CommandLine</span>
        <span style=color:teal>$cmdLine</span> = <span style=color:teal>[string]</span>::Format(<span style=color:#d14>&#34;%SYSTEMROOT%\System32\WindowsPowerShell\v1.0\powershell.exe -NoProfile -WindowStyle Hidden -ExecutionPolicy Bypass -Command </span><span style=color:#d14>`&#34;</span><span style=color:#d14>Invoke-WmiMethod -Namespace root\CCM -Class SMS_Client -Name TriggerSchedule &#39;{0}&#39;{1}</span><span style=color:#d14>`&#34;</span><span style=color:#d14>&#34;</span>,<span style=color:teal>$Action</span>.ActionID, <span style=color:teal>$Sleep</span>)
        <span style=color:#0086b3>Write-Host</span> <span style=color:teal>$cmdLine</span>

        <span style=color:#998;font-style:italic>#Create TS Step</span>
        <span style=color:teal>$Step</span> = <span style=color:#0086b3>New-CMTaskSequenceStepRunCommandLine</span> -StepName <span style=color:#d14>&#34;</span>$(<span style=color:teal>$Action</span>.ActionName)<span style=color:#d14>&#34;</span> -CommandLine <span style=color:#d14>&#34;</span>$(<span style=color:teal>$cmdLine</span>)<span style=color:#d14>&#34;</span> -ContinueOnError

        <span style=color:#998;font-style:italic>#Append Step to group</span>
        <span style=color:#0086b3>Set-CMTaskSequenceGroup</span> -TaskSequenceName <span style=color:teal>$TS</span>.Name -StepName <span style=color:teal>$Group</span>.Name -AddStep <span style=color:teal>$Step</span>
    }
}

ProcessActions <span style=color:teal>$EnabledActions</span> <span style=color:teal>$EnabledGroup</span>
ProcessActions <span style=color:teal>$DisabledActions</span> <span style=color:teal>$DisabledGroup</span>
</code></pre></td></tr></table>
</div>
</div><h2 id=results>Results</h2>
<p>Once you have run the script, you should end up with a Task Sequence like this:</p>
<p><a href=/2018/06/14/triggering-configmgr-client-actions-from-a-task-sequence/2018-06-14_22-22-36/><div class=image>
<figure>
<a href=2018-06-14_22-22-36.jpg target=_blank>
<img src=2018-06-14_22-22-36.jpg alt="A Square Dozen Image">
</a>
</figure>
</div></a></p>
<p><a href=/2018/06/14/triggering-configmgr-client-actions-from-a-task-sequence/2018-06-14_22-23-20/><div class=image>
<figure>
<a href=2018-06-14_22-23-20.jpg target=_blank>
<img src=2018-06-14_22-23-20.jpg alt="A Square Dozen Image">
</a>
</figure>
</div></a></p>
<p>And entries like this:</p>
<p>You should see entries in your smsts.log like this. Each step has Continue On Error turned on, so you will want to look at the logs to see if the steps are actually working.</p>
<p><a href=/2018/06/14/triggering-configmgr-client-actions-from-a-task-sequence/2018-06-14_22-34-34/><div class=image>
<figure>
<a href=2018-06-14_22-34-34.jpg target=_blank>
<img src=2018-06-14_22-34-34.jpg alt="A Square Dozen Image">
</a>
</figure>
</div></a></p>
<div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=1><a style=outline:none;text-decoration:none;color:inherit href=#1> 1</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=2><a style=outline:none;text-decoration:none;color:inherit href=#2> 2</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=3><a style=outline:none;text-decoration:none;color:inherit href=#3> 3</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=4><a style=outline:none;text-decoration:none;color:inherit href=#4> 4</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=5><a style=outline:none;text-decoration:none;color:inherit href=#5> 5</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=6><a style=outline:none;text-decoration:none;color:inherit href=#6> 6</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=7><a style=outline:none;text-decoration:none;color:inherit href=#7> 7</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=8><a style=outline:none;text-decoration:none;color:inherit href=#8> 8</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=9><a style=outline:none;text-decoration:none;color:inherit href=#9> 9</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=10><a style=outline:none;text-decoration:none;color:inherit href=#10>10</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=11><a style=outline:none;text-decoration:none;color:inherit href=#11>11</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=12><a style=outline:none;text-decoration:none;color:inherit href=#12>12</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=13><a style=outline:none;text-decoration:none;color:inherit href=#13>13</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=14><a style=outline:none;text-decoration:none;color:inherit href=#14>14</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=15><a style=outline:none;text-decoration:none;color:inherit href=#15>15</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=16><a style=outline:none;text-decoration:none;color:inherit href=#16>16</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=17><a style=outline:none;text-decoration:none;color:inherit href=#17>17</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=18><a style=outline:none;text-decoration:none;color:inherit href=#18>18</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=19><a style=outline:none;text-decoration:none;color:inherit href=#19>19</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=20><a style=outline:none;text-decoration:none;color:inherit href=#20>20</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=21><a style=outline:none;text-decoration:none;color:inherit href=#21>21</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=22><a style=outline:none;text-decoration:none;color:inherit href=#22>22</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=23><a style=outline:none;text-decoration:none;color:inherit href=#23>23</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=24><a style=outline:none;text-decoration:none;color:inherit href=#24>24</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=25><a style=outline:none;text-decoration:none;color:inherit href=#25>25</a>
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ini data-lang=ini><span style=color:teal>Expand a string: WinPEandFullOS    TSManager   6/14/2018 10:31:22 PM   8664 (0x21D8)</span>
<span style=color:teal>Executing command line: smsswd.exe /run: %SYSTEMROOT%\System32\WindowsPowerShell\v1.0\powershell.exe -NoProfile -WindowStyle Hidden -ExecutionPolicy Bypass -Command &#34;Invoke-WmiMethod -Namespace root\CCM -Class SMS_Client -Name TriggerSchedule &#39;{00000000-0000-0000-0000-000000000021}&#39;;sleep -seconds 120;&#34;    TSManager   6/14/2018 10:31:22 PM   8664 (0x21D8)</span>
<span style=color:teal>[ smsswd.exe ]  InstallSoftware 6/14/2018 10:31:22 PM   9480 (0x2508)</span>
<span style=color:teal>PackageID</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#d14>&#39;&#39;  InstallSoftware 6/14/2018 10:31:22 PM   9480 (0x2508)</span>
<span style=color:teal>BaseVar</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#d14>&#39;&#39;, ContinueOnError=&#39;&#39;    InstallSoftware 6/14/2018 10:31:22 PM   9480 (0x2508)</span>
<span style=color:teal>ProgramName</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#d14>&#39;C:\Windows\System32\WindowsPowerShell\v1.0\powershell.exe -NoProfile -WindowStyle Hidden -ExecutionPolicy Bypass -Command &#34;Invoke-WmiMethod -Namespace root\CCM -Class SMS_Client -Name TriggerSchedule &#39;{00000000-0000-0000-0000-000000000021}&#39;;sleep -seconds 120;&#34;&#39;   InstallSoftware 6/14/2018 10:31:22 PM   9480 (0x2508)</span>
<span style=color:teal>SwdAction</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#d14>&#39;0001&#39;  InstallSoftware 6/14/2018 10:31:22 PM   9480 (0x2508)</span>
<span style=color:teal>Command line for extension .exe is &#34;%1&#34; %*  InstallSoftware 6/14/2018 10:31:22 PM   9480 (0x2508)</span>
<span style=color:teal>Set command line: Run command line  InstallSoftware 6/14/2018 10:31:22 PM   9480 (0x2508)</span>
<span style=color:teal>Working dir &#39;not set&#39;   InstallSoftware 6/14/2018 10:31:22 PM   9480 (0x2508)</span>
<span style=color:teal>Executing command line: Run command line    InstallSoftware 6/14/2018 10:31:22 PM   9480 (0x2508)</span>
<span style=color:teal>InstallSoftware 6/14/2018 10:31:25 PM   9480 (0x2508)</span>
<span style=color:teal>InstallSoftware 6/14/2018 10:31:25 PM   9480 (0x2508)</span>
<span style=color:teal>__GENUS          : 1    InstallSoftware 6/14/2018 10:31:25 PM   9480 (0x2508)</span>
<span style=color:teal>__CLASS          : __PARAMETERS InstallSoftware 6/14/2018 10:31:25 PM   9480 (0x2508)</span>
<span style=color:teal>__SUPERCLASS     :  InstallSoftware 6/14/2018 10:31:25 PM   9480 (0x2508)</span>
<span style=color:teal>__DYNASTY        : __PARAMETERS InstallSoftware 6/14/2018 10:31:25 PM   9480 (0x2508)</span>
<span style=color:teal>__RELPATH        : __PARAMETERS InstallSoftware 6/14/2018 10:31:25 PM   9480 (0x2508)</span>
<span style=color:teal>__PROPERTY_COUNT : 1    InstallSoftware 6/14/2018 10:31:25 PM   9480 (0x2508)</span>
<span style=color:teal>__DERIVATION     : {}   InstallSoftware 6/14/2018 10:31:25 PM   9480 (0x2508)</span>
<span style=color:teal>__SERVER         : WS01 InstallSoftware 6/14/2018 10:31:25 PM   9480 (0x2508)</span>
<span style=color:teal>__NAMESPACE      : ROOT\ccm InstallSoftware 6/14/2018 10:31:25 PM   9480 (0x2508)</span>
<span style=color:teal>__PATH           : \\WS01\ROOT\ccm:__PARAMETERS InstallSoftware 6/14/2018 10:31:25 PM   9480 (0x2508)</span>
<span style=color:teal>ReturnValue      :  InstallSoftware 6/14/2018 10:31:25 PM   9480 (0x2508)</span>
<span style=color:teal>PSComputerName   : WS01 InstallSoftware 6/14/2018 10:31:25 PM   9480 (0x2508)</span>
</code></pre></td></tr></table>
</div>
</div><h2 id=update-6152018>Update 6/15/2018</h2>
<p>I submitted a PR on GitHub to add all of the schedule codes to the SDK and it got MERGED!</p>
<p><a href=https://github.com/MicrosoftDocs/SCCMdocs/pull/604#event-1683727219>https://github.com/MicrosoftDocs/SCCMdocs/pull/604#event-1683727219</a>
<a href=https://docs.microsoft.com/sccm/develop/reference/core/clients/client-classes/triggerschedule-method-in-class-sms_client>https://docs.microsoft.com/sccm/develop/reference/core/clients/client-classes/triggerschedule-method-in-class-sms_client</a></p>
</div>
<comments id=comments>
<script src=https://utteranc.es/client.js repo=AdamGrossTX/asquaredozen issue-term=title label="blog comment" theme=github-light crossorigin=anonymous async></script>
</comments>
</article>
</div>
</div>
</div>
<footer id=footer>
<div class=container>
<div id=footer-copyright>
<p class=copyright>&copy; 2021 Adam Gross - https://www.asquaredozen.com - A Square Dozen</a></p>
</div>
</div>
</footer>
</div>
</body>
</html>