<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=keyword content="ConfigMgr Microsoft MVP Gross Intune Windows"><meta name=viewport content="width=device-width"><meta name=description content="A.Gross Blog | Adam Gross Enterprise Mobility MVP"><link rel="shortcut icon" href=/img/favicon.ico><title>Autopilot Profile causes Device Rename after ConfigMgr OSD Task Sequence and Breaks AD Domain Trust-A Square Dozen | A. Gross Blog</title><link rel=canonical href=/2020/12/02/autopilot-profile-causes-device-rename-after-configmgr-osd-task-sequence-and-breaks-ad-domain-trust/><link rel=stylesheet href=/css/style.css><link rel=stylesheet href=https://www.asquaredozen.com/css/custom.css><script src=https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js></script>
<script src=https://ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js></script>
<script src=https://www.asquaredozen.com/js/jquery.slicknav.js></script>
<script src=https://www.asquaredozen.com/js/asd_SlickNav_Mobile.js></script>
<script src=https://www.asquaredozen.com/js/custom.js></script>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-DYVXTRTXN4"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-DYVXTRTXN4",{anonymize_ip:!1})}</script><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://www.asquaredozen.com/img/ASquareDozen-Logo_Horiz_Twitter.png"><meta name=twitter:title content="Autopilot Profile causes Device Rename after ConfigMgr OSD Task Sequence and Breaks AD Domain Trust"><meta name=twitter:description content="We got some new hardware models in this week and added drivers to our ConfigMgr OSD Task Sequence (with Windows 10 1909 serviced with November 2020 updates) to test. One of the devices kept ending up with a broken domain trust relationship when you attempt to log in immediately following build completion.
The security database on the server does not have a computer account for this workstation trust relationship One clue that we had was that something was renaming the device."><meta property="og:title" content="Autopilot Profile causes Device Rename after ConfigMgr OSD Task Sequence and Breaks AD Domain Trust"><meta property="og:description" content="We got some new hardware models in this week and added drivers to our ConfigMgr OSD Task Sequence (with Windows 10 1909 serviced with November 2020 updates) to test. One of the devices kept ending up with a broken domain trust relationship when you attempt to log in immediately following build completion.
The security database on the server does not have a computer account for this workstation trust relationship One clue that we had was that something was renaming the device."><meta property="og:type" content="article"><meta property="og:url" content="https://www.asquaredozen.com/2020/12/02/autopilot-profile-causes-device-rename-after-configmgr-osd-task-sequence-and-breaks-ad-domain-trust/"><meta property="og:image" content="https://www.asquaredozen.com/img/ASquareDozen-Logo_Horiz_Twitter.png"><meta property="article:section" content="posts"><meta property="article:published_time" content="2020-12-02T22:54:15+00:00"><meta property="article:modified_time" content="2020-12-02T22:54:15+00:00"><meta property="og:site_name" content="A Square Dozen | A. Gross Blog"></head><body class="home blog"><div id=asd-container><div id=top-bar><div class=container><div id=nav-wrapper><ul class=menu id=menu-top-menu><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home"><a href=/>Home</a></li><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home"><a href=#><span>Feature Updates</span></a><ul class="sub-menu menu-item menu-item-type-custom menu-item-object-custom menu-item-home"><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home"><a href=/2020/07/26/demystifying-windows-10-feature-update-blocks/>Demystifying Windows 10 Feature Update Blocks</a></li><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home"><a href=/2019/08/22/windows-10-feature-updates-leveraging-setupdiag-for-better-reporting/>Windows 10 Feature Updates – Leveraging SetupDiag for Better Reporting</a></li><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home"><a href=/2019/10/05/windows-10-feature-updates-the-challenge-of-servicing-in-the-enterprise/>Windows 10 Feature Updates – The Challenge of Servicing in the Enterprise</a></li><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home"><a href=/2019/08/25/windows-10-feature-updates-using-custom-action-scripts/>Windows 10 Feature Updates – Using Custom Action Scripts</a></li><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home"><a href=/2019/08/25/windows-10-feature-updates-using-setupconfig-ini-to-manage-feature-updates-in-the-enterprise/>Windows 10 Feature Updates – Using Setupconfig.ini to Manage Feature Updates in the Enterprise</a></li></ul></li><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home"><a href=/2019/02/12/the-system-center-configuration-manager-adminservice-guide/><span>ConfigMgr AdminService</span></a></li><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home"><a href=#><span>802.1x for OSD</span></a><ul class="sub-menu menu-item menu-item-type-custom menu-item-object-custom menu-item-home"><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home"><a href=/2018/07/29/configuring-802-1x-authentication-for-windows-deployment-part-1-building-an-802-1x-computer-authentication-script/>Part 1 – Building an 802.1x Computer Authentication Script</a></li><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home"><a href=/2018/07/29/configuring-802-1x-authentication-for-windows-deployment-part-2-building-an-802-1x-enabled-winpe-boot-image/>Part 2 – Building an 802.1x Enabled WinPE Boot Image</a></li><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home"><a href=/2018/07/29/configuring-802-1x-authentication-for-windows-deployment-part-3-integrating-802-1x-authentication-into-a-bare-metal-task-sequence/>Part 3 – Integrating 802.1x Authentication into a Bare Metal Task Sequence</a></li><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home"><a href=/2018/07/29/configuring-802-1x-authentication-for-windows-deployment-part-4-integrating-802-1x-authentication-into-an-in-place-upgrade-task-sequence/>Part 4 – Integrating 802.1x Authentication into an In-Place Upgrade Task Sequence</a></li><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home"><a href=/2018/09/29/configuring-802-1x-authentication-for-windows-deployment-part-5-dynamic-whitelisting-using-the-cisco-ise-external-restful-service/>Part 5 – Dynamic Whitelisting using the Cisco ISE External RESTful Service</a></li><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home"><a href=/2018/07/29/configuring-802-1x-authentication-for-windows-deployment-tips-and-tricks/>Tips and Tricks</a></li></ul></li><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home"><a href=#><span>Task Sequence Hacks</span></a><ul class="sub-menu menu-item menu-item-type-custom menu-item-object-custom menu-item-home"><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home"><a href=/2018/11/29/building-a-better-task-sequence/>Building a Better Task Sequence</a></li><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home"><a href=/2019/04/30/building-a-smarter-task-sequence/>Building a Smarter Task Sequence</a></li><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home"><a href=/2018/12/14/building-an-even-better-task-sequence/>Building An Even Better Task Sequence</a></li><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home"><a href=/2018/07/16/clearing-local-group-policies-during-an-windows-7-to-10-in-place-upgrade-task-sequence/>Clearing Local Group Policies during an Windows 7 to 10 In-Place Upgrade Task Sequence</a></li><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home"><a href=/2018/10/03/debugging-sccm-configmgr-task-sequences-on-the-fly/>Debugging SCCM/ConfigMgr Task Sequences on the Fly</a></li><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home"><a href=/2018/07/11/dynamically-updating-unattend-xml-during-an-osd-task-sequence-using-mdt-variables-and-zti-scripts/>Dynamically Updating Unattend.XML during an OSD Task Sequence using MDT Variables and ZTI Scripts.</a></li><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home"><a href=/2018/06/14/triggering-configmgr-client-actions-from-a-task-sequence/>Triggering ConfigMgr Client Actions from a Task Sequence</a></li><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home"><a href=/2018/08/27/using-sccm-task-sequence-variables-as-scripts/>Using SCCM Task Sequence Variables as Scripts</a></li></ul></li><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home"><a href=https://github.com/AdamGrossTX><span>GitHub</span></a></li><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home"><a href=#><span>MORE></span></a><ul class="sub-menu menu-item menu-item-type-custom menu-item-object-custom menu-item-home"><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home"><a href=/about/>About</a></li><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home"><a href=/consulting/>Consulting</a></li><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home"><a href=/contact/>Contact</a></li></ul></li></ul></div><div id=top-search><a href=# class=search><i class="fa fa-search"></i></a><div class=show-search><form role=search method=get action=https://www.google.com/search id=searchform><input type=search placeholder="Search and hit enter..." name=q id=q title="Search and hit enter...">
<input type=hidden name=sitesearch value=https://www.asquaredozen.com>
<button type=submit value=Search></form></div></div><div class=menu id=menu-mobile></div></div></div><header id=header class=noslider><div class=container><div id=logo><h1><a href=https://www.asquaredozen.com><img src=/img/A-Square-Dozen-Logo-BlogHeader-1.png alt="A Square Dozen"></a></h1></div></div></header><div class=container><div id=content><div id=main class=fullwidth><article class="post type-post status-publish format-standard has-post-thumbnail hentry"><div class=post-header><h1>Autopilot Profile causes Device Rename after ConfigMgr OSD Task Sequence and Breaks AD Domain Trust</h1><span class=post-date>December 2, 2020</span></div><div class=post-entry><p>We got some new hardware models in this week and added drivers to our ConfigMgr OSD Task Sequence (with Windows 10 1909 serviced with November 2020 updates) to test. One of the devices kept ending up with a broken domain trust relationship when you attempt to log in immediately following build completion.</p><p><div class=image><figure><a href=image-6.png target=_blank><img src=image-6.png alt="The security database on the server does not have a computer account for this workstation trust relationship"></a><figcaption>The security database on the server does not have a computer account for this workstation trust relationship</figcaption></figure></div></p><p>One clue that we had was that something was renaming the device. We have a very basic naming convention SITE-SERIAL where SITE is 2-5 character code for the AD site/OU a device will be assigned to. The device was be in Active Directory in the right OU and properly domain joined, but at the logon screen in the username field if we typed .\ to show the device name instead of the domain name, the device name was only the SERIAL, no SITE- prefix. The smsts.log, setupact.log, unattend.xml all showed the correct device name through the entire process. Here&rsquo;s the rest of the story&mldr;</p><p><div class=image><figure><a href=image.png target=_blank><img src=image.png alt="Note - the serial in the screenshots doesn&amp;rsquo;t match the logs due to obfuscation of prod data"></a><figcaption>Note - the serial in the screenshots doesn't match the logs due to obfuscation of prod data</figcaption></figure></div></p><h2 id=trudging-through-logs>Trudging Through Logs</h2><p>Like most people, I love (or is is loathe) digging through logs looking for a needle in a haystack. In this case, I needed to find evidence that showed that the device was properly named, but then was changed sometime later. I knew that it was named correctly at least until the domain join step and after digging through smsts.log, it was clear that it wasn&rsquo;t being changed during or by the Task Sequence at all. It was coming afterwards. I moved to the Event Viewer and started looking for <code>Event ID 6011</code> which would show that the device name had been changed and the device had been rebooted.</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-1> 1</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-2> 2</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-3> 3</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-4> 4</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-5><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-5> 5</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-6><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-6> 6</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-7><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-7> 7</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-8><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-8> 8</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-9><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-9> 9</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-10><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-10>10</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-11><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-11>11</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-12><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-12>12</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-13><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-13>13</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-14><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-14>14</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-15><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-15>15</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-16><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-16>16</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-17><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-17>17</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-18><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-18>18</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-19><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-19>19</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-20><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-20>20</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-21><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-21>21</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-22><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-22>22</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-23><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-23>23</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-24><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-24>24</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-25><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-25>25</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-26><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-26>26</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-27><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-27>27</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-28><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-28>28</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-29><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-29>29</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-30><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-30>30</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-31><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-31>31</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-XML data-lang=XML><span style=display:flex><span>Information	12/1/2020 2:22:35 PM	EventLog	6011	None
</span></span><span style=display:flex><span>Log Name:      System
</span></span><span style=display:flex><span>Source:        EventLog
</span></span><span style=display:flex><span>Date:          12/1/2020 2:22:35 PM
</span></span><span style=display:flex><span>Event ID:      6011
</span></span><span style=display:flex><span>Task Category: None
</span></span><span style=display:flex><span>Level:         Information
</span></span><span style=display:flex><span>Keywords:      Classic
</span></span><span style=display:flex><span>User:          N/A
</span></span><span style=display:flex><span>Computer:      12345678.asd.net
</span></span><span style=display:flex><span>Description:
</span></span><span style=display:flex><span>The NetBIOS name and DNS host name of this machine have been changed from ASD-12345678 to 12345678.
</span></span><span style=display:flex><span>Event Xml:
</span></span><span style=display:flex><span><span style=color:navy>&lt;Event</span> <span style=color:teal>xmlns=</span><span style=color:#d14>&#34;http://schemas.microsoft.com/win/2004/08/events/event&#34;</span><span style=color:navy>&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:navy>&lt;System&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:navy>&lt;Provider</span> <span style=color:teal>Name=</span><span style=color:#d14>&#34;EventLog&#34;</span> <span style=color:navy>/&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:navy>&lt;EventID</span> <span style=color:teal>Qualifiers=</span><span style=color:#d14>&#34;32768&#34;</span><span style=color:navy>&gt;</span>6011<span style=color:navy>&lt;/EventID&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:navy>&lt;Level&gt;</span>4<span style=color:navy>&lt;/Level&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:navy>&lt;Task&gt;</span>0<span style=color:navy>&lt;/Task&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:navy>&lt;Keywords&gt;</span>0x80000000000000<span style=color:navy>&lt;/Keywords&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:navy>&lt;TimeCreated</span> <span style=color:teal>SystemTime=</span><span style=color:#d14>&#34;2020-12-01T20:22:35.941883400Z&#34;</span> <span style=color:navy>/&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:navy>&lt;EventRecordID&gt;</span>927<span style=color:navy>&lt;/EventRecordID&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:navy>&lt;Channel&gt;</span>System<span style=color:navy>&lt;/Channel&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:navy>&lt;Computer&gt;</span>12345678.asd.net<span style=color:navy>&lt;/Computer&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:navy>&lt;Security</span> <span style=color:navy>/&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:navy>&lt;/System&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:navy>&lt;EventData&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:navy>&lt;Data&gt;</span>ASD-12345678<span style=color:navy>&lt;/Data&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:navy>&lt;Data&gt;</span>12345678<span style=color:navy>&lt;/Data&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:navy>&lt;/EventData&gt;</span>
</span></span><span style=display:flex><span><span style=color:navy>&lt;/Event&gt;</span>
</span></span></code></pre></td></tr></table></div></div><p>Once I had the base timestamp to work from, I was able to narrow my search to a specific time that this could have happened. I scrolled back in time and and found <code>Event ID 1074</code> which showed that the reboot was triggered by CloudExperienceHost.</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-1> 1</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-2> 2</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-3> 3</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-4> 4</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-5><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-5> 5</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-6><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-6> 6</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-7><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-7> 7</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-8><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-8> 8</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-9><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-9> 9</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-10><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-10>10</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-11><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-11>11</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-12><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-12>12</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-13><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-13>13</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-14><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-14>14</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-15><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-15>15</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-16><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-16>16</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-17><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-17>17</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-18><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-18>18</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-19><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-19>19</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-20><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-20>20</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-21><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-21>21</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-22><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-22>22</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-23><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-23>23</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-24><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-24>24</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-25><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-25>25</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-26><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-26>26</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-27><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-27>27</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-28><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-28>28</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-29><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-29>29</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-30><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-30>30</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-31><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-31>31</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-32><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-32>32</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-33><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-33>33</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-34><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-34>34</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-35><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-35>35</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-36><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-36>36</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-37><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-37>37</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-38><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-38>38</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-39><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-39>39</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-40><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-40>40</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-41><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-41>41</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-42><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-42>42</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-43><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-43>43</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-44><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-44>44</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-XML data-lang=XML><span style=display:flex><span>Information	12/1/2020 2:22:04 PM	User32	1074	None
</span></span><span style=display:flex><span>Log Name:      System
</span></span><span style=display:flex><span>Source:        User32
</span></span><span style=display:flex><span>Date:          12/1/2020 2:22:04 PM
</span></span><span style=display:flex><span>Event ID:      1074
</span></span><span style=display:flex><span>Task Category: None
</span></span><span style=display:flex><span>Level:         Information
</span></span><span style=display:flex><span>Keywords:      Classic
</span></span><span style=display:flex><span>User:          SYSTEM
</span></span><span style=display:flex><span>Computer:      ASD-12345678.asd.net
</span></span><span style=display:flex><span>Description:
</span></span><span style=display:flex><span>The process C:\Windows\System32\CloudExperienceHostBroker.exe (ASD-12345678) has initiated the restart of computer ASD-12345678 on behalf of user NT AUTHORITY\SYSTEM for the following reason: Operating System: Reconfiguration (Unplanned)
</span></span><span style=display:flex><span> Reason Code: 0x20004
</span></span><span style=display:flex><span> Shutdown Type: restart
</span></span><span style=display:flex><span> Comment: 
</span></span><span style=display:flex><span>Event Xml:
</span></span><span style=display:flex><span><span style=color:navy>&lt;Event</span> <span style=color:teal>xmlns=</span><span style=color:#d14>&#34;http://schemas.microsoft.com/win/2004/08/events/event&#34;</span><span style=color:navy>&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:navy>&lt;System&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:navy>&lt;Provider</span> <span style=color:teal>Name=</span><span style=color:#d14>&#34;User32&#34;</span> <span style=color:teal>Guid=</span><span style=color:#d14>&#34;{b0aa8734-56f7-41cc-b2f4-de228e98b946}&#34;</span> <span style=color:teal>EventSourceName=</span><span style=color:#d14>&#34;User32&#34;</span> <span style=color:navy>/&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:navy>&lt;EventID</span> <span style=color:teal>Qualifiers=</span><span style=color:#d14>&#34;32768&#34;</span><span style=color:navy>&gt;</span>1074<span style=color:navy>&lt;/EventID&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:navy>&lt;Version&gt;</span>0<span style=color:navy>&lt;/Version&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:navy>&lt;Level&gt;</span>4<span style=color:navy>&lt;/Level&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:navy>&lt;Task&gt;</span>0<span style=color:navy>&lt;/Task&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:navy>&lt;Opcode&gt;</span>0<span style=color:navy>&lt;/Opcode&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:navy>&lt;Keywords&gt;</span>0x8080000000000000<span style=color:navy>&lt;/Keywords&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:navy>&lt;TimeCreated</span> <span style=color:teal>SystemTime=</span><span style=color:#d14>&#34;2020-12-01T20:22:04.988802400Z&#34;</span> <span style=color:navy>/&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:navy>&lt;EventRecordID&gt;</span>918<span style=color:navy>&lt;/EventRecordID&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:navy>&lt;Correlation</span> <span style=color:navy>/&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:navy>&lt;Execution</span> <span style=color:teal>ProcessID=</span><span style=color:#d14>&#34;836&#34;</span> <span style=color:teal>ThreadID=</span><span style=color:#d14>&#34;3048&#34;</span> <span style=color:navy>/&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:navy>&lt;Channel&gt;</span>System<span style=color:navy>&lt;/Channel&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:navy>&lt;Computer&gt;</span>ASD-12345678.asd.net<span style=color:navy>&lt;/Computer&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:navy>&lt;Security</span> <span style=color:teal>UserID=</span><span style=color:#d14>&#34;S-1-5-18&#34;</span> <span style=color:navy>/&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:navy>&lt;/System&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:navy>&lt;EventData&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:navy>&lt;Data</span> <span style=color:teal>Name=</span><span style=color:#d14>&#34;param1&#34;</span><span style=color:navy>&gt;</span>C:\Windows\System32\CloudExperienceHostBroker.exe (ASD-12345678)<span style=color:navy>&lt;/Data&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:navy>&lt;Data</span> <span style=color:teal>Name=</span><span style=color:#d14>&#34;param2&#34;</span><span style=color:navy>&gt;</span>ASD-12345678<span style=color:navy>&lt;/Data&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:navy>&lt;Data</span> <span style=color:teal>Name=</span><span style=color:#d14>&#34;param3&#34;</span><span style=color:navy>&gt;</span>Operating System: Reconfiguration (Unplanned)<span style=color:navy>&lt;/Data&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:navy>&lt;Data</span> <span style=color:teal>Name=</span><span style=color:#d14>&#34;param4&#34;</span><span style=color:navy>&gt;</span>0x20004<span style=color:navy>&lt;/Data&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:navy>&lt;Data</span> <span style=color:teal>Name=</span><span style=color:#d14>&#34;param5&#34;</span><span style=color:navy>&gt;</span>restart<span style=color:navy>&lt;/Data&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:navy>&lt;Data</span> <span style=color:teal>Name=</span><span style=color:#d14>&#34;param6&#34;</span><span style=color:navy>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:navy>&lt;/Data&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:navy>&lt;Data</span> <span style=color:teal>Name=</span><span style=color:#d14>&#34;param7&#34;</span><span style=color:navy>&gt;</span>NT AUTHORITY\SYSTEM<span style=color:navy>&lt;/Data&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:navy>&lt;/EventData&gt;</span>
</span></span><span style=display:flex><span><span style=color:navy>&lt;/Event&gt;</span>
</span></span></code></pre></td></tr></table></div></div><p>When I looked at <code>C:\Windows\Panther\UnattendGC\setupact.log</code> I noticed that CloudExperienceHost had failed and created a memory dump around the same time the device rename and matched up with the timestamp on the restart event.</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-1> 1</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-2> 2</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-3> 3</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-4> 4</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-5><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-5> 5</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-6><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-6> 6</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-7><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-7> 7</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-8><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-8> 8</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-9><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-9> 9</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-10><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-10>10</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-11><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-11>11</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-12><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-12>12</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-13><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-13>13</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-14><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-14>14</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-15><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-15>15</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-16><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-16>16</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-17><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-17>17</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-18><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-18>18</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-19><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-19>19</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-20><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-20>20</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-21><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-21>21</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-22><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-22>22</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-23><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-23>23</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-24><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-24>24</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-25><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-25>25</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-26><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-26>26</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-27><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-27>27</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-XML data-lang=XML><span style=display:flex><span>2020-12-01 14:21:45, Info                         [taskhostw.exe] OOBE Monitor event received: 103
</span></span><span style=display:flex><span>2020-12-01 14:21:50, Info                         [CloudExperienceHostBroker.exe] Failed to load oobe.xml file at C:\WINDOWS\system32\oobe\info\oobe.xml with hr=0x80070003
</span></span><span style=display:flex><span>2020-12-01 14:21:50, Info                         [CloudExperienceHostBroker.exe] Failed to load oobe.xml file at C:\WINDOWS\system32\oobe\info\default\oobe.xml with hr=0x80070003
</span></span><span style=display:flex><span>2020-12-01 14:21:50, Info                         [CloudExperienceHostBroker.exe] Failed to load oobe.xml file at C:\WINDOWS\system32\oobe\info\244\oobe.xml with hr=0x80070003
</span></span><span style=display:flex><span>2020-12-01 14:21:50, Info                         [CloudExperienceHostBroker.exe] Failed to load oobe.xml file at C:\WINDOWS\system32\oobe\info\default\1033\oobe.xml with hr=0x80070003
</span></span><span style=display:flex><span>2020-12-01 14:21:50, Info                         [CloudExperienceHostBroker.exe] Failed to load oobe.xml file at C:\WINDOWS\system32\oobe\info\244\1033\oobe.xml with hr=0x80070003
</span></span><span style=display:flex><span>2020-12-01 14:21:50, Info                         [CloudExperienceHostBroker.exe] Opting in to IncludeDriverSets
</span></span><span style=display:flex><span>2020-12-01 14:21:50, Info                         [CloudExperienceHostBroker.exe] CZDPTask setting OOBE_GLOBAL_SETTING_ZDPSTATUS ZDP_Scanning.
</span></span><span style=display:flex><span>2020-12-01 14:21:51, Info                         [taskhostw.exe] OOBE Monitor event received: 104
</span></span><span style=display:flex><span>2020-12-01 14:21:56, Info                         [CloudExperienceHostBroker.exe] ISearchCompletedCallback::Invoke called
</span></span><span style=display:flex><span>2020-12-01 14:21:56, Info                         [CloudExperienceHostBroker.exe] Wait result from WU ZDP Search: 0X1
</span></span><span style=display:flex><span>2020-12-01 14:21:56, Info                         [CloudExperienceHostBroker.exe] Found 0 updates in collection.
</span></span><span style=display:flex><span>2020-12-01 14:21:56, Info                         [CloudExperienceHostBroker.exe] CZDPTask::CancelTask() Invoked.
</span></span><span style=display:flex><span>2020-12-01 14:21:56, Info                         [CloudExperienceHostBroker.exe] CZDPTask setting OOBE_GLOBAL_SETTING_ZDPSTATUS ZDP_Finished.
</span></span><span style=display:flex><span>2020-12-01 14:22:09, Info                         [taskhostw.exe] OOBE Monitor task stopped
</span></span><span style=display:flex><span>2020-12-01 14:22:36, Info                         [svchost.exe] Enter WinReIsWimBootEnabled
</span></span><span style=display:flex><span>2020-12-01 14:22:36, Info                         [svchost.exe] Parameters: pszWinDir: NULL
</span></span><span style=display:flex><span>2020-12-01 14:22:36, Info                         [svchost.exe] Exit WinReIsWimBootEnabled returns 0 with last error: 0x0
</span></span><span style=display:flex><span>2020-12-01 14:22:38, Info                         [taskhostw.exe] OOBE Monitor task background thread started
</span></span><span style=display:flex><span>2020-12-01 14:22:39, Info                         [taskhostw.exe] OOBE Monitor event received: 101
</span></span><span style=display:flex><span>2020-12-01 14:22:39, Info                         [taskhostw.exe] OOBE Monitor event received: 102
</span></span><span style=display:flex><span>2020-12-01 14:22:40, Info                         [taskhostw.exe] OOBE Monitor event received: 103
</span></span><span style=display:flex><span>2020-12-01 14:22:42, Info                         [CloudExperienceHostBroker.exe] UserOOBEController::Exit() started [1]
</span></span><span style=display:flex><span>2020-12-01 14:22:42, Info                         [taskhostw.exe] OOBE Monitor event received: 999
</span></span><span style=display:flex><span>2020-12-01 14:22:42, Info                         [CloudExperienceHostBroker.exe] Clearing Auto-logon values per request
</span></span><span style=display:flex><span>2020-12-01 14:22:42, Error                        [CloudExperienceHostBroker.exe] Disabling default account failed [hr=0xD00000E5]
</span></span><span style=display:flex><span>2020-12-01 14:25:40, FatalError [0x090001] PANTHR Exception (code 0xC0000005: ACCESS_VIOLATION) occurred at 0x00007FFDDADD2236 in C:\Windows\System32\oobe\UserOOBE.dll (+0000000000022236).  Minidump attached (47855 bytes) to diagerr.xml and C:\WINDOWS\Panther\UnattendGC\mndF37E.diagerr.mdmp.
</span></span></code></pre></td></tr></table></div></div><p>For no real reason, I decided to check if the machine was getting an Autopilot profile. The Event Viewer showed that the device had gotten an Autopilot json file, which seemed odd since this device shouldn&rsquo;t have had a profile assigned yet. I opened <code>C:\Windows\ServiceState\Autopilot</code> and found <code>AutopilotDDSZTDFile.json</code>. In here, I found the smoking gun!</p><p><div class=image><figure><a href=image-1.png target=_blank><img src=image-1.png alt="A Square Dozen Image"></a></figure></div></p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-1> 1</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-2> 2</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-3> 3</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-4> 4</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-5><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-5> 5</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-6><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-6> 6</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-7><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-7> 7</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-8><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-8> 8</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-9><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-9> 9</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-10><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-10>10</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-11><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-11>11</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-12><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-12>12</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-13><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-13>13</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-14><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-14>14</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-15><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-15>15</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-16><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-16>16</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-17><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-17>17</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-18><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-18>18</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-19><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-19>19</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-20><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-20>20</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-21><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-21>21</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-JSON data-lang=JSON><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:navy>&#34;AutopilotServiceCorrelationId&#34;</span>: <span style=color:#d14>&#34;XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:navy>&#34;ZtdRegistrationId&#34;</span>: <span style=color:#d14>&#34;XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:navy>&#34;AadDeviceId&#34;</span>: <span style=color:#d14>&#34;XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:navy>&#34;CloudAssignedOobeConfig&#34;</span>: <span style=color:#099>284</span>,
</span></span><span style=display:flex><span>    <span style=color:navy>&#34;CloudAssignedDomainJoinMethod&#34;</span>: <span style=color:#099>0</span>,
</span></span><span style=display:flex><span>    <span style=color:navy>&#34;CloudAssignedForcedEnrollment&#34;</span>: <span style=color:#099>1</span>,
</span></span><span style=display:flex><span>    <span style=color:navy>&#34;CloudAssignedTenantDomain&#34;</span>: <span style=color:#d14>&#34;XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:navy>&#34;CloudAssignedTenantId&#34;</span>: <span style=color:#d14>&#34;XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:navy>&#34;CloudAssignedMdmId&#34;</span>: <span style=color:#d14>&#34;XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:navy>&#34;CloudAssignedRegion&#34;</span>: <span style=color:#d14>&#34;os-default&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:navy>&#34;CloudAssignedLanguage&#34;</span>: <span style=color:#d14>&#34;os-default&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:navy>&#34;CloudAssignedDeviceName&#34;</span>: <span style=color:#d14>&#34;%SERIAL%&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:navy>&#34;DeploymentProfileName&#34;</span>: <span style=color:#d14>&#34;Autopilot&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:navy>&#34;IsExplicitProfileAssignment&#34;</span>: <span style=color:#000;font-weight:700>true</span>,
</span></span><span style=display:flex><span>    <span style=color:navy>&#34;CloudAssignedAutopilotUpdateDisabled&#34;</span>: <span style=color:#099>1</span>,
</span></span><span style=display:flex><span>    <span style=color:navy>&#34;CloudAssignedPrivacyDiagnostics&#34;</span>: <span style=color:#099>0</span>,
</span></span><span style=display:flex><span>    <span style=color:navy>&#34;HybridJoinSkipDCConnectivityCheck&#34;</span>: <span style=color:#099>0</span>,
</span></span><span style=display:flex><span>    <span style=color:navy>&#34;CloudAssignedAutopilotUpdateTimeout&#34;</span>: <span style=color:#099>1800000</span>,
</span></span><span style=display:flex><span>    <span style=color:navy>&#34;PolicyDownloadDate&#34;</span>: <span style=color:#d14>&#34;2020-12-01T20:21:49Z&#34;</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div><h2 id=making-sense-of-things>Making Sense of Things</h2><p>As you may know, you can only assign custom naming to Azure AD Joined devices, not Hybrid, during Autopilot. How could this be happening during OSD?</p><p>During OSD, the device is installing Windows then apps and settings and is locked out until it&rsquo;s done. Once it is finished, it will reboot and is supposed to skip OOBE and go to the logon screen.
We recently removed our custom Unattend.XML file from our TS since we were specifically using it to suppress OOBE post OSD using some now deprecated settings (<strong>SkipUserOOBE</strong> & <strong>SkipMachineOOBE</strong>) that still work.</p><p><div class=image><figure><a href=image-2.png target=_blank><img src=image-2.png alt="A Square Dozen Image"></a><figcaption>https://docs.microsoft.com/windows/deployment/deploy-windows-mdt/create-a-windows-10-reference-image#edit-the-unattendxml-file-for-windows10-enterprise</figcaption></figure></div></p><p><div class=image><figure><a href=image-4.png target=_blank><img src=image-4.png alt="A Square Dozen Image"></a><figcaption>Network OOBE Screen</figcaption></figure></div></p><p>So it appears in the brief moment where OOBE is being shown, the device is contacting the Autopilot service and pulling down an assigned Autopilot profile.</p><h2 id=finding-a-workaround>Finding a Workaround</h2><p>This next section describes the troubleshooting process that I used to validate the source of the issue.</p><h4 id=option-1-supported>Option 1 (supported)</h4><p>The &lsquo;supported&rsquo; solution to this problem would be to NOT assign Autopilot profiles (specifically ones with naming templates configured) to devices that you are NOT Autopiloting. This is the cleanest option and doesn&rsquo;t require adding in deprecated configurations to your unattend.xml. This SHOULDN&rsquo;T be happening, but as Michael Niehaus pointed out to me after reading this post, he tried for 2 years to get this fixed and ultimately, just don&rsquo;t do it (assign an Autopilot profile to a non-Autopilot device) that way.</p><h4 id=option-2-unsupported>Option 2 (unsupported)</h4><p>To test my theory about OOBE, I added unattend.XML back to the Task Sequence and built the machine. The device didn&rsquo;t pull down the Autopilot profile and didn&rsquo;t get renamed. I then removed the deprecated lines from the unattend.xml file and built the machine again. This time it failed the same as before, confirming my suspicion.</p><p>This is my default unattend.xml.</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-4-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-4-1> 1</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-4-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-4-2> 2</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-4-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-4-3> 3</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-4-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-4-4> 4</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-4-5><a style=outline:none;text-decoration:none;color:inherit href=#hl-4-5> 5</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-4-6><a style=outline:none;text-decoration:none;color:inherit href=#hl-4-6> 6</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-4-7><a style=outline:none;text-decoration:none;color:inherit href=#hl-4-7> 7</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-4-8><a style=outline:none;text-decoration:none;color:inherit href=#hl-4-8> 8</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-4-9><a style=outline:none;text-decoration:none;color:inherit href=#hl-4-9> 9</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-4-10><a style=outline:none;text-decoration:none;color:inherit href=#hl-4-10>10</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-4-11><a style=outline:none;text-decoration:none;color:inherit href=#hl-4-11>11</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-4-12><a style=outline:none;text-decoration:none;color:inherit href=#hl-4-12>12</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-4-13><a style=outline:none;text-decoration:none;color:inherit href=#hl-4-13>13</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-4-14><a style=outline:none;text-decoration:none;color:inherit href=#hl-4-14>14</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-4-15><a style=outline:none;text-decoration:none;color:inherit href=#hl-4-15>15</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-4-16><a style=outline:none;text-decoration:none;color:inherit href=#hl-4-16>16</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-4-17><a style=outline:none;text-decoration:none;color:inherit href=#hl-4-17>17</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-4-18><a style=outline:none;text-decoration:none;color:inherit href=#hl-4-18>18</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-4-19><a style=outline:none;text-decoration:none;color:inherit href=#hl-4-19>19</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-4-20><a style=outline:none;text-decoration:none;color:inherit href=#hl-4-20>20</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-4-21><a style=outline:none;text-decoration:none;color:inherit href=#hl-4-21>21</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-4-22><a style=outline:none;text-decoration:none;color:inherit href=#hl-4-22>22</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-4-23><a style=outline:none;text-decoration:none;color:inherit href=#hl-4-23>23</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-4-24><a style=outline:none;text-decoration:none;color:inherit href=#hl-4-24>24</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-4-25><a style=outline:none;text-decoration:none;color:inherit href=#hl-4-25>25</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-4-26><a style=outline:none;text-decoration:none;color:inherit href=#hl-4-26>26</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-4-27><a style=outline:none;text-decoration:none;color:inherit href=#hl-4-27>27</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-XML data-lang=XML><span style=display:flex><span><span style=color:#999;font-weight:700;font-style:italic>&lt;?xml version=&#34;1.0&#34;?&gt;</span>
</span></span><span style=display:flex><span><span style=color:navy>&lt;unattend</span> <span style=color:teal>xmlns=</span><span style=color:#d14>&#34;urn:schemas-microsoft-com:unattend&#34;</span><span style=color:navy>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:navy>&lt;settings</span> <span style=color:teal>pass=</span><span style=color:#d14>&#34;oobeSystem&#34;</span><span style=color:navy>&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:navy>&lt;component</span> <span style=color:teal>name=</span><span style=color:#d14>&#34;Microsoft-Windows-Shell-Setup&#34;</span> <span style=color:teal>processorArchitecture=</span><span style=color:#d14>&#34;amd64&#34;</span> <span style=color:teal>publicKeyToken=</span><span style=color:#d14>&#34;31bf3856ad364e35&#34;</span> <span style=color:teal>language=</span><span style=color:#d14>&#34;neutral&#34;</span> <span style=color:teal>versionScope=</span><span style=color:#d14>&#34;nonSxS&#34;</span> <span style=color:teal>xmlns:wcm=</span><span style=color:#d14>&#34;http://schemas.microsoft.com/WMIConfig/2002/State&#34;</span> <span style=color:teal>xmlns:xsi=</span><span style=color:#d14>&#34;http://www.w3.org/2001/XMLSchema-instance&#34;</span><span style=color:navy>&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:navy>&lt;OOBE&gt;</span>
</span></span><span style=display:flex><span>                <span style=color:navy>&lt;SkipUserOOBE&gt;</span>true<span style=color:navy>&lt;/SkipUserOOBE&gt;</span>
</span></span><span style=display:flex><span>                <span style=color:navy>&lt;SkipMachineOOBE&gt;</span>true<span style=color:navy>&lt;/SkipMachineOOBE&gt;</span>
</span></span><span style=display:flex><span>                <span style=color:navy>&lt;NetworkLocation&gt;</span>Work<span style=color:navy>&lt;/NetworkLocation&gt;</span>
</span></span><span style=display:flex><span>                <span style=color:navy>&lt;ProtectYourPC&gt;</span>3<span style=color:navy>&lt;/ProtectYourPC&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:navy>&lt;/OOBE&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:navy>&lt;TimeZone&gt;</span>Central Standard Time<span style=color:navy>&lt;/TimeZone&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:navy>&lt;/component&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:navy>&lt;component</span> <span style=color:teal>name=</span><span style=color:#d14>&#34;Microsoft-Windows-International-Core&#34;</span> <span style=color:teal>processorArchitecture=</span><span style=color:#d14>&#34;amd64&#34;</span> <span style=color:teal>publicKeyToken=</span><span style=color:#d14>&#34;31bf3856ad364e35&#34;</span> <span style=color:teal>language=</span><span style=color:#d14>&#34;neutral&#34;</span> <span style=color:teal>versionScope=</span><span style=color:#d14>&#34;nonSxS&#34;</span> <span style=color:teal>xmlns:wcm=</span><span style=color:#d14>&#34;http://schemas.microsoft.com/WMIConfig/2002/State&#34;</span> <span style=color:teal>xmlns:xsi=</span><span style=color:#d14>&#34;http://www.w3.org/2001/XMLSchema-instance&#34;</span><span style=color:navy>&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:navy>&lt;InputLocale&gt;</span>0409:00000409<span style=color:navy>&lt;/InputLocale&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:navy>&lt;SystemLocale&gt;</span>en-US<span style=color:navy>&lt;/SystemLocale&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:navy>&lt;UILanguage&gt;</span>en-US<span style=color:navy>&lt;/UILanguage&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:navy>&lt;UILanguageFallback&gt;</span>en-US<span style=color:navy>&lt;/UILanguageFallback&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:navy>&lt;UserLocale&gt;</span>en-US<span style=color:navy>&lt;/UserLocale&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:navy>&lt;/component&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:navy>&lt;/settings&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:navy>&lt;settings</span> <span style=color:teal>pass=</span><span style=color:#d14>&#34;specialize&#34;</span><span style=color:navy>&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:navy>&lt;component</span> <span style=color:teal>name=</span><span style=color:#d14>&#34;Microsoft-Windows-Shell-Setup&#34;</span> <span style=color:teal>processorArchitecture=</span><span style=color:#d14>&#34;amd64&#34;</span> <span style=color:teal>publicKeyToken=</span><span style=color:#d14>&#34;31bf3856ad364e35&#34;</span> <span style=color:teal>language=</span><span style=color:#d14>&#34;neutral&#34;</span> <span style=color:teal>versionScope=</span><span style=color:#d14>&#34;nonSxS&#34;</span> <span style=color:teal>xmlns:wcm=</span><span style=color:#d14>&#34;http://schemas.microsoft.com/WMIConfig/2002/State&#34;</span> <span style=color:teal>xmlns:xsi=</span><span style=color:#d14>&#34;http://www.w3.org/2001/XMLSchema-instance&#34;</span><span style=color:navy>&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:navy>&lt;ComputerName&gt;</span>ComputerName<span style=color:navy>&lt;/ComputerName&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:navy>&lt;/component&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:navy>&lt;/settings&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:navy>&lt;cpi:offlineImage</span> <span style=color:teal>cpi:source=</span><span style=color:#d14>&#34;wim:c:/temp/install.wim#Windows 10 Enterprise&#34;</span> <span style=color:teal>xmlns:cpi=</span><span style=color:#d14>&#34;urn:schemas-microsoft-com:cpi&#34;</span> <span style=color:navy>/&gt;</span>
</span></span><span style=display:flex><span><span style=color:navy>&lt;/unattend&gt;</span>
</span></span></code></pre></td></tr></table></div></div><p><div class=image><figure><a href=image-3.png target=_blank><img src=image-3.png alt="Apply Operating System with unattend.xml"></a><figcaption>Apply Operating System with unattend.xml</figcaption></figure></div></p><p>Here&rsquo;s the unattend.xml after the Task Sequence Apply steps have completed just before the Setup Windows and ConfigMgr step.</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-1> 1</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-2> 2</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-3> 3</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-4> 4</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-5><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-5> 5</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-6><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-6> 6</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-7><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-7> 7</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-8><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-8> 8</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-9><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-9> 9</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-10><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-10>10</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-11><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-11>11</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-12><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-12>12</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-13><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-13>13</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-14><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-14>14</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-15><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-15>15</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-16><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-16>16</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-17><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-17>17</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-18><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-18>18</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-19><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-19>19</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-20><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-20>20</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-21><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-21>21</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-22><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-22>22</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-23><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-23>23</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-24><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-24>24</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-25><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-25>25</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-26><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-26>26</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-27><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-27>27</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-28><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-28>28</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-29><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-29>29</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-30><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-30>30</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-31><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-31>31</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-32><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-32>32</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-33><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-33>33</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-34><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-34>34</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-35><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-35>35</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-36><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-36>36</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-37><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-37>37</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-38><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-38>38</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-39><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-39>39</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-40><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-40>40</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-41><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-41>41</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-42><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-42>42</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-43><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-43>43</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-44><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-44>44</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-45><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-45>45</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-46><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-46>46</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-47><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-47>47</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-48><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-48>48</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-49><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-49>49</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-50><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-50>50</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-51><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-51>51</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-XML data-lang=XML><span style=display:flex><span><span style=color:#999;font-weight:700;font-style:italic>&lt;?xml version=&#34;1.0&#34;?&gt;</span>
</span></span><span style=display:flex><span><span style=color:navy>&lt;unattend</span> <span style=color:teal>xmlns=</span><span style=color:#d14>&#34;urn:schemas-microsoft-com:unattend&#34;</span><span style=color:navy>&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:navy>&lt;cpi:offlineImage</span> <span style=color:teal>cpi:source=</span><span style=color:#d14>&#34;wim:c:/temp/install.wim#Windows 10 Enterprise&#34;</span> <span style=color:teal>xmlns:cpi=</span><span style=color:#d14>&#34;urn:schemas-microsoft-com:cpi&#34;</span><span style=color:navy>/&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:navy>&lt;settings</span> <span style=color:teal>xmlns=</span><span style=color:#d14>&#34;urn:schemas-microsoft-com:unattend&#34;</span> <span style=color:teal>pass=</span><span style=color:#d14>&#34;oobeSystem&#34;</span><span style=color:navy>&gt;&lt;component</span> <span style=color:teal>name=</span><span style=color:#d14>&#34;Microsoft-Windows-Shell-Setup&#34;</span> <span style=color:teal>language=</span><span style=color:#d14>&#34;neutral&#34;</span> <span style=color:teal>processorArchitecture=</span><span style=color:#d14>&#34;amd64&#34;</span> <span style=color:teal>publicKeyToken=</span><span style=color:#d14>&#34;31bf3856ad364e35&#34;</span> <span style=color:teal>versionScope=</span><span style=color:#d14>&#34;nonSxS&#34;</span> <span style=color:teal>xmlns:wcm=</span><span style=color:#d14>&#34;http://schemas.microsoft.com/WMIConfig/2002/State&#34;</span> <span style=color:teal>xmlns:xsi=</span><span style=color:#d14>&#34;http://www.w3.org/2001/XMLSchema-instance&#34;</span><span style=color:navy>&gt;</span>
</span></span><span style=display:flex><span>			<span style=color:navy>&lt;OOBE&gt;</span>
</span></span><span style=display:flex><span>			    <span style=color:navy>&lt;SkipUserOOBE&gt;</span>true<span style=color:navy>&lt;/SkipUserOOBE&gt;</span>
</span></span><span style=display:flex><span>                <span style=color:navy>&lt;SkipMachineOOBE&gt;</span>true<span style=color:navy>&lt;/SkipMachineOOBE&gt;</span>
</span></span><span style=display:flex><span>				<span style=color:navy>&lt;ProtectYourPC&gt;</span>3<span style=color:navy>&lt;/ProtectYourPC&gt;</span>
</span></span><span style=display:flex><span>				<span style=color:navy>&lt;NetworkLocation&gt;</span>Work<span style=color:navy>&lt;/NetworkLocation&gt;</span>
</span></span><span style=display:flex><span>				<span style=color:navy>&lt;HideEULAPage&gt;</span>true<span style=color:navy>&lt;/HideEULAPage&gt;</span>
</span></span><span style=display:flex><span>			<span style=color:navy>&lt;/OOBE&gt;</span>
</span></span><span style=display:flex><span>			<span style=color:navy>&lt;TimeZone&gt;</span>Central Standard Time<span style=color:navy>&lt;/TimeZone&gt;</span>
</span></span><span style=display:flex><span>			<span style=color:navy>&lt;RegisteredOrganization&gt;</span>A Square Dozen Lab<span style=color:navy>&lt;/RegisteredOrganization&gt;</span>
</span></span><span style=display:flex><span>			<span style=color:navy>&lt;UserAccounts&gt;</span>
</span></span><span style=display:flex><span>				<span style=color:navy>&lt;AdministratorPassword&gt;</span>
</span></span><span style=display:flex><span>					<span style=color:navy>&lt;Value&gt;</span>XXXXXXXXXXXXXXXXX<span style=color:navy>&lt;/Value&gt;</span>
</span></span><span style=display:flex><span>					<span style=color:navy>&lt;PlainText&gt;</span>false<span style=color:navy>&lt;/PlainText&gt;</span>
</span></span><span style=display:flex><span>				<span style=color:navy>&lt;/AdministratorPassword&gt;</span>
</span></span><span style=display:flex><span>			<span style=color:navy>&lt;/UserAccounts&gt;</span>
</span></span><span style=display:flex><span>			<span style=color:navy>&lt;RegisteredOwner&gt;</span>A Square Dozen Lab<span style=color:navy>&lt;/RegisteredOwner&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:navy>&lt;/component&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:navy>&lt;component</span> <span style=color:teal>name=</span><span style=color:#d14>&#34;Microsoft-Windows-International-Core&#34;</span> <span style=color:teal>language=</span><span style=color:#d14>&#34;neutral&#34;</span> <span style=color:teal>processorArchitecture=</span><span style=color:#d14>&#34;amd64&#34;</span> <span style=color:teal>publicKeyToken=</span><span style=color:#d14>&#34;31bf3856ad364e35&#34;</span> <span style=color:teal>versionScope=</span><span style=color:#d14>&#34;nonSxS&#34;</span> <span style=color:teal>xmlns:wcm=</span><span style=color:#d14>&#34;http://schemas.microsoft.com/WMIConfig/2002/State&#34;</span> <span style=color:teal>xmlns:xsi=</span><span style=color:#d14>&#34;http://www.w3.org/2001/XMLSchema-instance&#34;</span><span style=color:navy>&gt;</span>
</span></span><span style=display:flex><span>			<span style=color:navy>&lt;SystemLocale&gt;</span>en-US<span style=color:navy>&lt;/SystemLocale&gt;</span>
</span></span><span style=display:flex><span>			<span style=color:navy>&lt;UserLocale&gt;</span>en-US<span style=color:navy>&lt;/UserLocale&gt;</span>
</span></span><span style=display:flex><span>			<span style=color:navy>&lt;UILanguage&gt;</span>en-US<span style=color:navy>&lt;/UILanguage&gt;</span>
</span></span><span style=display:flex><span>			<span style=color:navy>&lt;InputLocale&gt;</span>0409:00000409<span style=color:navy>&lt;/InputLocale&gt;</span>
</span></span><span style=display:flex><span>			<span style=color:navy>&lt;UILanguageFallback&gt;</span>en-US<span style=color:navy>&lt;/UILanguageFallback&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:navy>&lt;/component&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:navy>&lt;/settings&gt;&lt;settings</span> <span style=color:teal>xmlns=</span><span style=color:#d14>&#34;urn:schemas-microsoft-com:unattend&#34;</span> <span style=color:teal>pass=</span><span style=color:#d14>&#34;specialize&#34;</span><span style=color:navy>&gt;&lt;component</span> <span style=color:teal>name=</span><span style=color:#d14>&#34;Microsoft-Windows-Shell-Setup&#34;</span> <span style=color:teal>language=</span><span style=color:#d14>&#34;neutral&#34;</span> <span style=color:teal>processorArchitecture=</span><span style=color:#d14>&#34;amd64&#34;</span> <span style=color:teal>publicKeyToken=</span><span style=color:#d14>&#34;31bf3856ad364e35&#34;</span> <span style=color:teal>versionScope=</span><span style=color:#d14>&#34;nonSxS&#34;</span> <span style=color:teal>xmlns:wcm=</span><span style=color:#d14>&#34;http://schemas.microsoft.com/WMIConfig/2002/State&#34;</span> <span style=color:teal>xmlns:xsi=</span><span style=color:#d14>&#34;http://www.w3.org/2001/XMLSchema-instance&#34;</span><span style=color:navy>&gt;</span>
</span></span><span style=display:flex><span>			<span style=color:navy>&lt;ComputerName&gt;</span>ASD-123245678<span style=color:navy>&lt;/ComputerName&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:navy>&lt;/component&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:navy>&lt;component</span> <span style=color:teal>name=</span><span style=color:#d14>&#34;Microsoft-Windows-UnattendedJoin&#34;</span> <span style=color:teal>language=</span><span style=color:#d14>&#34;neutral&#34;</span> <span style=color:teal>processorArchitecture=</span><span style=color:#d14>&#34;amd64&#34;</span> <span style=color:teal>publicKeyToken=</span><span style=color:#d14>&#34;31bf3856ad364e35&#34;</span> <span style=color:teal>versionScope=</span><span style=color:#d14>&#34;nonSxS&#34;</span> <span style=color:teal>xmlns:wcm=</span><span style=color:#d14>&#34;http://schemas.microsoft.com/WMIConfig/2002/State&#34;</span> <span style=color:teal>xmlns:xsi=</span><span style=color:#d14>&#34;http://www.w3.org/2001/XMLSchema-instance&#34;</span><span style=color:navy>&gt;</span>
</span></span><span style=display:flex><span>			<span style=color:navy>&lt;Identification&gt;</span>
</span></span><span style=display:flex><span>				<span style=color:navy>&lt;Credentials&gt;</span>
</span></span><span style=display:flex><span>					<span style=color:navy>&lt;Username&gt;</span>ASDAdmin<span style=color:navy>&lt;/Username&gt;</span>
</span></span><span style=display:flex><span>					<span style=color:navy>&lt;Domain&gt;</span>ASD<span style=color:navy>&lt;/Domain&gt;</span>
</span></span><span style=display:flex><span>					<span style=color:navy>&lt;Password&gt;</span>XXXXXXXXXX<span style=color:navy>&lt;/Password&gt;</span>
</span></span><span style=display:flex><span>				<span style=color:navy>&lt;/Credentials&gt;</span>
</span></span><span style=display:flex><span>				<span style=color:navy>&lt;MachineObjectOU&gt;</span>OU=Workstations,OU=Lab,DC=asd,DC=net<span style=color:navy>&lt;/MachineObjectOU&gt;</span>
</span></span><span style=display:flex><span>				<span style=color:navy>&lt;JoinDomain&gt;</span>ASD.NET<span style=color:navy>&lt;/JoinDomain&gt;</span>
</span></span><span style=display:flex><span>			<span style=color:navy>&lt;/Identification&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:navy>&lt;/component&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:navy>&lt;component</span> <span style=color:teal>name=</span><span style=color:#d14>&#34;Microsoft-Windows-Deployment&#34;</span> <span style=color:teal>language=</span><span style=color:#d14>&#34;neutral&#34;</span> <span style=color:teal>processorArchitecture=</span><span style=color:#d14>&#34;amd64&#34;</span> <span style=color:teal>publicKeyToken=</span><span style=color:#d14>&#34;31bf3856ad364e35&#34;</span> <span style=color:teal>versionScope=</span><span style=color:#d14>&#34;nonSxS&#34;</span> <span style=color:teal>xmlns:wcm=</span><span style=color:#d14>&#34;http://schemas.microsoft.com/WMIConfig/2002/State&#34;</span> <span style=color:teal>xmlns:xsi=</span><span style=color:#d14>&#34;http://www.w3.org/2001/XMLSchema-instance&#34;</span><span style=color:navy>&gt;</span>
</span></span><span style=display:flex><span>			<span style=color:navy>&lt;RunSynchronous&gt;</span>
</span></span><span style=display:flex><span>				<span style=color:navy>&lt;RunSynchronousCommand&gt;&lt;Order&gt;</span>1<span style=color:navy>&lt;/Order&gt;</span>
</span></span><span style=display:flex><span>					<span style=color:navy>&lt;Description&gt;</span>disable user account page<span style=color:navy>&lt;/Description&gt;</span>
</span></span><span style=display:flex><span>					<span style=color:navy>&lt;Path&gt;</span>reg add HKLM\Software\Microsoft\Windows\CurrentVersion\Setup\OOBE /v UnattendCreatedUser /t REG_DWORD /d 1 /f<span style=color:navy>&lt;/Path&gt;</span>
</span></span><span style=display:flex><span>				<span style=color:navy>&lt;/RunSynchronousCommand&gt;</span>
</span></span><span style=display:flex><span>			<span style=color:navy>&lt;/RunSynchronous&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:navy>&lt;/component&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:navy>&lt;/settings&gt;&lt;/unattend&gt;</span>
</span></span></code></pre></td></tr></table></div></div><p>As you can see on lines 6 & 7 above <strong>SkipUserOOBE</strong> and <strong>SkipMachineOOBE</strong> are included in the XML and make the issue go away.</p><h2 id=wrapping-it-all-up>Wrapping it all up</h2><p>This was a weird one for sure and this feels like a bug. The workarounds are simple enough that this isn&rsquo;t a show stopped, but trying to find the source of the bug was definitely a head scratcher. I haven&rsquo;t had time to test with any other OS versions or even non-serviced versions yet but would be interested to see if they suffer the same issues. I seem to recall that the OOBE issues that required the custom unattend.xml only showed up on offline serviced or captured images, but not on OEM media.</p><h2 id=ps>P.S.</h2><p>You may be asking yourself why I was doing OSD when I had AutoPilot assigned for AAD Join. Well, the device we were testing was a demo unit that had been registered to another company&rsquo;s tenant and had THEIR Autopilot profile assigned. I had no way of deleting the device or unassigning the profile. The vendor has since resolved the issue, but it helped highlight a deficiency in their process as well, so win-win I guess.</p><p>Also, I was unable to find any Autopilot logs that actually show the device rename being triggered which also bugs me&mldr;</p></div><comments id=comments><script src=https://utteranc.es/client.js repo=AdamGrossTX/asquaredozen issue-term=title label="blog comment" theme=github-light crossorigin=anonymous async></script></comments></article></div></div></div><footer id=footer><div class=container><div id=footer-copyright><p class=copyright>&copy; 2022 Adam Gross - https://www.asquaredozen.com - A Square Dozen</a></p></div></div></footer></div></body></html>