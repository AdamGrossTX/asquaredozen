<!doctype html><html lang=en-us>
<head>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1">
<meta http-equiv=x-ua-compatible content="IE=edge">
<meta name=keyword content="ConfigMgr Microsoft MVP Gross Intune Windows">
<meta name=viewport content="width=device-width">
<meta name=description content="A.Gross Blog | Adam Gross Enterprise Mobility MVP">
<link rel="shortcut icon" href=/img/favicon.ico>
<title>Convert ConfigMgr Error Codes to Plain Text Messages for Reporting – Part 2-A Square Dozen | A. Gross Blog</title>
<link rel=canonical href=/2019/11/25/convert-configmgr-error-codes-to-plain-text-messages-for-reporting-part-2/>
<link rel=stylesheet href=/css/style.css>
<link rel=stylesheet href=https://www.asquaredozen.com/css/custom.css>
<script src=https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js></script>
<script src=https://ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js></script>
<script src=https://www.asquaredozen.com/js/jquery.slicknav.js></script>
<script src=https://www.asquaredozen.com/js/asd_SlickNav_Mobile.js></script>
<script src=https://www.asquaredozen.com/js/custom.js></script>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-DYVXTRTXN4"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','G-DYVXTRTXN4',{anonymize_ip:!1})}</script>
<meta name=twitter:card content="summary_large_image">
<meta name=twitter:image content="https://www.asquaredozen.com/ASquareDozen-Logo_Horiz_Twitter.png">
<meta name=twitter:title content="Convert ConfigMgr Error Codes to Plain Text Messages for Reporting – Part 2">
<meta name=twitter:description content="I demoed this at MMS Jazz 2019 Tip and Tricks. This is Part 2 of a 3-part series. Part 1 covers how to create a PowerShell script to lookup error messages. Part 3 covers how to create a Power BI function to use an Azure Function.
 I had heard of Azure Functions and I&rsquo;ve written web API&rsquo;s but I had never put the 2 together until I ran into this dilemma.">
<meta property="og:title" content="Convert ConfigMgr Error Codes to Plain Text Messages for Reporting – Part 2">
<meta property="og:description" content="I demoed this at MMS Jazz 2019 Tip and Tricks. This is Part 2 of a 3-part series. Part 1 covers how to create a PowerShell script to lookup error messages. Part 3 covers how to create a Power BI function to use an Azure Function.
 I had heard of Azure Functions and I&rsquo;ve written web API&rsquo;s but I had never put the 2 together until I ran into this dilemma.">
<meta property="og:type" content="article">
<meta property="og:url" content="https://www.asquaredozen.com/2019/11/25/convert-configmgr-error-codes-to-plain-text-messages-for-reporting-part-2/"><meta property="og:image" content="https://www.asquaredozen.com/ASquareDozen-Logo_Horiz_Twitter.png"><meta property="article:section" content="posts">
<meta property="article:published_time" content="2019-11-25T18:56:50+00:00">
<meta property="article:modified_time" content="2019-11-25T18:56:50+00:00"><meta property="og:site_name" content="A Square Dozen | A. Gross Blog">
</head>
<body class="home blog">
<div id=asd-container>
<div id=top-bar>
<div class=container>
<div id=nav-wrapper>
<ul class=menu id=menu-top-menu>
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
<a href=/>Home</a>
</li>
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
<a href=#>
<span>Feature Updates</span>
</a>
<ul class="sub-menu menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
<a href=/2019/08/22/windows-10-feature-updates-leveraging-setupdiag-for-better-reporting/>Windows 10 Feature Updates – Leveraging SetupDiag for Better Reporting</a>
</li>
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
<a href=/2019/10/05/windows-10-feature-updates-the-challenge-of-servicing-in-the-enterprise/>Windows 10 Feature Updates – The Challenge of Servicing in the Enterprise</a>
</li>
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
<a href=/2019/08/25/windows-10-feature-updates-using-custom-action-scripts/>Windows 10 Feature Updates – Using Custom Action Scripts</a>
</li>
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
<a href=/2019/08/25/windows-10-feature-updates-using-setupconfig-ini-to-manage-feature-updates-in-the-enterprise/>Windows 10 Feature Updates – Using Setupconfig.ini to Manage Feature Updates in the Enterprise</a>
</li>
</ul>
</li>
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
<a href=/2019/02/12/the-system-center-configuration-manager-adminservice-guide/>
<span>ConfigMgr AdminService</span>
</a>
</li>
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
<a href=#>
<span>802.1x for OSD</span>
</a>
<ul class="sub-menu menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
<a href=/2018/07/29/configuring-802-1x-authentication-for-windows-deployment-part-1-building-an-802-1x-computer-authentication-script/>Part 1 – Building an 802.1x Computer Authentication Script</a>
</li>
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
<a href=/2018/07/29/configuring-802-1x-authentication-for-windows-deployment-part-2-building-an-802-1x-enabled-winpe-boot-image/>Part 2 – Building an 802.1x Enabled WinPE Boot Image</a>
</li>
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
<a href=/2018/07/29/configuring-802-1x-authentication-for-windows-deployment-part-3-integrating-802-1x-authentication-into-a-bare-metal-task-sequence/>Part 3 – Integrating 802.1x Authentication into a Bare Metal Task Sequence</a>
</li>
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
<a href=/2018/07/29/configuring-802-1x-authentication-for-windows-deployment-part-4-integrating-802-1x-authentication-into-an-in-place-upgrade-task-sequence/>Part 4 – Integrating 802.1x Authentication into an In-Place Upgrade Task Sequence</a>
</li>
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
<a href=/2018/09/29/configuring-802-1x-authentication-for-windows-deployment-part-5-dynamic-whitelisting-using-the-cisco-ise-external-restful-service/>Part 5 – Dynamic Whitelisting using the Cisco ISE External RESTful Service</a>
</li>
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
<a href=/2018/07/29/configuring-802-1x-authentication-for-windows-deployment-tips-and-tricks/>Tips and Tricks</a>
</li>
</ul>
</li>
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
<a href=#>
<span>Task Sequence Hacks</span>
</a>
<ul class="sub-menu menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
<a href=/2018/11/29/building-a-better-task-sequence/>Building a Better Task Sequence</a>
</li>
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
<a href=/2019/04/30/building-a-smarter-task-sequence/>Building a Smarter Task Sequence</a>
</li>
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
<a href=/2018/12/14/building-an-even-better-task-sequence/>Building An Even Better Task Sequence</a>
</li>
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
<a href=/2018/07/16/clearing-local-group-policies-during-an-windows-7-to-10-in-place-upgrade-task-sequence/>Clearing Local Group Policies during an Windows 7 to 10 In-Place Upgrade Task Sequence</a>
</li>
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
<a href=/2018/10/03/debugging-sccm-configmgr-task-sequences-on-the-fly/>Debugging SCCM/ConfigMgr Task Sequences on the Fly</a>
</li>
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
<a href=/2018/07/11/dynamically-updating-unattend-xml-during-an-osd-task-sequence-using-mdt-variables-and-zti-scripts/>Dynamically Updating Unattend.XML during an OSD Task Sequence using MDT Variables and ZTI Scripts.</a>
</li>
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
<a href=/2018/06/14/triggering-configmgr-client-actions-from-a-task-sequence/>Triggering ConfigMgr Client Actions from a Task Sequence</a>
</li>
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
<a href=/2018/08/27/using-sccm-task-sequence-variables-as-scripts/>Using SCCM Task Sequence Variables as Scripts</a>
</li>
</ul>
</li>
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
<a href=https://github.com/AdamGrossTX>
<span>GitHub</span>
</a>
</li>
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
<a href=#>
<span>MORE></span>
</a>
<ul class="sub-menu menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
<a href=/about/>About</a>
</li>
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
<a href=/consulting/>Consulting</a>
</li>
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
<a href=/contact/>Contact</a>
</li>
</ul>
</li>
</ul>
</div>
<div id=top-search>
<a href=# class=search><i class="fa fa-search"></i></a>
<div class=show-search>
<form role=search method=get action=https://www.google.com/search id=searchform>
<input type=search placeholder="Search and hit enter..." name=q id=q title="Search and hit enter...">
<input type=hidden name=sitesearch value=https://www.asquaredozen.com>
<button type=submit value=Search>
</form>
</div>
</div>
<div class=menu id=menu-mobile></div>
</div>
</div>
<header id=header class=noslider>
<div class=container>
<div id=logo>
<h1><a href=https://www.asquaredozen.com><img src=/img/A-Square-Dozen-Logo-BlogHeader-1.png alt="A Square Dozen"></a></h1>
</div>
</div>
</header>
<div class=container>
<div id=content>
<div id=main class=fullwidth>
<article class="post type-post status-publish format-standard has-post-thumbnail hentry">
<div class=post-header>
<h1>Convert ConfigMgr Error Codes to Plain Text Messages for Reporting – Part 2</h1>
<span class=post-date>November 25, 2019</span>
</div>
<div class=post-entry>
<hr>
<p>I demoed this at <a href=https://mmsmoa.com/>MMS Jazz 2019 Tip and Tricks</a>. This is Part 2 of a 3-part series.
<a href=/2019/11/25/convert-configmgr-error-codes-to-plain-text-messages-for-reporting-part-1/>Part 1 </a>covers how to create a PowerShell script to lookup error messages.
<a href=/2019/11/25/convert-configmgr-error-codes-to-plain-text-messages-for-reporting-part-3/>Part 3</a> covers how to create a Power BI function to use an Azure Function.</p>
<hr>
<p>I had heard of Azure Functions and I&rsquo;ve written web API&rsquo;s but I had never put the 2 together until I ran into this dilemma. I was trying to get the error text from ConfigMgr deployments into Power BI and ended up messing with Azure Functions to see if it was a viable alternative. This post is based on <a href=/2019/11/25/convert-configmgr-error-codes-to-plain-text-messages-for-reporting-part-1/>Part 1</a> which covers sourcing the files and creating a PowerShell script to look up error message. I&rsquo;ll cover how to create an Azure Function App in this post.</p>
<h2 id=creating-an-azure-function-app>Creating an Azure Function App</h2>
<p>This next bit should be pretty easy since it&rsquo;s mostly just stepping through Azure Function wizards. Once you have all of the files gathered, you simply need to create an Azure function. Log into your Azure Tenant. Search for <strong><code>Function App</code></strong> and browse to it.</p>
<p><div class=image>
<figure>
<a href=image-2.png target=_blank>
<img src=image-2.png alt="A Square Dozen Image">
</a>
</figure>
</div></p>
<p>Click <strong>Add</strong> to create a new Function App</p>
<p><div class=image>
<figure>
<a href=image-3.png target=_blank>
<img src=image-3.png alt="A Square Dozen Image">
</a>
</figure>
</div></p>
<p>This wizard change significantly since I began working on this, so if you are viewing this in the future and it&rsquo;s different than shown, just follow the wizard. The main considerations are:</p>
<ul>
<li>Resource Group - Create a new resource group or re-use an existing one</li>
<li>Function App name - Since you can use this app to run many functions, this should be a relatively generic name that covers the purpose of your web API. Also, this will be a public facing name, so it will need to be unique and may be unavailable if you try using something too general.</li>
<li>Runtime stack - Be sure to select <strong>PowerShell Core</strong> as your Runtime stack. I tried using the C# stuff but couldn&rsquo;t get the DLL to load on .NET Core, though I&rsquo;ll admit, I didn&rsquo;t spend a ton of time on it.</li>
</ul>
<p><div class=image>
<figure>
<a href=image-4.png target=_blank>
<img src=image-4.png alt="A Square Dozen Image">
</a>
</figure>
</div></p>
<p>For Hosting I just accepted the defaults.</p>
<p><div class=image>
<figure>
<a href=image-5.png target=_blank>
<img src=image-5.png alt="A Square Dozen Image">
</a>
</figure>
</div></p>
<p>I chose to enable Application Insights. This will likely add cost to your functions (I don&rsquo;t know for sure), but it will allow you to have visibility into your functions.</p>
<p><div class=image>
<figure>
<a href=image-6.png target=_blank>
<img src=image-6.png alt="A Square Dozen Image">
</a>
</figure>
</div></p>
<p>On Tags, I didn&rsquo;t enter any.</p>
<p><div class=image>
<figure>
<a href=image-7.png target=_blank>
<img src=image-7.png alt="A Square Dozen Image">
</a>
</figure>
</div></p>
<p>On the summary page, review everything then click <strong>Create</strong>.</p>
<p><div class=image>
<figure>
<a href=image-8.png target=_blank>
<img src=image-8.png alt="A Square Dozen Image">
</a>
</figure>
</div></p>
<p>Once it has been created, you can navigate to your new Azure Function App where you can configure it and begin creating your functions.</p>
<p><div class=image>
<figure>
<a href=image-9.png target=_blank>
<img src=image-9.png alt="A Square Dozen Image">
</a>
</figure>
</div></p>
<h2 id=creating-an-azure-function>Creating An Azure Function</h2>
<p>To create a new Azure Function. Click Functions then click New function. I found that clicking the <strong><code>+</code></strong> next to Functions doesn&rsquo;t allow you to change the function name. It&rsquo;s great if you want to create a sample function to test with though.</p>
<p><div class=image>
<figure>
<a href=image-10.png target=_blank>
<img src=image-10.png alt="A Square Dozen Image">
</a>
</figure>
</div></p>
<p>Select HTTP Trigger as the function type.</p>
<p><div class=image>
<figure>
<a href=image-11.png target=_blank>
<img src=image-11.png alt="A Square Dozen Image">
</a>
</figure>
</div></p>
<p>Give the new function a name and configure the Authorization Level. I chose Function. This will case the API to pass a <strong>Code</strong> query string parameter for authorization. During testing, I was just using Anonymous which excludes the <strong>Code</strong> string. Choose an option that fits your security needs.</p>
<p><div class=image>
<figure>
<a href=image-12.png target=_blank>
<img src=image-12.png alt="A Square Dozen Image">
</a>
</figure>
</div></p>
<p>Once the new function has been created, you will have a fully functioning &lsquo;Hello World&rsquo; Azure Function. You can test it if you&rsquo;d like by clicking Save and run. I used this template as the basis for my function.</p>
<p><div class=image>
<figure>
<a href=image-13.png target=_blank>
<img src=image-13.png alt="A Square Dozen Image">
</a>
</figure>
</div></p>
<p>In the web console editor, replace the default function code with the following code. This code is similar to what I used in Part 1 of this series, but it has been modified to work as a web API function.</p>
<div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=1><a style=outline:none;text-decoration:none;color:inherit href=#1> 1</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=2><a style=outline:none;text-decoration:none;color:inherit href=#2> 2</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=3><a style=outline:none;text-decoration:none;color:inherit href=#3> 3</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=4><a style=outline:none;text-decoration:none;color:inherit href=#4> 4</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=5><a style=outline:none;text-decoration:none;color:inherit href=#5> 5</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=6><a style=outline:none;text-decoration:none;color:inherit href=#6> 6</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=7><a style=outline:none;text-decoration:none;color:inherit href=#7> 7</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=8><a style=outline:none;text-decoration:none;color:inherit href=#8> 8</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=9><a style=outline:none;text-decoration:none;color:inherit href=#9> 9</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=10><a style=outline:none;text-decoration:none;color:inherit href=#10>10</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=11><a style=outline:none;text-decoration:none;color:inherit href=#11>11</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=12><a style=outline:none;text-decoration:none;color:inherit href=#12>12</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=13><a style=outline:none;text-decoration:none;color:inherit href=#13>13</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=14><a style=outline:none;text-decoration:none;color:inherit href=#14>14</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=15><a style=outline:none;text-decoration:none;color:inherit href=#15>15</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=16><a style=outline:none;text-decoration:none;color:inherit href=#16>16</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=17><a style=outline:none;text-decoration:none;color:inherit href=#17>17</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=18><a style=outline:none;text-decoration:none;color:inherit href=#18>18</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=19><a style=outline:none;text-decoration:none;color:inherit href=#19>19</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=20><a style=outline:none;text-decoration:none;color:inherit href=#20>20</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=21><a style=outline:none;text-decoration:none;color:inherit href=#21>21</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=22><a style=outline:none;text-decoration:none;color:inherit href=#22>22</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=23><a style=outline:none;text-decoration:none;color:inherit href=#23>23</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=24><a style=outline:none;text-decoration:none;color:inherit href=#24>24</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=25><a style=outline:none;text-decoration:none;color:inherit href=#25>25</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=26><a style=outline:none;text-decoration:none;color:inherit href=#26>26</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=27><a style=outline:none;text-decoration:none;color:inherit href=#27>27</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=28><a style=outline:none;text-decoration:none;color:inherit href=#28>28</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=29><a style=outline:none;text-decoration:none;color:inherit href=#29>29</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=30><a style=outline:none;text-decoration:none;color:inherit href=#30>30</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=31><a style=outline:none;text-decoration:none;color:inherit href=#31>31</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=32><a style=outline:none;text-decoration:none;color:inherit href=#32>32</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=33><a style=outline:none;text-decoration:none;color:inherit href=#33>33</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=34><a style=outline:none;text-decoration:none;color:inherit href=#34>34</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=35><a style=outline:none;text-decoration:none;color:inherit href=#35>35</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=36><a style=outline:none;text-decoration:none;color:inherit href=#36>36</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=37><a style=outline:none;text-decoration:none;color:inherit href=#37>37</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=38><a style=outline:none;text-decoration:none;color:inherit href=#38>38</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=39><a style=outline:none;text-decoration:none;color:inherit href=#39>39</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=40><a style=outline:none;text-decoration:none;color:inherit href=#40>40</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=41><a style=outline:none;text-decoration:none;color:inherit href=#41>41</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=42><a style=outline:none;text-decoration:none;color:inherit href=#42>42</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=43><a style=outline:none;text-decoration:none;color:inherit href=#43>43</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=44><a style=outline:none;text-decoration:none;color:inherit href=#44>44</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=45><a style=outline:none;text-decoration:none;color:inherit href=#45>45</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=46><a style=outline:none;text-decoration:none;color:inherit href=#46>46</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=47><a style=outline:none;text-decoration:none;color:inherit href=#47>47</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=48><a style=outline:none;text-decoration:none;color:inherit href=#48>48</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=49><a style=outline:none;text-decoration:none;color:inherit href=#49>49</a>
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell>using namespace System.Net

<span style=color:#998;font-style:italic># Input bindings are passed in via param block.</span>
<span style=color:#000;font-weight:700>param</span>(<span style=color:teal>$Request</span>, <span style=color:teal>$TriggerMetadata</span>)

<span style=color:teal>$DLLPath</span> = <span style=color:#0086b3>Join-Path</span> -Path <span style=color:teal>$PSScriptRoot</span> -ChildPath <span style=color:#d14>&#34;bin\SrsResources.dll&#34;</span>
<span style=color:#0086b3>Add-Type</span> -Path <span style=color:teal>$DLLPath</span>

<span style=color:#998;font-style:italic># Write to the Azure Functions log stream.</span>
<span style=color:#0086b3>Write-Host</span> <span style=color:#d14>&#34;PowerShell HTTP trigger function processed a request.&#34;</span>

<span style=color:#998;font-style:italic># Interact with query parameters or the body of the request.</span>
<span style=color:teal>$ExitCode</span> = <span style=color:teal>$Request</span>.Query.ExitCode
<span style=color:#000;font-weight:700>if</span> (<span style=color:#000;font-weight:700>-not</span> <span style=color:teal>$ExitCode</span>) {
    <span style=color:teal>$ExitCode</span> = <span style=color:teal>$Request</span>.Body.ExitCode
}

<span style=color:teal>$Language</span> = <span style=color:teal>$Request</span>.Query.Language
<span style=color:#000;font-weight:700>if</span> (<span style=color:#000;font-weight:700>-not</span> <span style=color:teal>$Language</span>) {
    <span style=color:teal>$Language</span> = <span style=color:teal>$Request</span>.Body.Language
}

<span style=color:#000;font-weight:700>If</span>(!(<span style=color:teal>$Language</span>)) {
    <span style=color:teal>$Language</span> = <span style=color:#d14>&#34;en-US&#34;</span>
}

<span style=color:teal>[int]</span><span style=color:teal>$intCode</span> = <span style=color:teal>$ExitCode</span>

<span style=color:#000;font-weight:700>if</span> (<span style=color:teal>$intCode</span> <span style=color:#000;font-weight:700>-eq</span> 0 <span style=color:#000;font-weight:700>-or</span> <span style=color:teal>$intCode</span>) {
    <span style=color:teal>$Message</span> = <span style=color:teal>[SrsResources.Localization]</span>::GetErrorMessage(<span style=color:teal>$intCode</span>,<span style=color:teal>$Language</span>)
    <span style=color:#000;font-weight:700>If</span>(<span style=color:teal>$Message</span>) {
        <span style=color:teal>$status</span> = <span style=color:teal>[HttpStatusCode]</span>::OK
        <span style=color:teal>$body</span> = (<span style=color:teal>$Message</span> <span style=color:#000;font-weight:700>-replace</span> <span style=color:#d14>&#34;</span><span style=color:#d14>`n</span><span style=color:#d14>&#34;</span>,<span style=color:#d14>&#34; &#34;</span>) <span style=color:#000;font-weight:700>-replace</span> <span style=color:#d14>&#34;</span><span style=color:#d14>`r</span><span style=color:#d14>&#34;</span>,<span style=color:#d14>&#34;&#34;</span>
    }
    <span style=color:#000;font-weight:700>else</span> {
        <span style=color:teal>$status</span> = <span style=color:teal>[HttpStatusCode]</span>::OK
        <span style=color:teal>$body</span> = <span style=color:#d14>&#34;No Result.&#34;</span>
    }
}
<span style=color:#000;font-weight:700>else</span> {
    <span style=color:teal>$status</span> = <span style=color:teal>[HttpStatusCode]</span>::BadRequest
    <span style=color:teal>$body</span> = <span style=color:#d14>&#34;Please pass an ExitCode on the query string or in the request body. example: &lt;URL&gt;?ExitCode=0x87D00664&#34;</span>
}

<span style=color:#998;font-style:italic># Associate values to output bindings by calling &#39;Push-OutputBinding&#39;.</span>
<span style=color:#0086b3>Push-OutputBinding</span> -Name Response -Value (<span style=color:teal>[HttpResponseContext]</span>@{
    StatusCode = <span style=color:teal>$status</span>
    Body = <span style=color:teal>$body</span>
})
</code></pre></td></tr></table>
</div>
</div><p>It should look like this whenever you are done.</p>
<p><div class=image>
<figure>
<a href=image-14.png target=_blank>
<img src=image-14.png alt="A Square Dozen Image">
</a>
</figure>
</div></p>
<p>For this test case, the function requires extra files. If you don&rsquo;t have the same need, you can skip the next section.</p>
<h2 id=adding-files-to-the-azure-function>Adding Files to the Azure Function</h2>
<p>Once you&rsquo;ve updated the <code>run.ps1</code> file. navigate to the main Function App node. Click <strong>Platform features</strong> then <strong>Advanced Tools (Kudu)</strong>.</p>
<p><div class=image>
<figure>
<a href=image-15.png target=_blank>
<img src=image-15.png alt="A Square Dozen Image">
</a>
</figure>
</div></p>
<p>Select The Debug console drop down and select PowerShell</p>
<p><div class=image>
<figure>
<a href=image-16.png target=_blank>
<img src=image-16.png alt="A Square Dozen Image">
</a>
</figure>
</div></p>
<p>Navigate using the upper pane to get to the folder for your new Azure Function website. My path is <code>D:\home\site\wwwroot\GetErrorMessage</code></p>
<p><div class=image>
<figure>
<a href=image-43.png target=_blank>
<img src=image-43.png alt="A Square Dozen Image">
</a>
</figure>
</div></p>
<p>Drag the <strong><code>Bin</code></strong> folder and it&rsquo;s contents into the root of your site&rsquo;s folder. You can watch the progress indicator to see when the upload has been completed.</p>
<p><div class=image>
<figure>
<a href=image-17.png target=_blank>
<img src=image-17.png alt="A Square Dozen Image">
</a>
</figure>
</div></p>
<p>Verify that the folder and contents are present.</p>
<p><div class=image>
<figure>
<a href=image-48.png target=_blank>
<img src=image-48.png alt="A Square Dozen Image">
</a>
</figure>
</div></p>
<h2 id=testing-the-azure-function>Testing the Azure Function</h2>
<ol>
<li>Return to your Azure Function.</li>
<li>In the right hand pane, click Test.</li>
<li>Click Add parameter</li>
<li>Create query parameter for <strong><code>ExitCode</code></strong> and add an error code</li>
<li>Create query parameter <strong><code>Language</code></strong> and add a language code.</li>
<li>Click Save</li>
<li>Click Run</li>
<li>The output box should show the result.</li>
</ol>
<p><div class=image>
<figure>
<a href=image-20.png target=_blank>
<img src=image-20.png alt="A Square Dozen Image">
</a>
</figure>
</div></p>
<p>You can also click on <strong><code>Get function URL</code></strong> to run the function directly in a web browser or anything else.</p>
<p><div class=image>
<figure>
<a href=2019-11-25_10-52-46.png target=_blank>
<img src=2019-11-25_10-52-46.png alt="A Square Dozen Image">
</a>
</figure>
</div></p>
<p>Your URL will be the base URL including your function authentication code (unless you chose anonymous when you set up the function.</p>
<p><code>https://asdconfigmgrfn.azurewebsites.net/api/GetErrorMessage?code=fasweAWDAWDFAWF/ADwdawdafASEFSE==</code></p>
<p>Then you will append your parameters to the URL like with <code>&</code></p>
<p><code>&ExitCode=0x87D00664</code><br>
<code>&Language=en-US</code></p>
<p>With the final URL being <code>[https://asdconfigmgrfn.azurewebsites.net/api/GetErrorMessage?code=fasweAWDAWDFAWF/ADwdawdafASEFSE==&ExitCode=0x87D00664&Language=en-US](https://asdconfigmgrfn.azurewebsites.net/api/GetErrorMessage?code=jcctioioyOCFDr584iP0F/nUyGHCkPldlRJvM8xxajm9pGUoToLq4A==&ExitCode=0x87D00664&Language=en-US)</code></p>
<p><div class=image>
<figure>
<a href=image-25.png target=_blank>
<img src=image-25.png alt="A Square Dozen Image">
</a>
</figure>
</div></p>
<h2 id=summary>Summary</h2>
<p>As you can see, you can basically take &lsquo;any&rsquo; PowerShell code and stick it into an Azure Function with a little bit of modification. For my use-case I just wanted to get error codes for reporting, but you could easily move PowerShell utility scripts to Azure Functions and leverage them in ConfigMgr task sequences or just about anywhere else. I love the idea of being able to build an API in a matter of minutes with almost no real dev work involved. Hopefully this will inspire you to check out Azure Functions!</p>
<p>Check out <a href=/2019/11/25/convert-configmgr-error-codes-to-plain-text-messages-for-reporting-part-2/>Part 1</a> and <a href=/2019/11/25/convert-configmgr-error-codes-to-plain-text-messages-for-reporting-part-3/>Part 3</a></p>
</div>
<div class=post-share>
<div class="post-share-box share-comments">
hello
</div>
</div>
<div class=post-author>
</div>
<comments id=comments>
<script src=https://utteranc.es/client.js repo=AdamGrossTX/asquaredozen issue-term=title label="blog comment" theme=github-light crossorigin=anonymous async></script>
</comments>
</article>
</div>
</div>
</div>
<footer id=footer>
<div class=container>
<div id=footer-copyright>
<p class=copyright>&copy; 2021 Adam Gross - https://www.asquaredozen.com - A Square Dozen</a></p>
</div>
</div>
</footer>
</div>
</body>
</html>