<!DOCTYPE html>
<html lang="en-us">
	    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="keyword"  content="ConfigMgr Microsoft MVP Gross Intune Windows">
        <meta name="viewport" content="width=device-width">
        <link rel="shortcut icon" href="/img/favicon.ico">
        <title>Convert ConfigMgr Error Codes to Plain Text Messages for Reporting – Part 2-A Square Dozen | A. Gross Blog</title>

        <meta name="description" content="A.Gross Blog | Adam Gross Enterprise Mobility MVP">
        

        
<script async src="https://www.googletagmanager.com/gtag/js?id=G-DYVXTRTXN4"></script>
<script>
var doNotTrack = false;
if (!doNotTrack) {
	window.dataLayer = window.dataLayer || [];
	function gtag(){dataLayer.push(arguments);}
	gtag('js', new Date());
	gtag('config', 'G-DYVXTRTXN4', { 'anonymize_ip': false });
}
</script>

        <meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://blog.asquaredozen.com/105"/>

<meta name="twitter:title" content="Convert ConfigMgr Error Codes to Plain Text Messages for Reporting – Part 2"/>
<meta name="twitter:description" content="I demoed this at MMS Jazz 2019 Tip and Tricks. This is Part 2 of a 3-part series. Part 1 covers how to create a PowerShell script to lookup error messages. Part 3 covers how to create a Power BI function to use an Azure Function.
 I had heard of Azure Functions and I&rsquo;ve written web API&rsquo;s but I had never put the 2 together until I ran into this dilemma."/>


        <link rel="canonical" href="/2019/11/25/convert-configmgr-error-codes-to-plain-text-messages-for-reporting-part-2/">
        <link rel="stylesheet" href="/css/style.css">
        <link rel="stylesheet" href="/css/code.css">
        

        
        <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css" rel="stylesheet" type="text/css">
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js"></script>

        <script src="js/asd.js"></script>

        
        

        
    </head>
		<body class="home blog">
			<div id="asd-container">
				
				
<div id="top-bar">
    <div class="container">
        <div id="nav-wrapper">
                <ul class="menu" id="menu-top-menu">
                    <li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
                        <a href="/">Home</a>
                    </li>
                    
                    
                        
                            <li class=" menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
                                <a href="#">
                                    
                                    <span>Feature Updates</span>
                                </a>
                                <ul class="sub-menu menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
                                    
                                        <li class=" menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
                                            <a href="/2019/08/22/windows-10-feature-updates-leveraging-setupdiag-for-better-reporting/">Windows 10 Feature Updates – Leveraging SetupDiag for Better Reporting</a>
                                        </li>
                                    
                                        <li class=" menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
                                            <a href="/2019/10/05/windows-10-feature-updates-the-challenge-of-servicing-in-the-enterprise/">Windows 10 Feature Updates – The Challenge of Servicing in the Enterprise</a>
                                        </li>
                                    
                                        <li class=" menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
                                            <a href="/2019/08/25/windows-10-feature-updates-using-custom-action-scripts/">Windows 10 Feature Updates – Using Custom Action Scripts</a>
                                        </li>
                                    
                                        <li class=" menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
                                            <a href="/2019/08/25/windows-10-feature-updates-using-setupconfig-ini-to-manage-feature-updates-in-the-enterprise/">Windows 10 Feature Updates – Using Setupconfig.ini to Manage Feature Updates in the Enterprise</a>
                                        </li>
                                    
                                </ul>
                            </li>
                        
                    
                        
                            <li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
                                <a href="/2019/02/12/the-system-center-configuration-manager-adminservice-guide/">
                                    
                                    <span>ConfigMgr AdminService</span>
                                </a>
                            </li>
                        
                    
                        
                            <li class=" menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
                                <a href="#">
                                    
                                    <span>802.1x for OSD</span>
                                </a>
                                <ul class="sub-menu menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
                                    
                                        <li class=" menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
                                            <a href="/2018/07/29/configuring-802-1x-authentication-for-windows-deployment-part-1-building-an-802-1x-computer-authentication-script/">Part 1 – Building an 802.1x Computer Authentication Script</a>
                                        </li>
                                    
                                        <li class=" menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
                                            <a href="/2018/07/29/configuring-802-1x-authentication-for-windows-deployment-part-2-building-an-802-1x-enabled-winpe-boot-image/">Part 2 – Building an 802.1x Enabled WinPE Boot Image</a>
                                        </li>
                                    
                                        <li class=" menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
                                            <a href="/2018/07/29/configuring-802-1x-authentication-for-windows-deployment-part-3-integrating-802-1x-authentication-into-a-bare-metal-task-sequence/">Part 3 – Integrating 802.1x Authentication into a Bare Metal Task Sequence</a>
                                        </li>
                                    
                                        <li class=" menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
                                            <a href="/2018/07/29/configuring-802-1x-authentication-for-windows-deployment-part-4-integrating-802-1x-authentication-into-an-in-place-upgrade-task-sequence/">Part 4 – Integrating 802.1x Authentication into an In-Place Upgrade Task Sequence</a>
                                        </li>
                                    
                                        <li class=" menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
                                            <a href="/2018/09/29/configuring-802-1x-authentication-for-windows-deployment-part-5-dynamic-whitelisting-using-the-cisco-ise-external-restful-service/">Part 5 – Dynamic Whitelisting using the Cisco ISE External RESTful Service</a>
                                        </li>
                                    
                                        <li class=" menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
                                            <a href="/2018/07/29/configuring-802-1x-authentication-for-windows-deployment-tips-and-tricks/">Tips and Tricks</a>
                                        </li>
                                    
                                </ul>
                            </li>
                        
                    
                        
                            <li class=" menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
                                <a href="#">
                                    
                                    <span>Task Sequence Hacks</span>
                                </a>
                                <ul class="sub-menu menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
                                    
                                        <li class=" menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
                                            <a href="/2018/11/29/building-a-better-task-sequence/">Building a Better Task Sequence</a>
                                        </li>
                                    
                                        <li class=" menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
                                            <a href="/2019/04/30/building-a-smarter-task-sequence/">Building a Smarter Task Sequence</a>
                                        </li>
                                    
                                        <li class=" menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
                                            <a href="/2018/12/14/building-an-even-better-task-sequence/">Building An Even Better Task Sequence</a>
                                        </li>
                                    
                                        <li class=" menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
                                            <a href="/2018/07/16/clearing-local-group-policies-during-an-windows-7-to-10-in-place-upgrade-task-sequence/">Clearing Local Group Policies during an Windows 7 to 10 In-Place Upgrade Task Sequence</a>
                                        </li>
                                    
                                        <li class=" menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
                                            <a href="/2018/10/03/debugging-sccm-configmgr-task-sequences-on-the-fly/">Debugging SCCM/ConfigMgr Task Sequences on the Fly</a>
                                        </li>
                                    
                                        <li class=" menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
                                            <a href="/2018/07/11/dynamically-updating-unattend-xml-during-an-osd-task-sequence-using-mdt-variables-and-zti-scripts/">Dynamically Updating Unattend.XML during an OSD Task Sequence using MDT Variables and ZTI Scripts.</a>
                                        </li>
                                    
                                        <li class=" menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
                                            <a href="/2018/06/14/triggering-configmgr-client-actions-from-a-task-sequence/">Triggering ConfigMgr Client Actions from a Task Sequence</a>
                                        </li>
                                    
                                        <li class=" menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
                                            <a href="/2018/08/27/using-sccm-task-sequence-variables-as-scripts/">Using SCCM Task Sequence Variables as Scripts</a>
                                        </li>
                                    
                                </ul>
                            </li>
                        
                    
                        
                            <li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
                                <a href="https://github.com/AdamGrossTX">
                                    
                                    <span>GitHub</span>
                                </a>
                            </li>
                        
                    
                        
                            <li class=" menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
                                <a href="#">
                                    
                                    <span>MORE&gt;</span>
                                </a>
                                <ul class="sub-menu menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
                                    
                                        <li class=" menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
                                            <a href="/about/">About</a>
                                        </li>
                                    
                                        <li class=" menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
                                            <a href="/consulting/">Consulting</a>
                                        </li>
                                    
                                        <li class=" menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
                                            <a href="/contact/">Contact</a>
                                        </li>
                                    
                                </ul>
                            </li>
                        
                    
                
                </ul>
        </div>
        <div class="menu" id="menu-mobile"></div>
    </div>
    <div id="top-search">
        <a href="#" class="search"><i class="fa fa-search"></i></a>
        <div class="show-search">
            <form role="search" method="get" action="https://www.google.com/search" id="searchform">
                <input type="search" placeholder="Search and hit enter..." value="" name="s" id="s" title="Search and hit enter...">
                <input type="hidden" name="sitesearch" value="asquaredozen.com">
                <button type="submit" value="Search"/>
            </form>
        </div>
    </div>
</div>
				<header id="header" class="noslider">
	<div class="container">
		<div id="logo">
			<h1><a href="https://blog.asquaredozen.com"><img src="/img/A-Square-Dozen-Logo-BlogHeader-1.png" alt="A Square Dozen" /></a></h1>
		</div>
	</div>
</header>
				<div class="container">
					<div id="content">
						<div id="main">
							
		<article class="post type-post status-publish format-standard has-post-thumbnail hentry">
			<div class="post-header">
				<h1>Convert ConfigMgr Error Codes to Plain Text Messages for Reporting – Part 2</h1>
				<span class="post-date">November 25, 2019</span>
			</div>
			<div class="post-entry">
				<hr>
<p>I demoed this at <a href="https://mmsmoa.com/">MMS Jazz 2019 Tip and Tricks</a>. This is Part 2 of a 3-part series.
<a href="/2019/11/25/convert-configmgr-error-codes-to-plain-text-messages-for-reporting-part-1/">Part 1 </a>covers how to create a PowerShell script to lookup error messages.
<a href="/2019/11/25/convert-configmgr-error-codes-to-plain-text-messages-for-reporting-part-3/">Part 3</a> covers how to create a Power BI function to use an Azure Function.</p>
<hr>
<p>I had heard of Azure Functions and I&rsquo;ve written web API&rsquo;s but I had never put the 2 together until I ran into this dilemma. I was trying to get the error text from ConfigMgr deployments into Power BI and ended up messing with Azure Functions to see if it was a viable alternative. This post is based on <a href="/2019/11/25/convert-configmgr-error-codes-to-plain-text-messages-for-reporting-part-1/">Part 1</a> which covers sourcing the files and creating a PowerShell script to look up error message. I&rsquo;ll cover how to create an Azure Function App in this post.</p>
<h2 id="creating-an-azure-function-app">Creating an Azure Function App</h2>
<p>This next bit should be pretty easy since it&rsquo;s mostly just stepping through Azure Function wizards. Once you have all of the files gathered, you simply need to create an Azure function. Log into your Azure Tenant. Search for <strong><code>Function App</code></strong> and browse to it.</p>
<p><img src="/img/2019/11/image-2.png" alt="A Square Dozen Image"></p>
<p>Click <strong>Add</strong> to create a new Function App</p>
<p><img src="/img/2019/11/image-3.png" alt="A Square Dozen Image"></p>
<p>This wizard change significantly since I began working on this, so if you are viewing this in the future and it&rsquo;s different than shown, just follow the wizard. The main considerations are:</p>
<ul>
<li>Resource Group - Create a new resource group or re-use an existing one</li>
<li>Function App name - Since you can use this app to run many functions, this should be a relatively generic name that covers the purpose of your web API. Also, this will be a public facing name, so it will need to be unique and may be unavailable if you try using something too general.</li>
<li>Runtime stack - Be sure to select <strong>PowerShell Core</strong> as your Runtime stack. I tried using the C# stuff but couldn&rsquo;t get the DLL to load on .NET Core, though I&rsquo;ll admit, I didn&rsquo;t spend a ton of time on it.</li>
</ul>
<p><img src="/img/2019/11/image-4.png" alt="A Square Dozen Image"></p>
<p>For Hosting I just accepted the defaults.</p>
<p><img src="/img/2019/11/image-5.png" alt="A Square Dozen Image"></p>
<p>I chose to enable Application Insights. This will likely add cost to your functions (I don&rsquo;t know for sure), but it will allow you to have visibility into your functions.</p>
<p><img src="/img/2019/11/image-6.png" alt="A Square Dozen Image"></p>
<p>On Tags, I didn&rsquo;t enter any.</p>
<p><img src="/img/2019/11/image-7.png" alt="A Square Dozen Image"></p>
<p>On the summary page, review everything then click <strong>Create</strong>.</p>
<p><img src="/img/2019/11/image-8.png" alt="A Square Dozen Image"></p>
<p>Once it has been created, you can navigate to your new Azure Function App where you can configure it and begin creating your functions.</p>
<p><img src="/img/2019/11/image-9.png" alt="A Square Dozen Image"></p>
<h2 id="creating-an-azure-function">Creating An Azure Function</h2>
<p>To create a new Azure Function. Click Functions then click New function. I found that clicking the <strong><code>+</code></strong> next to Functions doesn&rsquo;t allow you to change the function name. It&rsquo;s great if you want to create a sample function to test with though.</p>
<p><img src="/img/2019/11/image-10.png" alt="A Square Dozen Image"></p>
<p>Select HTTP Trigger as the function type.</p>
<p><img src="/img/2019/11/image-11.png" alt="A Square Dozen Image"></p>
<p>Give the new function a name and configure the Authorization Level. I chose Function. This will case the API to pass a <strong>Code</strong> query string parameter for authorization. During testing, I was just using Anonymous which excludes the <strong>Code</strong> string. Choose an option that fits your security needs.</p>
<p><img src="/img/2019/11/image-12.png" alt="A Square Dozen Image"></p>
<p>Once the new function has been created, you will have a fully functioning &lsquo;Hello World&rsquo; Azure Function. You can test it if you&rsquo;d like by clicking Save and run. I used this template as the basis for my function.</p>
<p><img src="/img/2019/11/image-13.png" alt="A Square Dozen Image"></p>
<p>In the web console editor, replace the default function code with the following code. This code is similar to what I used in Part 1 of this series, but it has been modified to work as a web API function.</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="1"><a style="outline: none; text-decoration:none; color:inherit" href="#1"> 1</a></span>using namespace System.Net
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="2"><a style="outline: none; text-decoration:none; color:inherit" href="#2"> 2</a></span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="3"><a style="outline: none; text-decoration:none; color:inherit" href="#3"> 3</a></span><span style="color:#998;font-style:italic"># Input bindings are passed in via param block.</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="4"><a style="outline: none; text-decoration:none; color:inherit" href="#4"> 4</a></span><span style="color:#000;font-weight:bold">param</span>(<span style="color:#008080">$Request</span>, <span style="color:#008080">$TriggerMetadata</span>)
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="5"><a style="outline: none; text-decoration:none; color:inherit" href="#5"> 5</a></span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="6"><a style="outline: none; text-decoration:none; color:inherit" href="#6"> 6</a></span><span style="color:#008080">$DLLPath</span> = <span style="color:#0086b3">Join-Path</span> -Path <span style="color:#008080">$PSScriptRoot</span> -ChildPath <span style="color:#d14">&#34;bin\SrsResources.dll&#34;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="7"><a style="outline: none; text-decoration:none; color:inherit" href="#7"> 7</a></span><span style="color:#0086b3">Add-Type</span> -Path <span style="color:#008080">$DLLPath</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="8"><a style="outline: none; text-decoration:none; color:inherit" href="#8"> 8</a></span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="9"><a style="outline: none; text-decoration:none; color:inherit" href="#9"> 9</a></span><span style="color:#998;font-style:italic"># Write to the Azure Functions log stream.</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="10"><a style="outline: none; text-decoration:none; color:inherit" href="#10">10</a></span><span style="color:#0086b3">Write-Host</span> <span style="color:#d14">&#34;PowerShell HTTP trigger function processed a request.&#34;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="11"><a style="outline: none; text-decoration:none; color:inherit" href="#11">11</a></span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="12"><a style="outline: none; text-decoration:none; color:inherit" href="#12">12</a></span><span style="color:#998;font-style:italic"># Interact with query parameters or the body of the request.</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="13"><a style="outline: none; text-decoration:none; color:inherit" href="#13">13</a></span><span style="color:#008080">$ExitCode</span> = <span style="color:#008080">$Request</span>.Query.ExitCode
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="14"><a style="outline: none; text-decoration:none; color:inherit" href="#14">14</a></span><span style="color:#000;font-weight:bold">if</span> (<span style="color:#000;font-weight:bold">-not</span> <span style="color:#008080">$ExitCode</span>) {
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="15"><a style="outline: none; text-decoration:none; color:inherit" href="#15">15</a></span>    <span style="color:#008080">$ExitCode</span> = <span style="color:#008080">$Request</span>.Body.ExitCode
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="16"><a style="outline: none; text-decoration:none; color:inherit" href="#16">16</a></span>}
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="17"><a style="outline: none; text-decoration:none; color:inherit" href="#17">17</a></span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="18"><a style="outline: none; text-decoration:none; color:inherit" href="#18">18</a></span><span style="color:#008080">$Language</span> = <span style="color:#008080">$Request</span>.Query.Language
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="19"><a style="outline: none; text-decoration:none; color:inherit" href="#19">19</a></span><span style="color:#000;font-weight:bold">if</span> (<span style="color:#000;font-weight:bold">-not</span> <span style="color:#008080">$Language</span>) {
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="20"><a style="outline: none; text-decoration:none; color:inherit" href="#20">20</a></span>    <span style="color:#008080">$Language</span> = <span style="color:#008080">$Request</span>.Body.Language
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="21"><a style="outline: none; text-decoration:none; color:inherit" href="#21">21</a></span>}
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="22"><a style="outline: none; text-decoration:none; color:inherit" href="#22">22</a></span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="23"><a style="outline: none; text-decoration:none; color:inherit" href="#23">23</a></span><span style="color:#000;font-weight:bold">If</span>(!(<span style="color:#008080">$Language</span>)) {
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="24"><a style="outline: none; text-decoration:none; color:inherit" href="#24">24</a></span>    <span style="color:#008080">$Language</span> = <span style="color:#d14">&#34;en-US&#34;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="25"><a style="outline: none; text-decoration:none; color:inherit" href="#25">25</a></span>}
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="26"><a style="outline: none; text-decoration:none; color:inherit" href="#26">26</a></span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="27"><a style="outline: none; text-decoration:none; color:inherit" href="#27">27</a></span><span style="color:#008080">[int]</span><span style="color:#008080">$intCode</span> = <span style="color:#008080">$ExitCode</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="28"><a style="outline: none; text-decoration:none; color:inherit" href="#28">28</a></span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="29"><a style="outline: none; text-decoration:none; color:inherit" href="#29">29</a></span><span style="color:#000;font-weight:bold">if</span> (<span style="color:#008080">$intCode</span> <span style="color:#000;font-weight:bold">-eq</span> 0 <span style="color:#000;font-weight:bold">-or</span> <span style="color:#008080">$intCode</span>) {
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="30"><a style="outline: none; text-decoration:none; color:inherit" href="#30">30</a></span>    <span style="color:#008080">$Message</span> = <span style="color:#008080">[SrsResources.Localization]</span>::GetErrorMessage(<span style="color:#008080">$intCode</span>,<span style="color:#008080">$Language</span>)
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="31"><a style="outline: none; text-decoration:none; color:inherit" href="#31">31</a></span>    <span style="color:#000;font-weight:bold">If</span>(<span style="color:#008080">$Message</span>) {
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="32"><a style="outline: none; text-decoration:none; color:inherit" href="#32">32</a></span>        <span style="color:#008080">$status</span> = <span style="color:#008080">[HttpStatusCode]</span>::OK
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="33"><a style="outline: none; text-decoration:none; color:inherit" href="#33">33</a></span>        <span style="color:#008080">$body</span> = (<span style="color:#008080">$Message</span> <span style="color:#000;font-weight:bold">-replace</span> <span style="color:#d14">&#34;</span><span style="color:#d14">`n</span><span style="color:#d14">&#34;</span>,<span style="color:#d14">&#34; &#34;</span>) <span style="color:#000;font-weight:bold">-replace</span> <span style="color:#d14">&#34;</span><span style="color:#d14">`r</span><span style="color:#d14">&#34;</span>,<span style="color:#d14">&#34;&#34;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="34"><a style="outline: none; text-decoration:none; color:inherit" href="#34">34</a></span>    }
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="35"><a style="outline: none; text-decoration:none; color:inherit" href="#35">35</a></span>    <span style="color:#000;font-weight:bold">else</span> {
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="36"><a style="outline: none; text-decoration:none; color:inherit" href="#36">36</a></span>        <span style="color:#008080">$status</span> = <span style="color:#008080">[HttpStatusCode]</span>::OK
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="37"><a style="outline: none; text-decoration:none; color:inherit" href="#37">37</a></span>        <span style="color:#008080">$body</span> = <span style="color:#d14">&#34;No Result.&#34;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="38"><a style="outline: none; text-decoration:none; color:inherit" href="#38">38</a></span>    }
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="39"><a style="outline: none; text-decoration:none; color:inherit" href="#39">39</a></span>}
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="40"><a style="outline: none; text-decoration:none; color:inherit" href="#40">40</a></span><span style="color:#000;font-weight:bold">else</span> {
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="41"><a style="outline: none; text-decoration:none; color:inherit" href="#41">41</a></span>    <span style="color:#008080">$status</span> = <span style="color:#008080">[HttpStatusCode]</span>::BadRequest
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="42"><a style="outline: none; text-decoration:none; color:inherit" href="#42">42</a></span>    <span style="color:#008080">$body</span> = <span style="color:#d14">&#34;Please pass an ExitCode on the query string or in the request body. example: &lt;URL&gt;?ExitCode=0x87D00664&#34;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="43"><a style="outline: none; text-decoration:none; color:inherit" href="#43">43</a></span>}
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="44"><a style="outline: none; text-decoration:none; color:inherit" href="#44">44</a></span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="45"><a style="outline: none; text-decoration:none; color:inherit" href="#45">45</a></span><span style="color:#998;font-style:italic"># Associate values to output bindings by calling &#39;Push-OutputBinding&#39;.</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="46"><a style="outline: none; text-decoration:none; color:inherit" href="#46">46</a></span><span style="color:#0086b3">Push-OutputBinding</span> -Name Response -Value (<span style="color:#008080">[HttpResponseContext]</span>@{
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="47"><a style="outline: none; text-decoration:none; color:inherit" href="#47">47</a></span>    StatusCode = <span style="color:#008080">$status</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="48"><a style="outline: none; text-decoration:none; color:inherit" href="#48">48</a></span>    Body = <span style="color:#008080">$body</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="49"><a style="outline: none; text-decoration:none; color:inherit" href="#49">49</a></span>})
</code></pre></div><p>It should look like this whenever you are done.</p>
<p><img src="/img/2019/11/image-14.png" alt="A Square Dozen Image"></p>
<p>For this test case, the function requires extra files. If you don&rsquo;t have the same need, you can skip the next section.</p>
<h2 id="adding-files-to-the-azure-function">Adding Files to the Azure Function</h2>
<p>Once you&rsquo;ve updated the <code>run.ps1</code> file. navigate to the main Function App node. Click <strong>Platform features</strong> then <strong>Advanced Tools (Kudu)</strong>.</p>
<p><img src="/img/2019/11/image-15.png" alt="A Square Dozen Image"></p>
<p>Select The Debug console drop down and select PowerShell</p>
<p><img src="/img/2019/11/image-16.png" alt="A Square Dozen Image"></p>
<p>Navigate using the upper pane to get to the folder for your new Azure Function website. My path is <code>D:\home\site\wwwroot\GetErrorMessage</code></p>
<p><img src="https://i1.wp.com/www.systemcenterdudes.com/img/2019/09/image-43.png" alt="A Square Dozen Image"></p>
<p>Drag the <strong><code>Bin</code></strong> folder and it&rsquo;s contents into the root of your site&rsquo;s folder. You can watch the progress indicator to see when the upload has been completed.</p>
<p><img src="/img/2019/11/image-17.png" alt="A Square Dozen Image"></p>
<p>Verify that the folder and contents are present.</p>
<p><img src="https://i1.wp.com/www.systemcenterdudes.com/img/2019/09/image-48.png" alt="A Square Dozen Image"></p>
<h2 id="testing-the-azure-function">Testing the Azure Function</h2>
<ol>
<li>Return to your Azure Function.</li>
<li>In the right hand pane, click Test.</li>
<li>Click Add parameter</li>
<li>Create query parameter for <strong><code>ExitCode</code></strong> and add an error code</li>
<li>Create query parameter <strong><code>Language</code></strong> and add a language code.</li>
<li>Click Save</li>
<li>Click Run</li>
<li>The output box should show the result.</li>
</ol>
<p><img src="/img/2019/11/image-20.png" alt="A Square Dozen Image"></p>
<p>You can also click on <strong><code>Get function URL</code></strong> to run the function directly in a web browser or anything else.</p>
<p><img src="/img/2019/11/2019-11-25_10-52-46.png" alt="A Square Dozen Image"></p>
<p>Your URL will be the base URL including your function authentication code (unless you chose anonymous when you set up the function.</p>
<p><code>https://asdconfigmgrfn.azurewebsites.net/api/GetErrorMessage?code=fasweAWDAWDFAWF/ADwdawdafASEFSE==</code></p>
<p>Then you will append your parameters to the URL like with <code>&amp;</code></p>
<p><code>&amp;ExitCode=0x87D00664</code><br>
<code>&amp;Language=en-US</code></p>
<p>With the final URL being  <code>[https://asdconfigmgrfn.azurewebsites.net/api/GetErrorMessage?code=fasweAWDAWDFAWF/ADwdawdafASEFSE==&amp;ExitCode=0x87D00664&amp;Language=en-US](https://asdconfigmgrfn.azurewebsites.net/api/GetErrorMessage?code=jcctioioyOCFDr584iP0F/nUyGHCkPldlRJvM8xxajm9pGUoToLq4A==&amp;ExitCode=0x87D00664&amp;Language=en-US)</code></p>
<p><img src="/img/2019/11/image-25.png" alt="A Square Dozen Image"></p>
<h2 id="summary">Summary</h2>
<p>As you can see, you can basically take &lsquo;any&rsquo; PowerShell code and stick it into an Azure Function with a little bit of modification. For my use-case I just wanted to get error codes for reporting, but you could easily move PowerShell utility scripts to Azure Functions and leverage them in ConfigMgr task sequences or just about anywhere else. I love the idea of being able to build an API in a matter of minutes with almost no real dev work involved. Hopefully this will inspire you to check out Azure Functions!</p>
<p>Check out <a href="/2019/11/25/convert-configmgr-error-codes-to-plain-text-messages-for-reporting-part-2/">Part 1</a> and <a href="/2019/11/25/convert-configmgr-error-codes-to-plain-text-messages-for-reporting-part-3/">Part 3</a></p>

			</div>
			
			<div class="post-share">
				<div class="post-share-box share-comments">
					hello
				</div>
			</div>
			<div class="post-author">
			</div>
			
			<script src="https://utteranc.es/client.js"
				repo="AdamGrossTX/asquaredozen"
				issue-term="title"
				label="blog comment"
				theme="github-light"
				crossorigin="anonymous"
				async>
			</script>
		</article>

						</div>
						<aside id="sidebar">
	<div class="widget widget_search">
		<form role="search" method="get" action="https://www.google.com/search" id="searchform">
			<input type="search" placeholder="Search and hit enter..." value="" name="q" id="q" title="Search and hit enter...">
			<input type="hidden" name="sitesearch" value="asquaredozen.com">
			<button type="submit" value="Search"/>
		</form>
		</div>
	<div>
	<div class="widget widget_MVP">
		<a href="https://mvp.microsoft.com/en-us/PublicProfile/5003519?fullName=Adam%20Gross" target="_blank">
		<img src="/img/MVP_Logo_Horizontal_Secondary_Black_RGB_300ppi.png">
		</a>
	</div>	
	<div class="widget widget_recent_entries">
		<h4 class="widget-title">Recent Posts</h4>
		<ul>
			
			<li><a href="/2021/02/04/using-configmgr-run-scripts-and-microsoft-quick-assist-to-repair-a-broken-domain-trust-relationship/" target="_blank">Using ConfigMgr Run Scripts and Microsoft Quick Assist to Repair a Broken Domain Trust Relationship</a></li>
			
			<li><a href="/2021/01/12/how-to-find-settings-preventing-application-deletion-in-configmgr/" target="_blank">How to find Settings Preventing Application Deletion in ConfigMgr</a></li>
			
			<li><a href="/2020/12/02/autopilot-profile-causes-device-rename-after-configmgr-osd-task-sequence-and-breaks-ad-domain-trust/" target="_blank">Autopilot Profile causes Device Rename after ConfigMgr OSD Task Sequence and Breaks AD Domain Trust</a></li>
			
			<li><a href="/2020/09/30/new-post-on-sysmansquad-com-configmgr-and-the-case-of-the-mysterious-3da228be-34da-49f4-a081-66465b077429-folder/" target="_blank">New Post on SysManSquad.com – ConfigMgr and The Case of the Mysterious {3DA228BE-34DA-49f4-A081-66465B077429} Folder</a></li>
			
			<li><a href="/2020/09/13/windows-10-feature-updates-testing-the-migneo-disable-parameter/" target="_blank">Windows 10 Feature Updates – Testing the /MigNEO Disable Parameter</a></li>
			
		</ul>
	</div>
	<div class="widget widget_SCD">
		<h4 class="widget-title">Consulting</h4>
		<a href="https://systemcenterdudes.com/sccm-consulting-services/?ref=5&campaign=Consulting" target="_blank">
		<img src="/img/SCDLogo.png">
		</a>
	</div>
	<div class="widget widget_SCD">
		<h4 class="widget-title">Intune.Training</h4>
		<a href="http://intune.training" target="_blank">
		<img src="/img/ITLogo.png">
		</a>
	</div>	
</aside>

					</div>
				</div>
				<footer id="footer">
	<div class="container">
		<div id="footer-copyright">
			<p class="copyright">&copy; 2021 Adam Gross - https://blog.asquaredozen.com - A Square Dozen</a></p>
		</div>
	</div>
</footer>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js"></script>
<script src="css/SlickNav/jquery.slicknav.js"></script>
			</div>
		</body>
</html>
