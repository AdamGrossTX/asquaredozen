<!doctype html><html lang=en-us>
<head>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1">
<meta http-equiv=x-ua-compatible content="IE=edge">
<meta name=keyword content="ConfigMgr Microsoft MVP Gross Intune Windows">
<meta name=viewport content="width=device-width">
<meta name=description content="A.Gross Blog | Adam Gross Enterprise Mobility MVP">
<link rel="shortcut icon" href=/img/favicon.ico>
<title>Convert ConfigMgr Error Codes to Plain Text Messages for Reporting – Part 3-A Square Dozen | A. Gross Blog</title>
<link rel=canonical href=/2019/11/25/convert-configmgr-error-codes-to-plain-text-messages-for-reporting-part-3/>
<link rel=stylesheet href=/css/style.css>
<link rel=stylesheet href=https://www.asquaredozen.com/css/custom.css>
<script src=https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js></script>
<script src=https://ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js></script>
<script src=https://www.asquaredozen.com/js/jquery.slicknav.js></script>
<script src=https://www.asquaredozen.com/js/asd_SlickNav_Mobile.js></script>
<script src=https://www.asquaredozen.com/js/custom.js></script>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-DYVXTRTXN4"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','G-DYVXTRTXN4',{anonymize_ip:!1})}</script>
<meta name=twitter:card content="summary_large_image">
<meta name=twitter:image content="https://www.asquaredozen.com/105">
<meta name=twitter:title content="Convert ConfigMgr Error Codes to Plain Text Messages for Reporting – Part 3">
<meta name=twitter:description content="I demoed this at MMS Jazz 2019 Tip and Tricks. This is Part 3 of a 3-part series. Part 1covers how to create a PowerShell script to lookup error messages. Part 2 covers creating an Azure Function.
 My goal is to use ConfigMgr ErrorCodes in a report in Power BI for easier deployment monitoring. As I mentioned in Part 1, the error text isn&rsquo;t available in the ConfigMgr DB, so I created a PowerShell script to look up the error code.">
</head>
<body class="home blog">
<div id=asd-container>
<div id=top-bar>
<div class=container>
<div id=nav-wrapper>
<ul class=menu id=menu-top-menu>
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
<a href=/>Home</a>
</li>
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
<a href=#>
<span>Feature Updates</span>
</a>
<ul class="sub-menu menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
<a href=/2019/08/22/windows-10-feature-updates-leveraging-setupdiag-for-better-reporting/>Windows 10 Feature Updates – Leveraging SetupDiag for Better Reporting</a>
</li>
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
<a href=/2019/10/05/windows-10-feature-updates-the-challenge-of-servicing-in-the-enterprise/>Windows 10 Feature Updates – The Challenge of Servicing in the Enterprise</a>
</li>
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
<a href=/2019/08/25/windows-10-feature-updates-using-custom-action-scripts/>Windows 10 Feature Updates – Using Custom Action Scripts</a>
</li>
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
<a href=/2019/08/25/windows-10-feature-updates-using-setupconfig-ini-to-manage-feature-updates-in-the-enterprise/>Windows 10 Feature Updates – Using Setupconfig.ini to Manage Feature Updates in the Enterprise</a>
</li>
</ul>
</li>
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
<a href=/2019/02/12/the-system-center-configuration-manager-adminservice-guide/>
<span>ConfigMgr AdminService</span>
</a>
</li>
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
<a href=#>
<span>802.1x for OSD</span>
</a>
<ul class="sub-menu menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
<a href=/2018/07/29/configuring-802-1x-authentication-for-windows-deployment-part-1-building-an-802-1x-computer-authentication-script/>Part 1 – Building an 802.1x Computer Authentication Script</a>
</li>
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
<a href=/2018/07/29/configuring-802-1x-authentication-for-windows-deployment-part-2-building-an-802-1x-enabled-winpe-boot-image/>Part 2 – Building an 802.1x Enabled WinPE Boot Image</a>
</li>
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
<a href=/2018/07/29/configuring-802-1x-authentication-for-windows-deployment-part-3-integrating-802-1x-authentication-into-a-bare-metal-task-sequence/>Part 3 – Integrating 802.1x Authentication into a Bare Metal Task Sequence</a>
</li>
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
<a href=/2018/07/29/configuring-802-1x-authentication-for-windows-deployment-part-4-integrating-802-1x-authentication-into-an-in-place-upgrade-task-sequence/>Part 4 – Integrating 802.1x Authentication into an In-Place Upgrade Task Sequence</a>
</li>
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
<a href=/2018/09/29/configuring-802-1x-authentication-for-windows-deployment-part-5-dynamic-whitelisting-using-the-cisco-ise-external-restful-service/>Part 5 – Dynamic Whitelisting using the Cisco ISE External RESTful Service</a>
</li>
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
<a href=/2018/07/29/configuring-802-1x-authentication-for-windows-deployment-tips-and-tricks/>Tips and Tricks</a>
</li>
</ul>
</li>
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
<a href=#>
<span>Task Sequence Hacks</span>
</a>
<ul class="sub-menu menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
<a href=/2018/11/29/building-a-better-task-sequence/>Building a Better Task Sequence</a>
</li>
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
<a href=/2019/04/30/building-a-smarter-task-sequence/>Building a Smarter Task Sequence</a>
</li>
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
<a href=/2018/12/14/building-an-even-better-task-sequence/>Building An Even Better Task Sequence</a>
</li>
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
<a href=/2018/07/16/clearing-local-group-policies-during-an-windows-7-to-10-in-place-upgrade-task-sequence/>Clearing Local Group Policies during an Windows 7 to 10 In-Place Upgrade Task Sequence</a>
</li>
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
<a href=/2018/10/03/debugging-sccm-configmgr-task-sequences-on-the-fly/>Debugging SCCM/ConfigMgr Task Sequences on the Fly</a>
</li>
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
<a href=/2018/07/11/dynamically-updating-unattend-xml-during-an-osd-task-sequence-using-mdt-variables-and-zti-scripts/>Dynamically Updating Unattend.XML during an OSD Task Sequence using MDT Variables and ZTI Scripts.</a>
</li>
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
<a href=/2018/06/14/triggering-configmgr-client-actions-from-a-task-sequence/>Triggering ConfigMgr Client Actions from a Task Sequence</a>
</li>
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
<a href=/2018/08/27/using-sccm-task-sequence-variables-as-scripts/>Using SCCM Task Sequence Variables as Scripts</a>
</li>
</ul>
</li>
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
<a href=https://github.com/AdamGrossTX>
<span>GitHub</span>
</a>
</li>
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
<a href=#>
<span>MORE></span>
</a>
<ul class="sub-menu menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
<a href=/about/>About</a>
</li>
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
<a href=/consulting/>Consulting</a>
</li>
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
<a href=/contact/>Contact</a>
</li>
</ul>
</li>
</ul>
</div>
<div id=top-search>
<a href=# class=search><i class="fa fa-search"></i></a>
<div class=show-search>
<form role=search method=get action=https://www.google.com/search id=searchform>
<input type=search placeholder="Search and hit enter..." name=q id=q title="Search and hit enter...">
<input type=hidden name=sitesearch value=https://www.asquaredozen.com>
<button type=submit value=Search>
</form>
</div>
</div>
<div class=menu id=menu-mobile></div>
</div>
</div>
<header id=header class=noslider>
<div class=container>
<div id=logo>
<h1><a href=https://www.asquaredozen.com><img src=/img/A-Square-Dozen-Logo-BlogHeader-1.png alt="A Square Dozen"></a></h1>
</div>
</div>
</header>
<div class=container>
<div id=content>
<div id=main class=fullwidth>
<article class="post type-post status-publish format-standard has-post-thumbnail hentry">
<div class=post-header>
<h1>Convert ConfigMgr Error Codes to Plain Text Messages for Reporting – Part 3</h1>
<span class=post-date>November 26, 2019</span>
</div>
<div class=post-entry>
<hr>
<p>I demoed this at <a href=https://mmsmoa.com/>MMS Jazz 2019 Tip and Tricks</a>. This is Part 3 of a 3-part series.
<a href=/2019/11/25/convert-configmgr-error-codes-to-plain-text-messages-for-reporting-part-1/>Part 1</a>covers how to create a PowerShell script to lookup error messages.
<a href=/2019/11/25/convert-configmgr-error-codes-to-plain-text-messages-for-reporting-part-2/>Part 2</a> covers creating an Azure Function.</p>
<hr>
<p>My goal is to use ConfigMgr ErrorCodes in a report in Power BI for easier deployment monitoring. As I mentioned in Part 1, the error text isn&rsquo;t available in the ConfigMgr DB, so I created a PowerShell script to look up the error code. In part 2 I added the PowerShell to an Azure Function to leverage a web API to look up the information. In this post, I&rsquo;ll show how to integrate an Azure Function into Power BI and how to create a Power BI function to look up values. This post will rely on Part 1 and Part 2 for content.</p>
<h2 id=adding-an-azure-function-as-a-data-source-in-power-bi>Adding an Azure Function as a Data Source in Power BI</h2>
<p>Open a new blank report in Power BI Desktop.</p>
<ol>
<li>Click Edit Queries</li>
<li>Click Manage Parameters</li>
<li>Click Manage Parameters</li>
</ol>
<p><div class=image>
<figure>
<a href=image-27.png target=_blank>
<img src=image-27.png alt="A Square Dozen Image">
</a>
</figure>
</div></p>
<ol>
<li>Click New</li>
<li>Type <code>ErrorCode</code></li>
<li>Select type <code>Text</code></li>
<li>Enter `` as Current Value</li>
</ol>
<p><div class=image>
<figure>
<a href=image-37.png target=_blank>
<img src=image-37.png alt="A Square Dozen Image">
</a>
</figure>
</div></p>
<p>Repeat for Language</p>
<p><div class=image>
<figure>
<a href=image-34.png target=_blank>
<img src=image-34.png alt="A Square Dozen Image">
</a>
</figure>
</div></p>
<p>Repeat for Code. Code will store the function code from the Azure Function that was created in Step 2.</p>
<p><div class=image>
<figure>
<a href=image-38.png target=_blank>
<img src=image-38.png alt="A Square Dozen Image">
</a>
</figure>
</div></p>
<ol>
<li>Click New Source</li>
<li>Search for <code>web</code></li>
<li>Click Web</li>
<li>Click Connect</li>
</ol>
<p><div class=image>
<figure>
<a href=image-31.png target=_blank>
<img src=image-31.png alt="A Square Dozen Image">
</a>
</figure>
</div></p>
<p>Click the Advanced radio button in the new dialog. This will allow you to enter the web URL to the Azure Function that you created in Part 2. Then using the new Power BI parameters that you created. The items in order are as follows (for the screenshots, I had to scroll&mldr;) :</p>
<ul>
<li>Base URL</li>
<li>QueryParam - <code>&ExitCode=</code></li>
<li>Value - Power BI <code>ExitCode</code> Parameter</li>
<li>QueryParam - <code>&Language</code></li>
<li>Value - Power BI <code>Language</code> Parameter</li>
</ul>
<p>Click OK when done.</p>
<p><div class=image>
<figure>
<a href=2019-11-25_16-17-07.png target=_blank>
<img src=2019-11-25_16-17-07.png alt="A Square Dozen Image">
</a>
</figure>
</div></p>
<p>You will be prompted to change permissions for the API. Since we are using the <code>Code</code> query parameter, we can just use Anonymous and click Connect.</p>
<p><div class=image>
<figure>
<a href=image-40.png target=_blank>
<img src=image-40.png alt="A Square Dozen Image">
</a>
</figure>
</div></p>
<p>You will get a confirmation showing the first result from the function.</p>
<p><div class=image>
<figure>
<a href=image-41.png target=_blank>
<img src=image-41.png alt="A Square Dozen Image">
</a>
</figure>
</div></p>
<p>The new data source may be labeled using the code. Rename the function.</p>
<p><div class=image>
<figure>
<a href=2019-11-25_16-17-26.png target=_blank>
<img src=2019-11-25_16-17-26.png alt="A Square Dozen Image">
</a>
</figure>
</div></p>
<p>Right click on the GetErrorMessage query from the right pane and click Create Function</p>
<p><div class=image>
<figure>
<a href=2019-11-25_16-17-54.png target=_blank>
<img src=2019-11-25_16-17-54.png alt="A Square Dozen Image">
</a>
</figure>
</div></p>
<p>Give the function a unique name</p>
<p><div class=image>
<figure>
<a href=image-42.png target=_blank>
<img src=image-42.png alt="A Square Dozen Image">
</a>
</figure>
</div></p>
<p>The new function will be shown and prompt for the ExitCode and Language parameters</p>
<p><div class=image>
<figure>
<a href=image-43.png target=_blank>
<img src=image-43.png alt="A Square Dozen Image">
</a>
</figure>
</div></p>
<p>Enter an exit code <code>0x87D00664</code> and language <code>en-US</code> then click Invoke to test</p>
<p><div class=image>
<figure>
<a href=image-45.png target=_blank>
<img src=image-45.png alt="A Square Dozen Image">
</a>
</figure>
</div></p>
<p>If you did it right, you should get the results shown below. Once you&rsquo;ve verified, right click on the Invoked Function results data set and delete it since it&rsquo;s just a temporary data set.</p>
<p><div class=image>
<figure>
<a href=image-46.png target=_blank>
<img src=image-46.png alt="A Square Dozen Image">
</a>
</figure>
</div></p>
<h2 id=integrating-a-power-bi-function-with-a-sql-data-source>Integrating a Power BI Function with a SQL data source</h2>
<p>Now that we have a function, we need to use it. To do this, we will need to grab a data set that has exit codes that we want to get text for. Since each call to the Azure Function will count towards your consumption in Azure and ultimately cost you some money, you will want to get a distinct list of values in your data set then use that data set as a cross reference table for other Power BI tables. I will be using the ConfigMgr <code>CI_AssignmentStatus</code> table from the ConfigMgr database.
To start, we need to add the ConfigMgr SQL database as a new data source. Click on New Source then click SQL Server.</p>
<p><div class=image>
<figure>
<a href=image-47.png target=_blank>
<img src=image-47.png alt="A Square Dozen Image">
</a>
</figure>
</div></p>
<p>Enter your database server name and database name. I highly recommend creating new parameters for Server and DB since you will likely reference them several times in any given report. It&rsquo;s just a good habit to get into. Add the SQL query below. Be sure to use Import, not DirectQuery and click OK when done. Also, for the purpose of this demo, I&rsquo;ve added a custom Language column with <code>en-US</code> hardcoded into it. You can change this to your language or use parameters in Power BI if you need to.</p>
<div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=1><a style=outline:none;text-decoration:none;color:inherit href=#1> 1</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=2><a style=outline:none;text-decoration:none;color:inherit href=#2> 2</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=3><a style=outline:none;text-decoration:none;color:inherit href=#3> 3</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=4><a style=outline:none;text-decoration:none;color:inherit href=#4> 4</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=5><a style=outline:none;text-decoration:none;color:inherit href=#5> 5</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=6><a style=outline:none;text-decoration:none;color:inherit href=#6> 6</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=7><a style=outline:none;text-decoration:none;color:inherit href=#7> 7</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=8><a style=outline:none;text-decoration:none;color:inherit href=#8> 8</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=9><a style=outline:none;text-decoration:none;color:inherit href=#9> 9</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=10><a style=outline:none;text-decoration:none;color:inherit href=#10>10</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=11><a style=outline:none;text-decoration:none;color:inherit href=#11>11</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=12><a style=outline:none;text-decoration:none;color:inherit href=#12>12</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=13><a style=outline:none;text-decoration:none;color:inherit href=#13>13</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=14><a style=outline:none;text-decoration:none;color:inherit href=#14>14</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=15><a style=outline:none;text-decoration:none;color:inherit href=#15>15</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=16><a style=outline:none;text-decoration:none;color:inherit href=#16>16</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=17><a style=outline:none;text-decoration:none;color:inherit href=#17>17</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=18><a style=outline:none;text-decoration:none;color:inherit href=#18>18</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=19><a style=outline:none;text-decoration:none;color:inherit href=#19>19</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=20><a style=outline:none;text-decoration:none;color:inherit href=#20>20</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=21><a style=outline:none;text-decoration:none;color:inherit href=#21>21</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=22><a style=outline:none;text-decoration:none;color:inherit href=#22>22</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=23><a style=outline:none;text-decoration:none;color:inherit href=#23>23</a>
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-SQL data-lang=SQL><span style=color:#000;font-weight:700>SELECT</span><span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:#000;font-weight:700>DISTINCT</span><span style=color:#bbb>
</span><span style=color:#bbb> </span>LastEnforcementErrorCode,<span style=color:#bbb>
</span><span style=color:#bbb> </span>HexErrorCode<span style=color:#bbb> </span><span style=color:#000;font-weight:700>=</span><span style=color:#bbb> </span>dbo.fn_ConvertBinaryToHexString(<span style=color:#000;font-weight:700>convert</span>(VARBINARY(<span style=color:#099>8</span>),<span style=color:#bbb> </span><span style=color:#000;font-weight:700>CONVERT</span>(<span style=color:#0086b3>int</span>,LastEnforcementErrorCode))),<span style=color:#bbb>
</span><span style=color:#bbb> </span>ErrorType<span style=color:#bbb> </span><span style=color:#000;font-weight:700>=</span><span style=color:#bbb> 
</span><span style=color:#bbb>  </span><span style=color:#000;font-weight:700>CASE</span><span style=color:#bbb> 
</span><span style=color:#bbb>   </span><span style=color:#000;font-weight:700>WHEN</span><span style=color:#bbb> </span>dbo.fn_ConvertBinaryToHexString(<span style=color:#000;font-weight:700>convert</span>(VARBINARY(<span style=color:#099>8</span>),<span style=color:#bbb> </span><span style=color:#000;font-weight:700>CONVERT</span>(<span style=color:#0086b3>int</span>,LastEnforcementErrorCode)))<span style=color:#bbb> </span><span style=color:#000;font-weight:700>like</span><span style=color:#bbb> </span><span style=color:#d14>&#39;C%&#39;</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>THEN</span><span style=color:#bbb> </span><span style=color:#d14>&#39;NTSTATUS&#39;</span><span style=color:#bbb>
</span><span style=color:#bbb>   </span><span style=color:#000;font-weight:700>WHEN</span><span style=color:#bbb> </span>dbo.fn_ConvertBinaryToHexString(<span style=color:#000;font-weight:700>convert</span>(VARBINARY(<span style=color:#099>8</span>),<span style=color:#bbb> </span><span style=color:#000;font-weight:700>CONVERT</span>(<span style=color:#0086b3>int</span>,LastEnforcementErrorCode)))<span style=color:#bbb> </span><span style=color:#000;font-weight:700>like</span><span style=color:#bbb> </span><span style=color:#d14>&#39;8%&#39;</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>THEN</span><span style=color:#bbb> </span><span style=color:#d14>&#39;Win32&#39;</span><span style=color:#bbb>
</span><span style=color:#bbb>   </span><span style=color:#000;font-weight:700>ELSE</span><span style=color:#bbb> </span><span style=color:#d14>&#39;Win32&#39;</span><span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:#000;font-weight:700>END</span>,<span style=color:#bbb>
</span><span style=color:#bbb>  </span>NTStatusLookupValue<span style=color:#bbb> </span><span style=color:#000;font-weight:700>=</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>CASE</span><span style=color:#bbb> 
</span><span style=color:#bbb>   </span><span style=color:#000;font-weight:700>WHEN</span><span style=color:#bbb> </span>dbo.fn_ConvertBinaryToHexString(<span style=color:#000;font-weight:700>convert</span>(VARBINARY(<span style=color:#099>8</span>),<span style=color:#bbb> </span><span style=color:#000;font-weight:700>CONVERT</span>(<span style=color:#0086b3>int</span>,LastEnforcementErrorCode)))<span style=color:#bbb> </span><span style=color:#000;font-weight:700>like</span><span style=color:#bbb> </span><span style=color:#d14>&#39;C%&#39;</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>THEN</span><span style=color:#bbb> </span><span style=color:#d14>&#39;0xC000&#39;</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>+</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>RIGHT</span>(dbo.fn_ConvertBinaryToHexString(<span style=color:#000;font-weight:700>convert</span>(VARBINARY(<span style=color:#099>8</span>),<span style=color:#bbb> </span><span style=color:#000;font-weight:700>CONVERT</span>(<span style=color:#0086b3>int</span>,LastEnforcementErrorCode))),<span style=color:#099>4</span>)<span style=color:#bbb>
</span><span style=color:#bbb>   </span><span style=color:#000;font-weight:700>ELSE</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>NULL</span><span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:#000;font-weight:700>END</span>,<span style=color:#bbb>
</span><span style=color:#bbb>      </span>Win32LookupValue<span style=color:#bbb> </span><span style=color:#000;font-weight:700>=</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>CASE</span><span style=color:#bbb> 
</span><span style=color:#bbb>   </span><span style=color:#000;font-weight:700>WHEN</span><span style=color:#bbb> </span>dbo.fn_ConvertBinaryToHexString(<span style=color:#000;font-weight:700>convert</span>(VARBINARY(<span style=color:#099>8</span>),<span style=color:#bbb> </span><span style=color:#000;font-weight:700>CONVERT</span>(<span style=color:#0086b3>int</span>,LastEnforcementErrorCode)))<span style=color:#bbb> </span><span style=color:#000;font-weight:700>like</span><span style=color:#bbb> </span><span style=color:#d14>&#39;8%&#39;</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>THEN</span><span style=color:#bbb> </span><span style=color:#d14>&#39;0x0000&#39;</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>+</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>RIGHT</span>(dbo.fn_ConvertBinaryToHexString(<span style=color:#000;font-weight:700>convert</span>(VARBINARY(<span style=color:#099>8</span>),<span style=color:#bbb> </span><span style=color:#000;font-weight:700>CONVERT</span>(<span style=color:#0086b3>int</span>,LastEnforcementErrorCode))),<span style=color:#099>4</span>)<span style=color:#bbb>
</span><span style=color:#bbb>   </span><span style=color:#000;font-weight:700>ELSE</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>NULL</span><span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:#000;font-weight:700>END</span>,<span style=color:#bbb>
</span><span style=color:#bbb>   </span><span style=color:#000;font-weight:700>Language</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>=</span><span style=color:#bbb> </span><span style=color:#d14>&#39;en-US&#39;</span><span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:#000;font-weight:700>FROM</span><span style=color:#bbb> 
</span><span style=color:#bbb> </span>CI_AssignmentStatus<span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:#000;font-weight:700>WHERE</span><span style=color:#bbb> 
</span><span style=color:#bbb> </span>LastEnforcementErrorCode<span style=color:#bbb> </span><span style=color:#000;font-weight:700>IS</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>NOT</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>NULL</span><span style=color:#bbb>
</span></code></pre></td></tr></table>
</div>
</div><p><div class=image>
<figure>
<a href=2019-11-25_16-44-56.png target=_blank>
<img src=2019-11-25_16-44-56.png alt="A Square Dozen Image">
</a>
</figure>
</div></p>
<p>Rename the data set to <code>ExitCodeXREF</code></p>
<p><div class=image>
<figure>
<a href=image-66.png target=_blank>
<img src=image-66.png alt="A Square Dozen Image">
</a>
</figure>
</div></p>
<p>Next we need to look up the Error Message text and add it to the XREF table. We do this by Invoking a Custom Function. Click <strong>Add Column</strong> then <strong>Invoke Custom Function</strong>.</p>
<p><div class=image>
<figure>
<a href=image-67.png target=_blank>
<img src=image-67.png alt="A Square Dozen Image">
</a>
</figure>
</div></p>
<p>Enter the name of the new column <code>ErrorMessage</code> then select the function name and parameters. It should look like this when you are done.</p>
<p><div class=image>
<figure>
<a href=image-58.png target=_blank>
<img src=image-58.png alt="A Square Dozen Image">
</a>
</figure>
</div></p>
<p>The function will likely return an error code as below. You will need to open the Advanced Editor to change the query.</p>
<p><div class=image>
<figure>
<a href=image-59.png target=_blank>
<img src=image-59.png alt="A Square Dozen Image">
</a>
</figure>
</div></p>
<p><div class=image>
<figure>
<a href=image-60.png target=_blank>
<img src=image-60.png alt="A Square Dozen Image">
</a>
</figure>
</div></p>
<p>Click Advanced Editor from the ribbon. In the box, find the text <code>fnGetErrorMessage([ExitCode], [Language])</code> and change to <code>fnGetErrorMessage(Text.From([ExitCode]), Text.From([Language]))</code>. This will convert the negative integer values to text.</p>
<p><div class=image>
<figure>
<a href=image-61.png target=_blank>
<img src=image-61.png alt="A Square Dozen Image">
</a>
</figure>
</div></p>
<p>Select the double arrow symbol on the <code>ErrorMessage</code> column and uncheck the <code>Use original column name as prefix</code> box and click OK.</p>
<p><div class=image>
<figure>
<a href=image-62.png target=_blank>
<img src=image-62.png alt="A Square Dozen Image">
</a>
</figure>
</div></p>
<p><div class=image>
<figure>
<a href=image-63.png target=_blank>
<img src=image-63.png alt="A Square Dozen Image">
</a>
</figure>
</div></p>
<p>Right click on <code>Column1</code> and click Rename and change to <code>ErrorMessage</code></p>
<p><div class=image>
<figure>
<a href=2019-11-25_17-16-54.png target=_blank>
<img src=2019-11-25_17-16-54.png alt="A Square Dozen Image">
</a>
</figure>
</div></p>
<p>MAGIC!</p>
<p><div class=image>
<figure>
<a href=image-64.png target=_blank>
<img src=image-64.png alt="A Square Dozen Image">
</a>
</figure>
</div></p>
<h2 id=linking-the-xref-table-to-data-table-for-reporting>Linking the XREF Table to Data Table for Reporting</h2>
<p>Follow the steps above for adding a new data source and use the query below for the SQL query and rename the resulting table to DeploymentStatus.</p>
<div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=1><a style=outline:none;text-decoration:none;color:inherit href=#1>1</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=2><a style=outline:none;text-decoration:none;color:inherit href=#2>2</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=3><a style=outline:none;text-decoration:none;color:inherit href=#3>3</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=4><a style=outline:none;text-decoration:none;color:inherit href=#4>4</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=5><a style=outline:none;text-decoration:none;color:inherit href=#5>5</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=6><a style=outline:none;text-decoration:none;color:inherit href=#6>6</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=7><a style=outline:none;text-decoration:none;color:inherit href=#7>7</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=8><a style=outline:none;text-decoration:none;color:inherit href=#8>8</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=9><a style=outline:none;text-decoration:none;color:inherit href=#9>9</a>
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-SQL data-lang=SQL><span style=color:#000;font-weight:700>SELECT</span><span style=color:#bbb>  
</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>REPLACE</span>(AssignmentName,<span style=color:#d14>&#39;CPDesk - &#39;</span>,<span style=color:#d14>&#39;&#39;</span>)<span style=color:#bbb> </span><span style=color:#000;font-weight:700>as</span><span style=color:#bbb> </span>AssignmentName,<span style=color:#bbb>
</span><span style=color:#bbb> </span>CollectionName,<span style=color:#bbb> 
</span><span style=color:#bbb> </span>ResourceID,<span style=color:#bbb>
</span><span style=color:#bbb> </span>ExitCode<span style=color:#bbb> </span><span style=color:#000;font-weight:700>=</span><span style=color:#bbb> </span>LastEnforcementErrorCode,<span style=color:#bbb>
</span><span style=color:#bbb> </span>ErrorStatusID<span style=color:#bbb> </span><span style=color:#000;font-weight:700>=</span><span style=color:#bbb> </span>LastEnforcementErrorID<span style=color:#000;font-weight:700>&amp;</span><span style=color:#099>0</span>x0000FFFF,<span style=color:#bbb>
</span><span style=color:#bbb> </span>HexErrorCode<span style=color:#bbb> </span><span style=color:#000;font-weight:700>=</span><span style=color:#bbb> </span>dbo.fn_ConvertBinaryToHexString(<span style=color:#000;font-weight:700>convert</span>(VARBINARY(<span style=color:#099>8</span>),<span style=color:#bbb> </span><span style=color:#000;font-weight:700>CONVERT</span>(<span style=color:#0086b3>int</span>,LastEnforcementErrorCode)))<span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:#000;font-weight:700>FROM</span><span style=color:#bbb> 
</span><span style=color:#bbb> </span>vSMS_SUMDeploymentStatusPerAsset<span style=color:#bbb>
</span></code></pre></td></tr></table>
</div>
</div><p>All Set. Click Close and Apply to go to the report design front end.</p>
<p><div class=image>
<figure>
<a href=image-71.png target=_blank>
<img src=image-71.png alt="A Square Dozen Image">
</a>
</figure>
</div></p>
<p>Click on the relationships icon on the left nav bar and ensure that the relationship between the <code>DeploymentStatus</code> table and <code>ExitCodeXREF</code> is set to Many to One on <code>ExitCode</code>.</p>
<p><div class=image>
<figure>
<a href=image-72.png target=_blank>
<img src=image-72.png alt="A Square Dozen Image">
</a>
</figure>
</div></p>
<p>Switch back to the report view using the left nav then select the columns from each table to create a table with results.</p>
<p><div class=image>
<figure>
<a href=2019-11-25_18-13-28.png target=_blank>
<img src=2019-11-25_18-13-28.png alt="A Square Dozen Image">
</a>
</figure>
</div></p>
<h2 id=summary>Summary</h2>
<p>That&rsquo;s about it. Hopefully you were able to follow along. This post does assume that you are at least somewhat familiar with Power BI. Ping me if you&rsquo;ve got any issues or questions.</p>
<p>This is the final part on this series (for now). Since SRSResources.dll doesn&rsquo;t look up Windows 10 upgrade codes, those will be displayed as Unknown Error generally. I&rsquo;m working on additional reporting to handle those as well. Maybe I&rsquo;ll get around to them before it all gets changed and stops working!</p>
<p>I hope this inspires you to experiment with Azure Functions and Power BI.</p>
<p>Check out <a href=/2019/11/25/convert-configmgr-error-codes-to-plain-text-messages-for-reporting-part-1/>Part 1</a> and <a href=/2019/11/25/convert-configmgr-error-codes-to-plain-text-messages-for-reporting-part-2/>Part 2</a></p>
</div>
<div class=post-share>
<div class="post-share-box share-comments">
hello
</div>
</div>
<div class=post-author>
</div>
<comments id=comments>
<script src=https://utteranc.es/client.js repo=AdamGrossTX/asquaredozen issue-term=title label="blog comment" theme=github-light crossorigin=anonymous async></script>
</comments>
</article>
</div>
</div>
</div>
<footer id=footer>
<div class=container>
<div id=footer-copyright>
<p class=copyright>&copy; 2021 Adam Gross - https://www.asquaredozen.com - A Square Dozen</a></p>
</div>
</div>
</footer>
</div>
</body>
</html>