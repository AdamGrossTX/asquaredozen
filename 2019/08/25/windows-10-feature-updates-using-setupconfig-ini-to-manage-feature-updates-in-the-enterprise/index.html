<!doctype html><html lang=en-us>
<head>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1">
<meta http-equiv=x-ua-compatible content="IE=edge">
<meta name=keyword content="ConfigMgr Microsoft MVP Gross Intune Windows">
<meta name=viewport content="width=device-width">
<meta name=description content="A.Gross Blog | Adam Gross Enterprise Mobility MVP">
<link rel="shortcut icon" href=/img/favicon.ico>
<title>Windows 10 Feature Updates – Using Setupconfig.ini to Manage Feature Updates in the Enterprise-A Square Dozen | A. Gross Blog</title>
<link rel=canonical href=/2019/08/25/windows-10-feature-updates-using-setupconfig-ini-to-manage-feature-updates-in-the-enterprise/>
<link rel=stylesheet href=/css/style.css>
<link rel=stylesheet href=https://www.asquaredozen.com/css/custom.css>
<script src=https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js></script>
<script src=https://ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js></script>
<script src=https://www.asquaredozen.com/js/jquery.slicknav.js></script>
<script src=https://www.asquaredozen.com/js/asd_SlickNav_Mobile.js></script>
<script src=https://www.asquaredozen.com/js/custom.js></script>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-DYVXTRTXN4"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','G-DYVXTRTXN4',{anonymize_ip:!1})}</script>
<meta name=twitter:card content="summary_large_image">
<meta name=twitter:image content="https://www.asquaredozen.com/img/ASquareDozen-Logo_Horiz_Twitter.png">
<meta name=twitter:title content="Windows 10 Feature Updates – Using Setupconfig.ini to Manage Feature Updates in the Enterprise">
<meta name=twitter:description content="This is the next installment in my Windows 10 Feature Updates series.
Setupconfig.ini Setupconfig.ini is a file that can be used to pass command line arguments to the Windows Setup engine during a Windows installation. When Setupconfig.ini is specified in the command line (/ConfigFile <path to Setupconfig.ini>) or exists in the default location (%systemdrive%\Users\Default\AppData\Local\Microsoft\Windows\WSUS\Setupconfig.ini), any arguments in it will take precedence over arguments specified in the commandline. If you use this file, ensure that you aren&rsquo;t counteracting commandline args that you may be using with other deployment methods such as Task Sequences (Task Sequences simply generate a command line based on which options you select).">
<meta property="og:title" content="Windows 10 Feature Updates – Using Setupconfig.ini to Manage Feature Updates in the Enterprise">
<meta property="og:description" content="This is the next installment in my Windows 10 Feature Updates series.
Setupconfig.ini Setupconfig.ini is a file that can be used to pass command line arguments to the Windows Setup engine during a Windows installation. When Setupconfig.ini is specified in the command line (/ConfigFile <path to Setupconfig.ini>) or exists in the default location (%systemdrive%\Users\Default\AppData\Local\Microsoft\Windows\WSUS\Setupconfig.ini), any arguments in it will take precedence over arguments specified in the commandline. If you use this file, ensure that you aren&rsquo;t counteracting commandline args that you may be using with other deployment methods such as Task Sequences (Task Sequences simply generate a command line based on which options you select).">
<meta property="og:type" content="article">
<meta property="og:url" content="https://www.asquaredozen.com/2019/08/25/windows-10-feature-updates-using-setupconfig-ini-to-manage-feature-updates-in-the-enterprise/"><meta property="og:image" content="https://www.asquaredozen.com/img/ASquareDozen-Logo_Horiz_Twitter.png"><meta property="article:section" content="posts">
<meta property="article:published_time" content="2019-08-26T00:24:25+00:00">
<meta property="article:modified_time" content="2019-08-26T00:24:25+00:00"><meta property="og:site_name" content="A Square Dozen | A. Gross Blog">
</head>
<body class="home blog">
<div id=asd-container>
<div id=top-bar>
<div class=container>
<div id=nav-wrapper>
<ul class=menu id=menu-top-menu>
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
<a href=/>Home</a>
</li>
<li class="active menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
<a href=#>
<span>Feature Updates</span>
</a>
<ul class="sub-menu menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
<a href=/2019/08/22/windows-10-feature-updates-leveraging-setupdiag-for-better-reporting/>Windows 10 Feature Updates – Leveraging SetupDiag for Better Reporting</a>
</li>
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
<a href=/2019/10/05/windows-10-feature-updates-the-challenge-of-servicing-in-the-enterprise/>Windows 10 Feature Updates – The Challenge of Servicing in the Enterprise</a>
</li>
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
<a href=/2019/08/25/windows-10-feature-updates-using-custom-action-scripts/>Windows 10 Feature Updates – Using Custom Action Scripts</a>
</li>
<li class="active menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
<a href=/2019/08/25/windows-10-feature-updates-using-setupconfig-ini-to-manage-feature-updates-in-the-enterprise/>Windows 10 Feature Updates – Using Setupconfig.ini to Manage Feature Updates in the Enterprise</a>
</li>
</ul>
</li>
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
<a href=/2019/02/12/the-system-center-configuration-manager-adminservice-guide/>
<span>ConfigMgr AdminService</span>
</a>
</li>
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
<a href=#>
<span>802.1x for OSD</span>
</a>
<ul class="sub-menu menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
<a href=/2018/07/29/configuring-802-1x-authentication-for-windows-deployment-part-1-building-an-802-1x-computer-authentication-script/>Part 1 – Building an 802.1x Computer Authentication Script</a>
</li>
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
<a href=/2018/07/29/configuring-802-1x-authentication-for-windows-deployment-part-2-building-an-802-1x-enabled-winpe-boot-image/>Part 2 – Building an 802.1x Enabled WinPE Boot Image</a>
</li>
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
<a href=/2018/07/29/configuring-802-1x-authentication-for-windows-deployment-part-3-integrating-802-1x-authentication-into-a-bare-metal-task-sequence/>Part 3 – Integrating 802.1x Authentication into a Bare Metal Task Sequence</a>
</li>
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
<a href=/2018/07/29/configuring-802-1x-authentication-for-windows-deployment-part-4-integrating-802-1x-authentication-into-an-in-place-upgrade-task-sequence/>Part 4 – Integrating 802.1x Authentication into an In-Place Upgrade Task Sequence</a>
</li>
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
<a href=/2018/09/29/configuring-802-1x-authentication-for-windows-deployment-part-5-dynamic-whitelisting-using-the-cisco-ise-external-restful-service/>Part 5 – Dynamic Whitelisting using the Cisco ISE External RESTful Service</a>
</li>
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
<a href=/2018/07/29/configuring-802-1x-authentication-for-windows-deployment-tips-and-tricks/>Tips and Tricks</a>
</li>
</ul>
</li>
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
<a href=#>
<span>Task Sequence Hacks</span>
</a>
<ul class="sub-menu menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
<a href=/2018/11/29/building-a-better-task-sequence/>Building a Better Task Sequence</a>
</li>
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
<a href=/2019/04/30/building-a-smarter-task-sequence/>Building a Smarter Task Sequence</a>
</li>
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
<a href=/2018/12/14/building-an-even-better-task-sequence/>Building An Even Better Task Sequence</a>
</li>
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
<a href=/2018/07/16/clearing-local-group-policies-during-an-windows-7-to-10-in-place-upgrade-task-sequence/>Clearing Local Group Policies during an Windows 7 to 10 In-Place Upgrade Task Sequence</a>
</li>
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
<a href=/2018/10/03/debugging-sccm-configmgr-task-sequences-on-the-fly/>Debugging SCCM/ConfigMgr Task Sequences on the Fly</a>
</li>
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
<a href=/2018/07/11/dynamically-updating-unattend-xml-during-an-osd-task-sequence-using-mdt-variables-and-zti-scripts/>Dynamically Updating Unattend.XML during an OSD Task Sequence using MDT Variables and ZTI Scripts.</a>
</li>
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
<a href=/2018/06/14/triggering-configmgr-client-actions-from-a-task-sequence/>Triggering ConfigMgr Client Actions from a Task Sequence</a>
</li>
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
<a href=/2018/08/27/using-sccm-task-sequence-variables-as-scripts/>Using SCCM Task Sequence Variables as Scripts</a>
</li>
</ul>
</li>
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
<a href=https://github.com/AdamGrossTX>
<span>GitHub</span>
</a>
</li>
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
<a href=#>
<span>MORE></span>
</a>
<ul class="sub-menu menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
<a href=/about/>About</a>
</li>
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
<a href=/consulting/>Consulting</a>
</li>
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
<a href=/contact/>Contact</a>
</li>
</ul>
</li>
</ul>
</div>
<div id=top-search>
<a href=# class=search><i class="fa fa-search"></i></a>
<div class=show-search>
<form role=search method=get action=https://www.google.com/search id=searchform>
<input type=search placeholder="Search and hit enter..." name=q id=q title="Search and hit enter...">
<input type=hidden name=sitesearch value=https://www.asquaredozen.com>
<button type=submit value=Search>
</form>
</div>
</div>
<div class=menu id=menu-mobile></div>
</div>
</div>
<header id=header class=noslider>
<div class=container>
<div id=logo>
<h1><a href=https://www.asquaredozen.com><img src=/img/A-Square-Dozen-Logo-BlogHeader-1.png alt="A Square Dozen"></a></h1>
</div>
</div>
</header>
<div class=container>
<div id=content>
<div id=main class=fullwidth>
<article class="post type-post status-publish format-standard has-post-thumbnail hentry">
<div class=post-header>
<h1>Windows 10 Feature Updates – Using Setupconfig.ini to Manage Feature Updates in the Enterprise</h1>
<span class=post-date>August 26, 2019</span>
</div>
<div class=post-entry>
<p>This is the next installment in my Windows 10 Feature Updates series.</p>
<h2 id=setupconfigini>Setupconfig.ini</h2>
<p><a href=https://docs.microsoft.com/windows-hardware/manufacture/desktop/windows-setup-automation-overview>Setupconfig.ini</a> is a file that can be used to pass <a href=https://docs.microsoft.com/windows-hardware/manufacture/desktop/windows-setup-command-line-options>command line arguments</a> to the Windows Setup engine during a Windows installation. When Setupconfig.ini is specified in the command line (<code>/ConfigFile &lt;path to Setupconfig.ini></code>) or exists in the default location (<code>%systemdrive%\Users\Default\AppData\Local\Microsoft\Windows\WSUS\Setupconfig.ini</code>), any arguments in it <strong>will take precedence over arguments specified in the commandline</strong>. If you use this file, ensure that you aren&rsquo;t counteracting commandline args that you may be using with other deployment methods such as Task Sequences (Task Sequences simply generate a command line based on which options you select). Here&rsquo;s an example of the Setupconfig.ini that I have been testing in production (most people will not use all of these).</p>
<div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=1><a style=outline:none;text-decoration:none;color:inherit href=#1> 1</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=2><a style=outline:none;text-decoration:none;color:inherit href=#2> 2</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=3><a style=outline:none;text-decoration:none;color:inherit href=#3> 3</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=4><a style=outline:none;text-decoration:none;color:inherit href=#4> 4</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=5><a style=outline:none;text-decoration:none;color:inherit href=#5> 5</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=6><a style=outline:none;text-decoration:none;color:inherit href=#6> 6</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=7><a style=outline:none;text-decoration:none;color:inherit href=#7> 7</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=8><a style=outline:none;text-decoration:none;color:inherit href=#8> 8</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=9><a style=outline:none;text-decoration:none;color:inherit href=#9> 9</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=10><a style=outline:none;text-decoration:none;color:inherit href=#10>10</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=11><a style=outline:none;text-decoration:none;color:inherit href=#11>11</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=12><a style=outline:none;text-decoration:none;color:inherit href=#12>12</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=13><a style=outline:none;text-decoration:none;color:inherit href=#13>13</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=14><a style=outline:none;text-decoration:none;color:inherit href=#14>14</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=15><a style=outline:none;text-decoration:none;color:inherit href=#15>15</a>
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ini data-lang=ini><span style=color:#000;font-weight:700>[Setupconfig]</span>
<span style=color:teal>BitLocker</span><span style=color:#000;font-weight:700>=</span><span style=color:#d14>AlwaysSuspend</span>
<span style=color:teal>Compat</span><span style=color:#000;font-weight:700>=</span><span style=color:#d14>IgnoreWarning</span>
<span style=color:teal>Priority</span><span style=color:#000;font-weight:700>=</span><span style=color:#d14>Normal</span>
<span style=color:teal>DynamicUpdate</span><span style=color:#000;font-weight:700>=</span><span style=color:#d14>Enable</span>
<span style=color:teal>ShowOOBE</span><span style=color:#000;font-weight:700>=</span><span style=color:#d14>None</span>
<span style=color:teal>Telemetry</span><span style=color:#000;font-weight:700>=</span><span style=color:#d14>Enable</span>
<span style=color:teal>DiagnosticPrompt</span><span style=color:#000;font-weight:700>=</span><span style=color:#d14>Enable</span>
<span style=color:teal>PKey</span><span style=color:#000;font-weight:700>=</span><span style=color:#d14>NPPR9-FWDCX-D2C8J-H872K-2YT43</span>
<span style=color:teal>PostOOBE</span><span style=color:#000;font-weight:700>=</span><span style=color:#d14>C:\~FeatureUpdateTemp\Scripts\SetupComplete.cmd</span>
<span style=color:teal>PostRollBack</span><span style=color:#000;font-weight:700>=</span><span style=color:#d14>C:\~FeatureUpdateTemp\Scripts\ErrorHandler.cmd</span>
<span style=color:teal>PostRollBackContext</span><span style=color:#000;font-weight:700>=</span><span style=color:#d14>System</span>
<span style=color:teal>CopyLogs</span><span style=color:#000;font-weight:700>=</span><span style=color:#d14>\\MyShare\FailedFeatureUpdateLogs\COMPUTERNAME</span>
<span style=color:teal>InstallDrivers</span><span style=color:#000;font-weight:700>=</span><span style=color:#d14>c:\~FeatureUpdateTemp\Drivers</span>
<span style=color:teal>ReflectDrivers</span><span style=color:#000;font-weight:700>=</span><span style=color:#d14>c:\~FeatureUpdateTemp\ReflectDrivers</span>
</code></pre></td></tr></table>
</div>
</div><p>If you were to change this to a Windows setup command line, it would look like this:</p>
<div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=1><a style=outline:none;text-decoration:none;color:inherit href=#1>1</a>
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ini data-lang=ini><span style=color:teal>setup.exe /BitLocker AlwaysSuspend /Compat IgnoreWarning /Priority Normal /DynamicUpdate Enable /ShowOOBE None /Telemetry Enable /DiagnosticPrompt Enable /PKey NPPR9-FWDCX-D2C8J-H872K-2YT43 /PostOOBE C:\~FeatureUpdateTemp\Scripts\SetupComplete.cmd /PostRollBack C:\~FeatureUpdateTemp\Scripts\ErrorHandler.cmd /PostRollBackContext System /CopyLogs \\MyShare\FailedFeatureUpdateLogs\COMPUTERNAME /InstallDrivers c:\~FUTemp\Drivers /ReflectDrivers c:\~FeatureUpdateTemp\ReflectDrivers</span>
</code></pre></td></tr></table>
</div>
</div><p>By managing a Setupconfig.ini file on all of your Windows 10 devices, you can have full control of how Windows 10 Feature Updates are installed, from Task Sequence, Intune, WSUS or even if users install them directly from Windows Update. By using the available command line options, you can run post-upgrade scripts, apply updated drivers and even handle third party disk encryption needs (see <code>ReflectDrivers</code>). Before deploying this file, be sure to check the <a href=https://docs.microsoft.com/windows-hardware/manufacture/desktop/windows-setup-command-line-options>Windows Setup Command-Line Options </a>doc for details on each option. After testing several versions of it, the one I deployed into production is different than above. Some of the options deserve a bit more explanation:</p>
<h4 id=compatignorewarning>Compat=IgnoreWarning</h4>
<p>If you have dealt with Windows 10 upgrades (7-10 or 10-10 Feature Updates) you have likely run into blocks due to drivers or applications. Many of these blocks can be ignored but only if you include <code>/Compat IgnoreWarning</code> in command line either using media or a Task Sequence. If you&rsquo;ve ever tried to apply a Feature Update from Windows Update or through SCCM&rsquo;s Windows 10 Servicing, you have likely run into blocks that prevented you from upgrading certain devices that would have otherwise worked fine from a Task Sequence using the <code>/Compat IgnoreWarning</code> argument. You can just add the line <code>Compat=IgnoreWarning</code> to your Setupconfig.ini now and breeze right past those annoying blocks.
When we first started testing Feature Updates, we were seeing a high number of failed upgrades compared to our InPlace Upgrade Task Sequence and nearly all of them ended up being dismissable compat issues. Once we added Setupconfig.ini, our failures were almost non-existent. In the donut chart below you can see that over 27% of devices reported dismissable errors and were successfully upgraded since we are using the Compat=IgnoreWarning option.</p>
<p><div class=image>
<figure>
<a href=image-34.png target=_blank>
<img src=image-34.png alt="A Square Dozen Image">
</a>
</figure>
</div></p>
<h4 id=dynamicupdateenable>DynamicUpdate=Enable</h4>
<p>Another one that really deserves it&rsquo;s own blog post some day is the change in Dynamic Updates in Windows 10 1809 and up. Several of us in the community have been writing and speaking how important Dynamic Updates are for successful upgrades but in Windows 10 1809 the mechanism for applying Dynamic Updates changed. As you may have read recently on <a href=https://oofhours.com/2019/08/06/uup-is-still-coming-soon-and-dynamic-update-is-still-important/>Michael Niehus&rsquo;s blog on the topic</a>, Dynamic Updates can ONLY be pulled from the internet currently and are <strong>ENABLED BY DEFAULT!!</strong> Delivery Optimization and BracheCache don&rsquo;t help either. Your clients may download large amounts of data (Latest Cumulative Update, Dynamic Updates, Etc) directly from the internet if you leave Dynamic Updates enabled.</p>
<p>Interestingly, while this change has made it much more difficult to offline service your Windows 10 Upgrade media, it is what has helped make Feature Updates using native servicing work, but ONLY if you leave Dynamic Updates enabled.</p>
<p>Regardless of where they come from, Dynamic Updates still are an integral part of the Feature Update process. You can disable Dynamic Updates using DynamicUpdate=Disable, but then you MAY run into issues that Dynamic Updates would have addressed for you (we have seen it in our testing). The choice is up to you. If you have concerns about melting your networks, please proceed with caution and test before rolling this out work with your networking team if you before you enable it.
If you&rsquo;re thinking that since <a href=/2018/08/20/adding-dynamic-updates-to-windows-10-in-place-upgrade-media-during-offline-servicing/>you are offline servicing your Windows 10 Upgrade media</a> for your SCCM Task Sequence, you&rsquo;ll just keep using that — the &lsquo;feature&rsquo; that causes Windows Setup to go out to the internet for Dynamic Updates is also what has removed them from WSUS <a href="https://twitter.com/AdamGrossTX/status/1153774953709350913?s=20">(though we just had 1 show up in WSUS or 1809 last month</a>) and has made it difficult (<a href=https://twitter.com/gwblok/status/1148815701882355712>not impossible</a>) to continue to include them in our offline serviced media. Additionally, you should know that if you are deploying 1809+ via Task Sequence, you may ALREADY be downloading updates from the internet without knowing it since this is a default behavior now (more info in the next section).</p>
<h2 id=deployingmanaging-setupconfigini>Deploying/Managing Setupconfig.ini</h2>
<p>Depending on your needs, you can deploy Setupconfig.ini any number of ways including:</p>
<ul>
<li>Static file copied down via:
<ul>
<li>GPO</li>
<li>SCCM Package or Application</li>
<li>Logon Script</li>
<li>etc</li>
</ul>
</li>
<li>SCCM Client Settings - Limited Use (see screenshot below)
<ul>
<li>Priority (1902)</li>
<li>Dynamic Updates (1906)</li>
</ul>
</li>
<li>SCCM Task Sequence
<ul>
<li>Detect model and cache drivers</li>
<li>Build Setupconfig.ini based on device requirements</li>
</ul>
</li>
<li>SCCM Application or Package</li>
<li>SCCM Configuration Item (CI) and Configuration Baselines
<ul>
<li>Detect and enforce settings by line</li>
<li>Add/Remove/Update lines without impacting lines managed by other means (like SCCM Client Settings)</li>
</ul>
</li>
<li>Intune PowerShell Scripts or Win32 Application</li>
</ul>
<h4 id=sccm-client-settings>SCCM Client Settings</h4>
<p>New Client Settings policies have been added to SCCM 1902 and 1906 that modify Setupconfig.ini to change <a href=https://docs.microsoft.com/sccm/core/plan-design/changes/whats-new-in-version-1902#bkmk_sum>priority for Feature Updates from Low to Normal</a> (speeds up the <a href=https://docs.microsoft.com/windows-hardware/manufacture/desktop/windows-setup-installation-process>downlevel</a> portion of the upgrade) and <a href=https://docs.microsoft.com/sccm/core/plan-design/changes/whats-new-in-version-1906#configure-dynamic-update-during-feature-updates>disable Dynamic Updates</a>. If you want to customize Setupconfig.ini, consider whether you will also be using these client settings. If so, you need to ensure that you aren&rsquo;t overwriting the file with whatever process you use to maintain the file.</p>
<p><div class=image>
<figure>
<a href=image-3.png target=_blank>
<img src=image-3.png alt="A Square Dozen Image">
</a>
<figcaption>New settings for SCCM 1902 and 1906. Screenshot from 1906.</figcaption>
</figure>
</div></p>
<h4 id=sccm-task-sequence>SCCM Task Sequence</h4>
<p>At the August 2019 Charlotte Systems Management User Group hosted by Microsoft PFE <a href=https://twitter.com/jandreacola>Julie Andreacola</a>, she detailed how to deploy a Task Sequence that can customize the file based on device type and driver requirements. If you have driver requirements, this could certainly be a viable option. If you don&rsquo;t it may be a bit complex when a simple file copy will work for you.</p>
<h4 id=sccm-configuration-item-ci-and-configuration-baselines>SCCM Configuration Item (CI) and Configuration Baselines</h4>
<p>The approach I&rsquo;m taking is using an SCCM Configuration Item and Configuration Baseline to manage the Setupconfig.ini file, as well as several other scripts/files needed by Windows Setup. The CI uses a PowerShell script that will read in the contents of the existing ini file and only edit the lines specified by the remediation script. This allows the script to play nicely with other processes such as SCCM Client settings that may also be managing the file. There will be a link to my whole Feature Updates GitHub repository at the end of the post.
No matter which approach you take to managing Setupconfig.ini, be sure that it can handle the complexities of your environment. Start simple and work up from there. My scripts have ended up a bit more complex than I expected, but I took the time to make them re-usable for other things in the future. You can certainly simplify them if you need to.
<a href=https://docs.microsoft.com/microsoft-365/enterprise/step-7-windows-and-office-as-a-servicehttps://docs.microsoft.com/windows/deployment/update/waas-quick-start>https://docs.microsoft.com/microsoft-365/enterprise/step-7-windows-and-office-as-a-servicehttps://docs.microsoft.com/windows/deployment/update/waas-quick-start</a></p>
<h2 id=errors-caused-by-setupconfigini>Errors caused by Setupconfig.ini</h2>
<p>During testing of Setupconfig.ini, some of my tests were failing with random errors right away. Here&rsquo;s what I found.</p>
<h4 id=0xc190010a-1047527158>0xC190010A(-1047527158)</h4>
<p>This error occurs whenever you have line items in your Setupconfig.ini file that aren&rsquo;t valid command line options. This is typically a typo or incorrect entry in the Setupconfig.ini file.</p>
<p><div class=image>
<figure>
<a href=2019-08-13_10-41-29.png target=_blank>
<img src=2019-08-13_10-41-29.png alt="A Square Dozen Image">
</a>
</figure>
</div></p>
<h4 id=0xc190010d-1047527155>0xC190010D(-1047527155)</h4>
<p>Some entries in Setupconfig.ini are paths to files such as <code>PostOOBE=c:\~FeatureUpdateTemp\Scripts\SetupComplete.cmd</code>. Any files you specify must exist at the time that you launch the Feature Update, or you will receive this message.</p>
<p><div class=image>
<figure>
<a href=2019-08-11_23-09-10.png target=_blank>
<img src=2019-08-11_23-09-10.png alt="A Square Dozen Image">
</a>
</figure>
</div></p>
<p>You can run ProcMon from the <a href=https://docs.microsoft.com/sysinternals/>SysInternals</a> suite to track down issues like this. I was able to quickly determine that SetupHost was looking at Setupconfig.ini then looking for SetupComplete.cmd and returned File Not Found.</p>
<p><div class=image>
<figure>
<a href=2019-08-25_16-58-18.png target=_blank>
<img src=2019-08-25_16-58-18.png alt="A Square Dozen Image">
</a>
</figure>
</div></p>
<h2 id=script-for-managing-setupconfigini>Script for Managing Setupconfig.ini</h2>
<p>As I mentined above, I&rsquo;m managing Setupconfig.ini in production using an SCCM Configuration Item and Baseline. In my <a href=https://github.com/AdamGrossTX/Windows10FeatureUpdates>Windows10FeatureUpdates</a> GitHub Repo, I&rsquo;ve included the script that I wrote to manage the file. Thanks to <a href=https://twitter.com/SysBehr>Colin Wilkins</a> for helping me get started with the script and CI (<a href=https://github.com/SysBehr/BehrNecessities/tree/master/ConfigItems/SetupConfig_ExtraParameters>see the original here</a>). To use this file in production, you will set up a Configuration Item and Baseline in SCCM. The script will perform the Detection and Remediation all in one.</p>
<p>Before you start, download the script from my <a href=https://github.com/AdamGrossTX/Windows10FeatureUpdates>Github Repo</a>. It is located under <code>Admin\ComplianceScripts\FeatureUpdateCIScript.ps1</code></p>
<p>Edit the parameters of the script to match settings required for your environment. Here&rsquo;s a snippet of the params. Read the help in the script for more info. You will use this script in Steps 4 & 5 below.</p>
<p><div class=image>
<figure>
<a href=image-39.png target=_blank>
<img src=image-39.png alt="A Square Dozen Image">
</a>
</figure>
</div></p>
<p>In the SCCM Console under \Assets and Compliance\Overview\Compliance Settings\Configuration Items, Click Create Configuration Item and enter a new name for the CI then click Next.</p>
<p><div class=image>
<figure>
<a href=image-36.png target=_blank>
<img src=image-36.png alt="A Square Dozen Image">
</a>
</figure>
</div></p>
<p>For Supported Platforms click Windows 10.</p>
<p><div class=image>
<figure>
<a href=image-37.png target=_blank>
<img src=image-37.png alt="A Square Dozen Image">
</a>
</figure>
</div></p>
<p>On Settings click New then Enter the following:</p>
<ol>
<li>Name: Setupconfig.ini</li>
<li>Setting Type: Script / Data Type: String</li>
<li>Discovery Script - Click Add Script and paste the contents of the script from the repo. Ensure that the $Remediate variable in the is set to $Remediate=$False</li>
<li>Remediation Script - Click Add Script and paste the contents of the script from the repo. Ensure that the $Remediate variable in the is set to $Remediate=$True</li>
<li>Click Compliance Rules.
<div class=image>
<figure>
<a href=image-40.png target=_blank>
<img src=image-40.png alt="A Square Dozen Image">
</a>
</figure>
</div></li>
</ol>
<p>Click New. In the Create Rule Pane enter the following:</p>
<ol>
<li>Name: Setupconfig.ini Valid</li>
<li>The setting must comply with he following rule: Compliant</li>
<li>Check the box</li>
<li>Check the other box</li>
<li>Noncompliance set Critical</li>
<li>Click OK.</li>
</ol>
<p><div class=image>
<figure>
<a href=image-41.png target=_blank>
<img src=image-41.png alt="A Square Dozen Image">
</a>
</figure>
</div></p>
<p>Click OK again. You should be back at the main wizard.
Click Summary, Next, Close.</p>
<p><div class=image>
<figure>
<a href=image-42.png target=_blank>
<img src=image-42.png alt="A Square Dozen Image">
</a>
</figure>
</div></p>
<p>Next we you need to create a new Configuration Baseline and select the new CI that you just created (Just follow the wizard). Then deploy to a collection of your Windows 10 devices that you expect to manage with Feature Update servicing.</p>
<p>Clients will get the baseline whenever they check in for new Machine Policies. You can manually launch the baseline from the Configuration Manager applet. My baseline is named Feature Update Files.</p>
<p><div class=image>
<figure>
<a href=image-43.png target=_blank>
<img src=image-43.png alt="A Square Dozen Image">
</a>
</figure>
</div></p>
<p>When you run this on a client, you should see a new Setupconfig.ini file appear on the client under <code>C:\Users\Default\AppData\Local\Microsoft\Windows\WSUS\Setupconfig.ini</code>.</p>
<h2 id=summary>Summary</h2>
<p>I know there&rsquo;s a whole lot of information in this post which may make Setupconfig.ini seem complicated, but I assure you that it is very simple to use - I just chose to complicate it because I wanted a very dynamic management option for it. As I mentioned, you can simply create a new Setupconfig.ini file with the minimal set of options and copy it to <code>C:\Users\Default\AppData\Local\Microsoft\Windows\WSUS\Setupconfig.ini</code> on your clients. The thing that I like most about this file is that it works no matter where the Feature Update is deployed from (Task Sequence, WSUS, Intune, Windows Update). In my future posts, I&rsquo;ll show you how I&rsquo;m managing the SetupComplete.cmd and Failure.cmd files to help gather logs and integrate with SetupDiag. Stay tuned.</p>
</div>
<div class=post-share>
<div class="post-share-box share-comments">
hello
</div>
</div>
<div class=post-author>
</div>
<comments id=comments>
<script src=https://utteranc.es/client.js repo=AdamGrossTX/asquaredozen issue-term=title label="blog comment" theme=github-light crossorigin=anonymous async></script>
</comments>
</article>
</div>
</div>
</div>
<footer id=footer>
<div class=container>
<div id=footer-copyright>
<p class=copyright>&copy; 2021 Adam Gross - https://www.asquaredozen.com - A Square Dozen</a></p>
</div>
</div>
</footer>
</div>
</body>
</html>